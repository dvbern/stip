keycloak:
  url: '${STIP_OIDC_AUTH_SERVER}'
  frontend-url: '${STIP_OIDC_AUTH_SERVER_FRONTEND:${keycloak.url}}'
  client-id: 'stip-api'

kstip:
  version: '0.1-SNAPSHOT'
  environment: 'local'
  allowed:
    mimetypes: 'image/tiff,image/jpeg,image/png,application/pdf'
  pre-signed-request:
    issuer: 'https://stip.kibon.ch'
    expires-in-minutes: 1
    secret: '${STIP_PRE_SIGNED_REQUEST_SECRET}'
  sap:
    system-id: '${STIP_SAP_SYSID}'
    auth-header-value: '${STIP_SAP_AUTH_HEADER_VALUE}'
  seeding:
    seed-on:
      - 'dev'
    all-profiles:
      - 'dev'
      - 'prod'
      - 'test'
    testcases:
      seed-on:
        - 'dev'
        - 'prod'
      to-seed:
        - 'UATTestcase1'
        - 'UATTestcase2'
        - 'UATTestcase3'
        - 'UATTestcase4'
        - 'UATTestcase5'
        - 'UATTestcase6'
        - 'UATTestcase8'
        - 'UATTestcase9'
        - 'UATTestcase11'
        - 'SBTest/SBTest1'
        - 'SBTest/SBTest2'
        - 'SBTest/SBTest3'
        - 'SBTest/SBTest4'
        - 'SBTest/SBTest5'
        - 'SBTest/SBTest6'
        - 'SBTest/SBTest7'
        - 'SBTest/SBTest8'
        - 'SBTest/SBTest9'
        - 'SBTest/SBTest10'
        - 'SBTest/SBTest11'
        - 'SBTest/SBTest12'
        - 'SBTest/SBTest13'
        - 'SBTest/SBTest14'
        - 'SBTest/SBTest15'
        - 'SBTest/SBTest16'
        - 'SBTest/SBTest17'
        - 'SBTest/SBTest18'
        - 'SBTest/SBTest19'
        - 'SBTest/SBTest22'
        - 'SBTest/SBTest23'
        - 'SBTest/SBTest25'
        - 'SBTest/SBTest26'
        - 'SBTest/SBTest27'
  plzdata:
    cron: '0 15 10 10W * ?' # Fires at 10:15 on the closest weekday to the 10th of each month
    featurekey: 'ortschaftenverzeichnis_plz_2056.csv.zip'
    hashkey: 'checksum:multihash'
  unterschriftenblatt:
    cron: '0 0 9 1/1 * ? *' # Fires daily at 09:00
  welcome-mail:
    kc-url: '${STIP_OIDC_AUTH_SERVER_FRONTEND}'
    kc-path: '${STIP_WELCOME_MAIL_PATH}'
    kc-query-parameter: '${STIP_WELCOME_MAIL_QUERY_PARAMETER}'
    kc-scope: '${STIP_WELCOME_MAIL_SCOPE}'
  dmn:
    current-major-version: 1
    current-minor-version: 0
  pagination:
    max-allowed-page-size: 50
  should-clear-database: false

quarkus:
  log:
    sentry:
      ~: 'true'
      dsn: '${STIP_SENTRY_DSN}'
      traces-sample-rate: 1.0
      environment: '${KSTIP_ENVIRONMENT}'
      in-app-packages: 'ch.dvbern.stip.*'
  antivirus:
    clamav:
      enabled: true
      health:
        enabled: true
  execution-model-annotations:
    # TODO: use FAIL as soon as @Blocking is detected on subclasses
    # see: https://github.com/quarkusio/quarkus/issues/38275
    detection-mode: WARN
  liquibase:
    migrate-at-start: true
    change-log: 'db/migration/changelog.xml'
    validate-on-migrate: true
  oidc:
    bern:
      auth-server-url: '${keycloak.url}/realms/bern'
      client-id: '${keycloak.client-id}'
      application-type: service
  s3:
    aws:
      credentials:
        type: static
        static-provider:
          access-key-id: '${STIP_S3_ACCESS_KEY}'
          secret-access-key: '${STIP_S3_ACCESS_SECRET}'
      region: '${STIP_S3_REGION}'
    path-style-access: true
  mailer:
    port: 25
    auth-methods: 'DIGEST-MD5 CRAM-SHA256 CRAM-SHA1 CRAM-MD5 PLAIN LOGIN'
    host: 'mailext.dvbern.ch'
    from: 'kstip@dvbern.ch'
  datasource:
    username: '${STIP_DB_USERNAME}'
    db-kind: 'postgresql'
    password: '${STIP_DB_PASSWORD}'
    jdbc:
      url: '${STIP_DB_URL}'
  hibernate-envers:
    object-quoting-strategy: 'QUOTE_ALL_OBJECTS'
  hibernate-orm:
    persistence-xml:
      ignore: true
    log:
      queries-slower-than-ms: 20
      jdbc-warnings: true
    multitenant: 'DISCRIMINATOR'
  default-locale: 'de'
  security:
    jaxrs:
      deny-unannotated-endpoints: true
  jacoco:
    excludes: 'ch/dvbern/stip/generated/**,ch/dvbern/stip/**/Q*,ch/dvbern/stip/**/*MapperImpl*'
  application:
    name: 'stip-api'
  keycloak:
    devservices:
      enabled: false
    admin-client:
      server-url: ${keycloak.url}
      grant-type: password
      username: ${STIP_KEYCLOAK_ADMIN_USER}
      password: ${STIP_KEYCLOAK_ADMIN_PASSWORD}

  # Keep in Sync with AppLanguages.java
  locales: de_CH,fr_CH
  rest-client:
    GeoCollection-api:
      url: 'https://data.geo.admin.ch/api/stac/v0.9/collections/ch.swisstopo-vd.ortschaftenverzeichnis_plz'
    AuszahlungSapImportStatusEndpoint:
      url: 'https://sap-po-qas.infra.be.ch:443/XISOAPAdapter/MessageServlet?senderParty=&senderService=BC_2080&receiverParty=&receiverService=&interface=os_ImportStatusRead&interfaceNamespace=urn:be.ch:KTBE_ERP_FI:IMPORT_STATUS'
    AuszahlungSapBusinessPartnerCreateEndpoint:
      url: 'https://sap-po-qas.infra.be.ch:443/XISOAPAdapter/MessageServlet?senderParty=&senderService=BC_2080&receiverParty=&receiverService=&interface=os_BusinessPartnerCreate&interfaceNamespace=urn:be.ch:KTBE_MDG:BUSINESS_PARTNER'
    AuszahlungSapBusinessPartnerChangeEndpoint:
      url: 'https://sap-po-qas.infra.be.ch:443/XISOAPAdapter/MessageServlet?senderParty=&senderService=BC_2080&receiverParty=&receiverService=&interface=os_BusinessPartnerChange&interfaceNamespace=urn:be.ch:KTBE_MDG:BUSINESS_PARTNER'
    AuszahlungSapVendorPostingCreateEndpoint:
      url: 'https://sap-po-qas.infra.be.ch:443/XISOAPAdapter/MessageServlet?senderParty=&senderService=BC_2080&receiverParty=&receiverService=&interface=os_VendorPostingCreate&interfaceNamespace=urn:be.ch:KTBE_ERP_FI:VENDOR_POSTING'
    AuszahlungSapBusinessPartnerReadEndpoint:
      url: 'https://sap-po-qas.infra.be.ch:443/XISOAPAdapter/MessageServlet?senderParty=&senderService=BC_2080&receiverParty=&receiverService=&interface=os_BusinessPartnerRead&interfaceNamespace=urn:be.ch:KTBE_MDG:BUSINESS_PARTNER'
#   store-type: jdbc-tx
'%dev':
  quarkus:
    log:
      sentry:
        ~: 'false'
        debug: 'true'
    http:
      enable-compression: true
      compress-media-types:
        - 'application/json'
    mailer:
      mock: false
    s3:
      endpoint-override: '${STIP_S3_ENDPOINT}'
    swagger-ui:
      oauth2-redirect-url: 'http://localhost:8080/q/swagger-ui/oauth2-redirect.html'
    oidc:
      bern:
        tls:
          trust-store-file-type: 'jks'
          trust-store-cert-alias: 'apps-mercury-ocp-dvbern-ch'
          trust-store-file: './src/main/resources/development.jks'
          trust-store-password: 'changeit'
    smallrye-openapi:
      security-scheme: 'oauth2-implicit'
      security-scheme-name: 'auth-dev-bern'
      oauth2-implicit-authorization-url: '${STIP_OIDC_AUTH_SERVER}/realms/bern/protocol/openid-connect/auth'
    keycloak:
      admin-client:
        server-url: ${keycloak.url}
        grant-type: password
        username: ${STIP_KEYCLOAK_ADMIN_USER}
        password: ${STIP_KEYCLOAK_ADMIN_PASSWORD}
  kstip:
    pre-signed-request:
      issuer: 'https://stip.kibon.ch'
      expires-in-minutes: 5

'%test':
  quarkus:
    log:
      sentry:
        ~: 'false'
    hibernate-orm:
      sql-load-script: 'db/test/init_test.sql'
      database:
        generation: 'drop-and-create'
    oidc:
      auth-server-url: '${keycloak.url}/realms/quarkus/'
      client-id: '${keycloak.client-id}'
      application-type: service
    s3:
      aws:
        credentials:
          static-provider:
            access-key-id: 'test-key'
            secret-access-key: 'test-secret'
        region: 'eu-central-2'
      devservices:
        buckets: '${bucket.name}'
    keycloak:
      admin-client:
        server-url: ${keycloak.url}
        grant-type: password
        username: "test"
        password: "test"
  bucket:
    name: 'stip-usercontent-test'
  keycloak:
    url: 'http://dummy.keycloak'
    frontend-url: 'http://dummy.keycloak'
  kstip:
    allowed:
      mimetypes: 'text/plain,image/png'
    pre-signed-request:
      issuer: 'https://stip.kibon.ch'
      expires-in-minutes: 10
      secret: '6a5336d35a192000260cbc9b41a1cb39'
    welcome-mail:
      kc-url: 'http://dummy.keycloak'
      kc-path: '/realms/bern/protocol/openid-connect/auth'
      kc-query-parameter: '?response_type=code&client_id=stip-gesuch-app&redirect_uri=localhost:4200'
      kc-scope: '&scope=openid%20profile%20email%20offline_access&kc_idp_hint=belogin'
'%prod':
  quarkus:
    s3:
      endpoint-override: '${STIP_S3_ENDPOINT}'
    antivirus:
      clamav:
        host: '${STIP_CLAMAV_HOST}'
        port: '${STIP_CLAMAV_PORT:3310}'
    keycloak:
      admin-client:
        server-url: ${keycloak.url}
        grant-type: password
        username: ${STIP_KEYCLOAK_ADMIN_USER}
        password: ${STIP_KEYCLOAK_ADMIN_PASSWORD}

mp:
  openapi:
    scan:
      disable: true
    extensions:
      servers:
        relative: true
      path: '/openapi.yml'
      enabled: true
openapi:
  ui:
    swaggerHeaderVisibility: 'hidden'
    yamlUrl: '/openapi.yml'
    swaggerUiTheme: 'feeling-blue'
    serverVisibility: 'hidden'
bucket:
  name: '${STIP_S3_BUCKET_NAME}'

org:
  hibernate:
    envers:
      audit_table_suffix: '_aud'
