<ng-container *ngIf="errorMessages$ | async as errorMessages">
  <div
    [class.is-invalid]="(touchedAndInvalid$ | async) === true"
    [class.d-flex]="isCheckbox"
    [class.flex-row-reverse]="isCheckbox"
    [class.justify-content-end]="isCheckbox"
    [class.pt-4]="isCheckbox"
  >
    <!--
    touchedAndInvalid$ is better for change detection than "formFieldControl?.invalid && (touched$ | async) === true".
    The latter is not recognized until we click away. Proof:
    -->

    <!--<pre>invalid: {{formFieldControl?.invalid}}</pre>
    <pre>touched: {{(touched$ | async) === true}}</pre>
    <pre>is-invalid: {{ formFieldControl?.invalid && (touched$ | async) === true}}</pre>
    <pre>touchedAndInvalid$: {{ touchedAndInvalid$ | async}}</pre> -->

    <label [attr.for]="controlId" [class.pt-2]="isCheckbox">
      <ng-content select="dv-shared-ui-form-field-label"></ng-content>
    </label>
    <div>
      <div class="d-flex align-items-center gap-4" [class.pt-2]="isCheckbox">
        <div class="flex-fill control-wrapper">
          <ng-content></ng-content>
        </div>
        <button
          type="button"
          class="dv-button-icon dv-button-icon-md text-info"
          *ngIf="showInfoIcon$ | async"
          [attr.aria-label]="
            'shared.form-field.toggle-info-messages' | translate
          "
          [class.active]="showInfoMessages"
          (click)="toggleInfoMessages()"
        >
          <span class="material-symbols-rounded"> info </span>
        </button>
      </div>
      <div>
        <div *ngFor="let error of errorMessages; trackBy: trackByIndex">
          <ng-container [ngTemplateOutlet]="error.templateRef"></ng-container>
        </div>
      </div>
      <div *ngIf="showInfoMessages">
        <div *ngFor="let infoMessage of infoMessages; trackBy: trackByIndex">
          <ng-container
            [ngTemplateOutlet]="infoMessage.templateRef"
          ></ng-container>
        </div>
      </div>
    </div>
  </div>
  <ng-content select="[dvSharedUiFormFieldExtraContent]"></ng-content>
</ng-container>
