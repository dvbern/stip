<dv-gesuch-app-pattern-gesuch-step-layout [step]="GesuchFormSteps.LEBENSLAUF">
  <!-- loading -->
  <div
    data-test-id="form-item-loading"
    *ngIf="view$().loading"
    class="my-2 p-2 py-4 d-flex rounded shadow-sm border"
  >
    <div class="dv-progress-bar-indeterminate">
      <div></div>
    </div>
  </div>

  <!-- item editor -->
  <dv-gesuch-app-feature-gesuch-form-lebenslauf-editor
    *ngIf="editedItem"
    [item]="editedItem"
    (saveTriggered)="handleEditorSave($event)"
    (autoSaveTriggered)="handleEditorAutoSave($event)"
    (closeTriggered)="handleEditorClose()"
    [minStartDate]="minDate$()"
    [maxEndDate]="maxDate$()"
  />

  <ng-container *ngIf="!editedItem">
    <!-- Infobx -->
    <div class="row">
      <div class="col-12 col-xl-8 my-3">
        <!-- TODO von / bis ausrechnen -->
        <span>{{
          'gesuch-app.form.lebenslauf.top.info'
            | translate
              : {
                  von: minDate$() ? (minDate$() | date) : '?',
                  bis: maxDate$() ? (maxDate$() | date) : '?'
                }
        }}</span>
      </div>
    </div>

    <div class="row">
      <!-- Table -->
      <div class="col-12 col-xl-8">
        <table class="table table-borderless">
          <thead>
            <tr>
              <th scope="col"></th>
              <th scope="col">
                {{ 'gesuch-app.form.lebenslauf.item.subtype' | translate }}
              </th>
              <th scope="col">
                {{ 'gesuch-app.form.lebenslauf.item.name' | translate }}
              </th>
              <th scope="col">
                {{ 'gesuch-app.form.lebenslauf.item.dateStart' | translate }}
              </th>
              <th scope="col">
                {{ 'gesuch-app.form.lebenslauf.item.dateEnd' | translate }}
              </th>
              <th scope="col"></th>
              <th scope="col"></th>
            </tr>
          </thead>
          <tbody>
            <!-- Lebenslauf items -->
            <ng-container *ngIf="lebenslaufItems$() as items">
              <tr
                *ngFor="let itemRaw of items; trackBy: trackByIndex"
                style="background-color: #efefef"
                [class.bg-primary-subtle]="itemRaw?.type === 'AUSBILDUNG'"
              >
                <ng-container *ngIf="asItem(itemRaw!) as item">
                  <td>
                    <i
                      class="material-symbols-rounded me-2"
                      style="color: #999"
                      [class.text-primary]="item.type === 'AUSBILDUNG'"
                    >
                      {{ item.type === 'AUSBILDUNG' ? 'school' : 'work' }}
                    </i>
                  </td>
                  <td>
                    {{
                      'gesuch-app.form.lebenslauf.item.subtype.' +
                        (item.type === 'AUSBILDUNG'
                          ? 'bildungsart'
                          : 'taetigkeitsart') +
                        '.' +
                        item.subtype.toLowerCase() | translate
                    }}
                  </td>
                  <td>{{ item.name }}</td>
                  <td>{{ item.dateStart }}</td>
                  <td>{{ item.dateEnd }}</td>
                  <td>
                    <button
                      type="button"
                      class="btn btn-link p-0 lh-1"
                      (click)="handleEditItem(item)"
                      [title]="
                        'gesuch-app.form.lebenslaufitem.edit' | translate
                      "
                    >
                      <i class="material-symbols-rounded">edit</i>
                    </button>
                  </td>
                  <td>
                    <button
                      type="button"
                      class="btn btn-link p-0 lh-1"
                      (click)="handleDeleteItem(item)"
                      [title]="
                        'gesuch-app.form.lebenslaufitem.delete' | translate
                      "
                    >
                      <i class="material-symbols-rounded">delete</i>
                    </button>
                  </td>
                </ng-container>
              </tr>
            </ng-container>

            <!-- geplante Ausbildung -->
            <tr *ngIf="ausbildung$() as item" class="bg-primary-subtle">
              <td>
                <i class="material-symbols-rounded me-2 text-primary">
                  school
                </i>
              </td>
              <td>{{ item.ausbildungstaetteId }}</td>
              <td>{{ item.ausbildungsgangId }}: {{ item.fachrichtung }}</td>
              <td>{{ item.ausbildungBegin }}</td>
              <td>{{ item.ausbildungEnd }}</td>
              <td></td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ADD -->
    <div
      class="mt-2 d-flex flex-column gap-3 flex-md-row justify-content-start"
    >
      <button
        type="button"
        class="btn btn-outline-primary"
        (click)="handleAddAusbildung()"
      >
        {{ 'gesuch-app.form.lebenslauf.add.ausbildung' | translate }}
      </button>
      <button
        type="button"
        class="btn btn-outline-primary"
        (click)="handleAddTaetigkeit()"
      >
        {{ 'gesuch-app.form.lebenslauf.add.taetigkeit' | translate }}
      </button>
    </div>

    <!-- Buttons -->
    <div class="mt-5 d-flex flex-column gap-3 flex-md-row justify-content-end">
      <button type="button" class="btn btn-primary" (click)="handleContinue()">
        {{ 'gesuch-app.form.gonext' | translate }}
      </button>
    </div>
  </ng-container>
</dv-gesuch-app-pattern-gesuch-step-layout>
