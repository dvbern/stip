<dv-gesuch-app-pattern-gesuch-step-layout [step]="step">
  <div>
    <div
      data-test-id="form-person-loading"
      *ngIf="view().loading"
      class="my-2 p-2 py-4 d-flex rounded shadow-sm border"
    >
      <div class="dv-progress-bar-indeterminate">
        <div></div>
      </div>
    </div>

    <form
      [formGroup]="form"
      novalidate
      class="mt-4"
      *ngIf="!view().loading"
      (ngSubmit)="handleSave()"
    >
      <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
        <dv-shared-ui-form-label>{{
          'gesuch-app.form.auszahlung.kontoinhaberin' | translate
        }}</dv-shared-ui-form-label>
        <select
          class="form-select"
          dvSharedUiFormLabelTarget
          formControlName="kontoinhaberin"
        >
          <option [value]="null" disabled selected>
            {{ 'shared.form.select.empty' | translate }}
          </option>
          <option [value]="KontoinhaberinType.GESUCHSTELLERIN">
            {{ 'gesuch-app.form.shared.gesuchstellerin.label' | translate }}
          </option>
          <option [value]="KontoinhaberinType.VATER">
            {{ 'gesuch-app.form.person.wohnsitz.vater' | translate }}
          </option>
          <option [value]="KontoinhaberinType.MUTTER">
            {{ 'gesuch-app.form.person.wohnsitz.mutter' | translate }}
          </option>
          <option [value]="KontoinhaberinType.SOZIALDIENST_INSTITUTION">
            {{
              'gesuch-app.form.auszahlung.sozialdienst-institution.label'
                | translate
            }}
          </option>
          <option [value]="KontoinhaberinType.ANDERE">
            {{ 'gesuch-app.form.shared.andere.label' | translate }}
          </option>
        </select>
      </dv-shared-ui-form-field>

      <div class="row g-4 mt-1">
        <!-- Name -->
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.shared.lastname.label' | translate
          }}</dv-shared-ui-form-label>
          <input
            data-test-id="form-person-name"
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="name"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>
      <div class="row g-4 mt-1">
        <!-- Vorname -->
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.shared.firstname.label' | translate
          }}</dv-shared-ui-form-label>
          <input
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="vorname"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>

      <div class="row g-4 mt-1" formGroupName="addresse">
        <div class="col-12 col-md-6 col-xl-4">
          <div class="row gx-2">
            <!-- Strasse -->
            <dv-shared-ui-form-field class="col-8 col-xl-9">
              <dv-shared-ui-form-label
                >{{ 'gesuch-app.form.shared.address.street.label' | translate }}
              </dv-shared-ui-form-label>
              <input
                class="form-control"
                type="text"
                dvSharedUiFormLabelTarget
                formControlName="strasse"
              />
              <dv-shared-ui-form-message
                *dvSharedUiFormMessageError="'required'"
              >
                {{ 'shared.form.error.required' | translate }}
              </dv-shared-ui-form-message>
            </dv-shared-ui-form-field>

            <!-- Nr -->
            <dv-shared-ui-form-field class="col-4 col-xl-3">
              <dv-shared-ui-form-label
                >{{ 'gesuch-app.form.shared.address.number.label' | translate }}
              </dv-shared-ui-form-label>
              <input
                class="form-control"
                type="text"
                dvSharedUiFormLabelTarget
                formControlName="nummer"
              />
              <dv-shared-ui-form-message
                *dvSharedUiFormMessageError="'required'"
              >
                {{ 'shared.form.error.required' | translate }}
              </dv-shared-ui-form-message>
            </dv-shared-ui-form-field>
          </div>
        </div>

        <div class="col-12 col-md-6 col-xl-4">
          <div class="row gx-2">
            <!-- PLZ -->
            <dv-shared-ui-form-field class="col-5 col-md-4 col-xl-3">
              <dv-shared-ui-form-label
                >{{
                  'gesuch-app.form.shared.address.zipcode.label' | translate
                }}
              </dv-shared-ui-form-label>
              <input
                class="form-control"
                type="text"
                dvSharedUiFormLabelTarget
                formControlName="plz"
              />
              <dv-shared-ui-form-message
                *dvSharedUiFormMessageError="'required'"
              >
                {{ 'shared.form.error.required' | translate }}
              </dv-shared-ui-form-message>
            </dv-shared-ui-form-field>

            <!-- Ort -->
            <dv-shared-ui-form-field class="col-7 col-md-8 col-xl-9">
              <dv-shared-ui-form-label
                >{{ 'gesuch-app.form.shared.address.city.label' | translate }}
              </dv-shared-ui-form-label>
              <input
                class="form-control"
                type="text"
                dvSharedUiFormLabelTarget
                formControlName="ort"
              />
              <dv-shared-ui-form-message
                *dvSharedUiFormMessageError="'required'"
              >
                {{ 'shared.form.error.required' | translate }}
              </dv-shared-ui-form-message>
            </dv-shared-ui-form-field>
          </div>
        </div>
      </div>

      <div class="row g-4 mt-1">
        <!-- Land -->
        <dv-shared-ui-form-field
          class="col-12 col-md-6 col-xl-4"
          formGroupName="addresse"
        >
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.shared.address.country.label' | translate
          }}</dv-shared-ui-form-label>
          <select
            class="form-select"
            dvSharedUiFormLabelTarget
            formControlName="land"
          >
            <option [value]="null" disabled selected>
              {{ 'shared.form.select.empty' | translate }}
            </option>
            <option
              [value]="l.value"
              *ngFor="let l of Land | keyvalue; trackBy: trackByIndex"
            >
              {{ l.value }}
            </option>
          </select>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>

      <div class="row g-4 mt-1">
        <!-- IBAN -->
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.auszahlung.iban.label' | translate
          }}</dv-shared-ui-form-label>
          <input
            data-test-id="form-person-name"
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="iban"
            [maskito]="MASK_IBAN"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
          <dv-shared-ui-form-message
            *dvSharedUiFormMessageError="'invalidIBAN'"
          >
            {{ 'shared.form.error.invalidIBAN' | translate }}
          </dv-shared-ui-form-message>
          <dv-shared-ui-form-message
            *dvSharedUiFormMessageError="'invalidCountry'"
          >
            {{ 'shared.form.error.invalidCountry' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>
      <!-- Buttons -->
      <div
        class="mt-5 d-flex flex-column gap-3 flex-md-row justify-content-end"
      >
        <button type="submit" class="btn btn-primary">
          {{ 'gesuch-app.form.save-and-continue' | translate }}
        </button>
      </div>
    </form>
  </div>
</dv-gesuch-app-pattern-gesuch-step-layout>
