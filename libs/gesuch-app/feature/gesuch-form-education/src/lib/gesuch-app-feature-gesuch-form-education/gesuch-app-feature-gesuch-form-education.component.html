<dv-gesuch-app-pattern-gesuch-step-layout [step]="GesuchFormSteps.AUSBILDUNG">
  <!-- loading -->
  <div
    data-test-id="form-ausbildung-loading"
    *ngIf="view$().loading"
    class="my-2 p-2 py-4 d-flex rounded shadow-sm border"
  >
    <div class="dv-progress-bar-indeterminate">
      <div></div>
    </div>
  </div>

  <!-- form -->
  <form
    [formGroup]="form"
    novalidate
    class="mt-4"
    *ngIf="!view$().loading"
    (ngSubmit)="handleSave()"
  >
    <h3 class="mt-4">
      {{ 'gesuch-app.form.education.place.title' | translate }}
    </h3>

    <!-- LAND -->
    <div class="row">
      <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4 mt-3">
        <dv-shared-ui-form-field-label>
          {{ 'gesuch-app.form.education.ausbildungsland.label' | translate }}
        </dv-shared-ui-form-field-label>
        <select
          class="form-select"
          dvSharedUiFormFieldLabelTarget
          formControlName="ausbildungsland"
          (change)="handleLandChangedByUser()"
        >
          <option [ngValue]="''" selected>
            {{ 'shared.form.select.empty' | translate }}
          </option>
          <option
            [value]="l.name"
            *ngFor="
              let l of view$().ausbildungsgangLands;
              trackBy: trackByIndex
            "
          >
            {{
              'gesuch-app.form.education.ausbildungsland.' + l.name | translate
            }}
          </option>
        </select>
        <dv-shared-ui-form-field-message
          *dvSharedUiFormFieldMessageError="'required'"
        >
          {{ 'shared.form.error.required' | translate }}
        </dv-shared-ui-form-field-message>
      </dv-shared-ui-form-field>

      <!-- STAETTE -->
      <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4 mt-3">
        <dv-shared-ui-form-field-label>
          {{ 'gesuch-app.form.education.ausbildungsstaette.label' | translate }}
        </dv-shared-ui-form-field-label>

        <!-- Typeahead -->
        <div class="position-relative" *ngIf="!form.value['manuell']">
          <input
            id="typeahead-focus"
            type="text"
            class="form-control form-select"
            formControlName="ausbildungsstaette"
            [ngbTypeahead]="ausbildungsstaetteTypeaheadFn$()"
            (focus)="focusAusbildungsstaette$.next($any($event).target.value)"
            [editable]="false"
            (change)="handleStaetteChangedByUser()"
            popupClass="dv-typeahead-popup"
            #staetteTypeahead
          />
          <button
            *ngIf="form.controls.ausbildungsstaette.value"
            type="button"
            class="btn btn-light dv-typeahead-clear-btn"
            (click)="
              form.controls.ausbildungsstaette.setValue('');
              staetteTypeahead.focus();
              handleStaetteChangedByUser()
            "
            [tabIndex]="-1"
          >
            <span class="material-symbols-rounded align-middle">clear</span>
          </button>
        </div>

        <!-- <select
          *ngIf="!form.value['manuell']"
          class="form-select"
          dvSharedUiFormFieldLabelTarget
          formControlName="ausbildungsstaette"
          (change)="handleStaetteChangedByUser()"
        >
          <option [ngValue]="''" selected>
            {{ 'shared.form.select.empty' | translate }}
          </option>
          <option
            [value]="l.name"
            *ngFor="
              let l of ausbildungsstaetteOptions$();
              trackBy: trackByIndex
            "
          >
            {{ l.name }}
          </option>
        </select> -->

        <input
          *ngIf="form.value['manuell']"
          class="form-control"
          type="text"
          dvSharedUiFormFieldLabelTarget
          formControlName="ausbildungsstaette"
        />
        <dv-shared-ui-form-field-message
          *dvSharedUiFormFieldMessageError="'required'"
        >
          {{ 'shared.form.error.required' | translate }}
        </dv-shared-ui-form-field-message>
      </dv-shared-ui-form-field>
    </div>

    <!-- GANG -->
    <div class="row">
      <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4 mt-3">
        <dv-shared-ui-form-field-label>
          {{ 'gesuch-app.form.education.ausbildungsgang.label' | translate }}
        </dv-shared-ui-form-field-label>

        <select
          *ngIf="!form.value['manuell']"
          class="form-select"
          dvSharedUiFormFieldLabelTarget
          formControlName="ausbildungsgang"
        >
          <option [ngValue]="''" selected>
            {{ 'shared.form.select.empty' | translate }}
          </option>
          <option
            [value]="l.name"
            *ngFor="let l of ausbildungsgangOptions$(); trackBy: trackByIndex"
          >
            {{ l.name }}
          </option>
        </select>

        <input
          *ngIf="form.value['manuell']"
          class="form-control"
          type="text"
          dvSharedUiFormFieldLabelTarget
          formControlName="ausbildungsgang"
        />
        <dv-shared-ui-form-field-message
          *dvSharedUiFormFieldMessageError="'required'"
        >
          {{ 'shared.form.error.required' | translate }}
        </dv-shared-ui-form-field-message>
      </dv-shared-ui-form-field>

      <!-- FACHRICHTUNG -->
      <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4 mt-3">
        <dv-shared-ui-form-field-label>
          {{ 'gesuch-app.form.education.fachrichtung.label' | translate }}
        </dv-shared-ui-form-field-label>
        <input
          class="form-control"
          type="text"
          dvSharedUiFormFieldLabelTarget
          formControlName="fachrichtung"
        />
        <dv-shared-ui-form-field-message
          *dvSharedUiFormFieldMessageError="'required'"
        >
          {{ 'shared.form.error.required' | translate }}
        </dv-shared-ui-form-field-message>
      </dv-shared-ui-form-field>
    </div>

    <!-- MANUELL -->
    <div class="row g-4">
      <dv-shared-ui-form-field class="col-12" [isCheckbox]="true">
        <dv-shared-ui-form-field-label
          >{{ 'gesuch-app.form.education.manuell.label' | translate }}
        </dv-shared-ui-form-field-label>
        <div class="form-check">
          <input
            class="form-check-input"
            type="checkbox"
            dvSharedUiFormFieldLabelTarget
            formControlName="manuell"
            (change)="handleManuellChangedByUser()"
          />
        </div>
      </dv-shared-ui-form-field>
    </div>

    <h3 class="mt-4">
      {{ 'gesuch-app.form.education.duration.title' | translate }}
    </h3>

    <div class="row">
      <!-- START -->
      <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4 mt-3">
        <dv-shared-ui-form-field-label>{{
          'gesuch-app.form.education.start.label' | translate
        }}</dv-shared-ui-form-field-label>

        <input
          class="form-control"
          dvSharedUiFormFieldLabelTarget
          formControlName="start"
          placeholder="MM.YYYY"
          [maskito]="MASK_MM_YYYY"
        />

        <dv-shared-ui-form-field-message
          *dvSharedUiFormFieldMessageError="'required'"
        >
          {{ 'shared.form.error.required' | translate }}
        </dv-shared-ui-form-field-message>
        <dv-shared-ui-form-field-message
          *dvSharedUiFormFieldMessageError="'monthYearMonth'"
        >
          {{ 'shared.form.error.monthYearMonth' | translate }}
        </dv-shared-ui-form-field-message>
        <dv-shared-ui-form-field-message
          *dvSharedUiFormFieldMessageError="'monthYearYearMin'"
        >
          {{
            'gesuch-app.form.education.form.error.monthYearNotPast' | translate
          }}
        </dv-shared-ui-form-field-message>
      </dv-shared-ui-form-field>

      <!-- ENDE -->
      <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4 mt-3">
        <dv-shared-ui-form-field-label>{{
          'gesuch-app.form.education.ende.label' | translate
        }}</dv-shared-ui-form-field-label>

        <input
          class="form-control"
          dvSharedUiFormFieldLabelTarget
          formControlName="ende"
          placeholder="MM.YYYY"
          [maskito]="MASK_MM_YYYY"
        />

        <dv-shared-ui-form-field-message
          *dvSharedUiFormFieldMessageError="'required'"
        >
          {{ 'shared.form.error.required' | translate }}
        </dv-shared-ui-form-field-message>
        <dv-shared-ui-form-field-message
          *dvSharedUiFormFieldMessageError="'monthYearMonth'"
        >
          {{ 'shared.form.error.monthYearMonth' | translate }}
        </dv-shared-ui-form-field-message>
        <dv-shared-ui-form-field-message
          *dvSharedUiFormFieldMessageError="'endDateAfterStart'"
        >
          {{
            'gesuch-app.form.education.form.error.monthYearAfterStart'
              | translate
          }}
        </dv-shared-ui-form-field-message>
      </dv-shared-ui-form-field>
    </div>

    <div class="row">
      <!-- PENSUM -->
      <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4 mt-3">
        <dv-shared-ui-form-field-label>
          {{ 'gesuch-app.form.education.pensum.label' | translate }}
        </dv-shared-ui-form-field-label>

        <select
          class="form-select"
          dvSharedUiFormFieldLabelTarget
          formControlName="pensum"
        >
          <option [ngValue]="''" selected>
            {{ 'shared.form.select.empty' | translate }}
          </option>
          <option
            [value]="l"
            *ngFor="let l of pensumOptions; trackBy: trackByIndex"
          >
            {{
              'gesuch-app.form.education.pensum.' + l.toLowerCase() | translate
            }}
          </option>
        </select>

        <dv-shared-ui-form-field-message
          *dvSharedUiFormFieldMessageError="'required'"
        >
          {{ 'shared.form.error.required' | translate }}
        </dv-shared-ui-form-field-message>
      </dv-shared-ui-form-field>
    </div>

    <!-- buttons -->
    <div class="mt-5 d-flex flex-column gap-3 flex-md-row justify-content-end">
      <button type="submit" class="btn btn-primary">
        {{ 'gesuch-app.form.save-and-continue' | translate }}
      </button>
    </div>
  </form>
</dv-gesuch-app-pattern-gesuch-step-layout>
