<div class="container mt-5 mb-5">
  <!-- step head -->
  <div
    class="d-flex align-items-center justify-content-between border-bottom border-3 mb-4"
  >
    <dv-shared-ui-progress-bar [current]="2" [total]="12" />
    <div class="text-end">
      <h2>{{ 'gesuch-app.form.education.title' | translate }}</h2>
      <p class="fs-5 fst-italic">
        {{ 'gesuch-app.form.next' | translate }}:
        {{ 'gesuch-app.form.cv.title' | translate }}
      </p>
    </div>
  </div>

  <div>
    <!-- loading -->
    <div
      data-test-id="form-ausbildung-loading"
      *ngIf="view().loading"
      class="my-2 p-2 py-4 d-flex rounded shadow-sm border"
    >
      <div class="dv-progress-bar-indeterminate">
        <div></div>
      </div>
    </div>

    <!-- form -->
    <form
      [formGroup]="form"
      novalidate
      class="mt-4"
      *ngIf="!view().loading"
      (ngSubmit)="handleSaveAndContinue()"
    >
      <h3 class="mt-4">
        {{ 'gesuch-app.form.education.place.title' | translate }}
      </h3>

      <div class="row g-4 mt-3">
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>
            {{ 'gesuch-app.form.education.ausbildungsland.label' | translate }}
          </dv-shared-ui-form-label>
          <select
            class="form-select"
            dvSharedUiFormLabelTarget
            formControlName="ausbildungsland"
          >
            <option [ngValue]="null" selected>
              {{ 'shared.form.select.empty' | translate }}
            </option>
            <option
              [value]="l.name"
              *ngFor="
                let l of ausbildungsgangs().ausbildungsgangLands;
                trackBy: trackByIndex
              "
            >
              {{
                'gesuch-app.form.education.ausbildungsland.' + l.name
                  | translate
              }}
            </option>
          </select>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>
            {{
              'gesuch-app.form.education.ausbildungsstaette.label' | translate
            }}
          </dv-shared-ui-form-label>

          <select
            *ngIf="!form.value['manuell']"
            class="form-select"
            dvSharedUiFormLabelTarget
            formControlName="ausbildungsstaette"
          >
            <option [ngValue]="null" selected>
              {{ 'shared.form.select.empty' | translate }}
            </option>
            <option
              [value]="l.name"
              *ngFor="
                let l of ausbildungsstaetteOptions();
                trackBy: trackByIndex
              "
            >
              {{ l.name }}
            </option>
          </select>

          <input
            *ngIf="form.value['manuell']"
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="ausbildungsstaette"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>
      <div class="row g-4 mt-2">
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>
            {{ 'gesuch-app.form.education.ausbildungsgang.label' | translate }}
          </dv-shared-ui-form-label>

          <!-- TODO disable wenn keine Stätte ausgewählt -->

          <!-- TODO Typeahead-->
          <!-- <input
            *ngIf="!form.value['manuell']"
            id="typeahead-focus"
            type="text"
            class="form-control"
            formControlName="ausbildungsgang"
            [ngbTypeahead]="
              searchAusbildungsgang(
                getAvailableAusbildungsgangs(),
                ngbTypeaheadAusbildungsgang
              )
            "
            (focus)="focusAusbildungsgang$.next($any($event).target.value)"
            (click)="clickAusbildungsgang$.next($any($event).target.value)"
            #ngbTypeaheadAusbildungsgang="ngbTypeahead"
          />-->

          <select
            *ngIf="!form.value['manuell']"
            class="form-select"
            dvSharedUiFormLabelTarget
            formControlName="ausbildungsgang"
          >
            <option [ngValue]="null" selected>
              {{ 'shared.form.select.empty' | translate }}
            </option>
            <option
              [value]="l.name"
              *ngFor="
                let l of getAvailableAusbildungsgangs();
                trackBy: trackByIndex
              "
            >
              {{ l.name }}
            </option>
          </select>

          <input
            *ngIf="form.value['manuell']"
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="ausbildungsgang"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>
            {{ 'gesuch-app.form.education.fachrichtung.label' | translate }}
          </dv-shared-ui-form-label>
          <input
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="fachrichtung"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>

      <div class="row g-4">
        <dv-shared-ui-form-field class="col-12" [isCheckbox]="true">
          <dv-shared-ui-form-label
            >{{ 'gesuch-app.form.education.manuell.label' | translate }}
          </dv-shared-ui-form-label>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              dvSharedUiFormLabelTarget
              formControlName="manuell"
            />
          </div>
        </dv-shared-ui-form-field>
      </div>

      <h3 class="mt-4">
        {{ 'gesuch-app.form.education.duration.title' | translate }}
      </h3>

      <div class="row mt-3">
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.education.start.label' | translate
          }}</dv-shared-ui-form-label>

          <div class="input-group">
            <input
              class="form-control"
              placeholder="dd.mm.yyyy"
              dvSharedUiFormLabelTarget
              formControlName="start"
              ngbDatepicker
              #dpStart="ngbDatepicker"
            />
            <button
              (click)="dpStart.toggle()"
              class="btn btn-outline-secondary position-relative"
              type="button"
            >
              <span
                class="material-symbols-rounded position-absolute translate-middle"
              >
                calendar_month
              </span>
            </button>
          </div>

          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.education.ende.label' | translate
          }}</dv-shared-ui-form-label>

          <div class="input-group">
            <input
              class="form-control"
              placeholder="dd.mm.yyyy"
              dvSharedUiFormLabelTarget
              formControlName="ende"
              ngbDatepicker
              #dpEnde="ngbDatepicker"
            />
            <button
              (click)="dpEnde.toggle()"
              class="btn btn-outline-secondary position-relative"
              type="button"
            >
              <span
                class="material-symbols-rounded position-absolute translate-middle"
              >
                calendar_month
              </span>
            </button>
          </div>

          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>

      <div class="row mt-3">
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>
            {{ 'gesuch-app.form.education.pensum.label' | translate }}
          </dv-shared-ui-form-label>
          <input
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="pensum"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>

      <!-- buttons -->
      <div
        class="mt-5 d-flex flex-column gap-3 flex-md-row justify-content-end"
      >
        <button type="submit" class="btn btn-primary">
          {{ 'gesuch-app.form.save-and-continue' | translate }}
        </button>
        <button
          type="button"
          class="btn btn-link"
          data-test-id="form-person-action-back"
          (click)="handleSaveAndBack()"
        >
          {{ 'gesuch-app.form.save-and-back' | translate }}
        </button>
      </div>
    </form>
  </div>
</div>
