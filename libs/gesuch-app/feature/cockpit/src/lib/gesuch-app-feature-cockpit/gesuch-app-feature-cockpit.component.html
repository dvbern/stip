<dv-gesuch-app-pattern-main-layout>
  <div class="bg-image">
    <div class="gray-bg"></div>
  </div>

  <div class="container mt-5 mb-5">
    <h1 class="text-white mb-4">
      {{
        'gesuch-app.cockpit.welcome.titel' | translate : { name: 'Anja Muster' }
      }}
    </h1>

    <div class="row">
      <!-- TODO: Remove once Fall handling exists -->
      <div class="mb-3">
        <div class="col-4 card p-3">
          <label>Fall ID:</label>
          <input
            type="text"
            title="DEBUG: Fall ID"
            #fallID
            (change)="setFallId(fallID.value)"
          />
        </div>
      </div>
      <!-- main column -->
      <div class="col-lg-8 mb-lg-5">
        <!-- progress -->
        <div *ngIf="cockpitView().loading" class="my-4">
          <div class="dv-progress-bar-indeterminate bg-dark">
            <div class="bg-light"></div>
          </div>
        </div>

        <!-- period 1-2 -->
        <div>
          <div
            class="card mb-5 shadow-lg"
            *ngFor="
              let periode of cockpitView().gesuchsperiodes;
              trackBy: trackByIndex
            "
            [class.col-md-6]="!periode.gesuchId"
            [class.col-md-12]="periode.gesuchId"
          >
            <div class="card-body">
              <div class="row">
                <div class="col-md">
                  <!-- Periode titel -->
                  <div class="card-title d-flex">
                    <dv-shared-ui-icon-chip
                      *ngIf="periode.semester === 'HERBST'"
                      style="background-color: #feefea; color: #fe7e55"
                      class="me-2"
                    >
                      <i class="material-symbols-rounded fs-5">eco</i>
                    </dv-shared-ui-icon-chip>
                    <dv-shared-ui-icon-chip
                      *ngIf="periode.semester === 'FRUEHLING'"
                      style="background-color: #eff7e0; color: #81be06"
                      class="me-2"
                    >
                      <i class="material-symbols-rounded fs-5">deceased</i>
                    </dv-shared-ui-icon-chip>

                    <div>
                      <div class="mt-1">
                        <h3 data-testid="cockpit-periode-title">
                          <span>{{
                            'gesuch-app.cockpit.gesuch.semester.' +
                              periode.semester.toLowerCase() | translate
                          }}</span>
                          <span>&nbsp;</span>
                          <span>{{ periode.yearsLabel }}</span>
                        </h3>
                      </div>
                      <h6 class="card-subtitle fw-medium mt-2 mb-2 small">
                        <span>{{
                          periode.gueltigAb | date : 'dd.MM.yyyy'
                        }}</span>
                        <span> - </span>
                        <span>{{
                          periode.gueltigBis | date : 'dd.MM.yyyy'
                        }}</span>
                      </h6>
                    </div>
                  </div>

                  <!-- loading Gesuch -->
                  <div
                    class="spinner-border text-primary my-4"
                    role="status"
                    *ngIf="periode.gesuchLoading"
                  >
                    <span class="visually-hidden">Loading...</span>
                  </div>

                  <!-- existing Gesuch (left) -->
                  <div
                    class="d-flex flex-column align-items-start"
                    *ngIf="periode.gesuchId"
                  >
                    <span class="mt-4 fw-normal small">{{
                      'gesuch-app.cockpit.periode.status.titel' | translate
                    }}</span>
                    <span class="fw-medium">{{
                      'gesuch-app.cockpit.periode.status.nicht_komplett'
                        | translate
                    }}</span>

                    <ng-container
                      *ngTemplateOutlet="
                        einreichefrist;
                        context: { periode: periode }
                      "
                    ></ng-container>
                  </div>
                </div>

                <!-- existing Gesuch (right pic) -->
                <div *ngIf="periode.gesuchId" class="col-md p-4">
                  <img
                    src="/assets/images/undraw_exams_re_4ios.svg"
                    [alt]="'gesuch-app.cockpit.gesuch.img.alt' | translate"
                    class="w-100"
                    style="max-width: 300px"
                  />
                </div>
              </div>

              <!-- existing Gesuch buttons -->
              <div class="row" *ngIf="periode.gesuchId">
                <div class="col-md">
                  <a
                    class="btn btn-primary mt-3 w-100"
                    data-testid="cockpit-gesuch-edit"
                    [routerLink]="[
                      '/gesuch-app-feature-gesuch-form-person',
                      periode.gesuchId
                    ]"
                  >
                    {{ 'gesuch-app.cockpit.gesuch.edit' | translate }}
                  </a>
                </div>

                <div class="col-md">
                  <a
                    class="btn btn-outline-primary mt-3 w-100"
                    data-testid="cockpit-gesuch-nachfrist"
                  >
                    {{ 'gesuch-app.cockpit.gesuch.nachfrist' | translate }}
                  </a>
                </div>
              </div>

              <!-- no Gesuch yet -->
              <div
                *ngIf="!periode.gesuchId && !periode.gesuchLoading"
                class="d-flex flex-column align-items-start"
              >
                <ng-container
                  *ngTemplateOutlet="
                    einreichefrist;
                    context: { periode: periode }
                  "
                ></ng-container>
                <div class="mb-3"></div>

                <button
                  type="button"
                  class="btn btn-primary mt-4 w-100"
                  (click)="handleCreate(periode)"
                >
                  {{ 'gesuch-app.cockpit.gesuch.new' | translate }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <ng-template #einreichefrist let-periode="periode">
        <span class="mt-4 fw-normal small">{{
          'gesuch-app.cockpit.periode.einreichfrist.titel' | translate
        }}</span>
        <span class="fw-medium" *ngIf="periode.einreichfrist">
          {{
            'gesuch-app.cockpit.periode.einreichfrist.spaetestens' | translate
          }}
          {{ periode.einreichfrist | date : 'dd.MM.yyyy' }}
        </span>
      </ng-template>

      <!-- side column -->
      <div class="col-lg-4 mb-lg-5">
        <!-- NACHRICHTEN -->
        <div class="card mb-5 shadow-lg">
          <div class="card-body">
            <h3
              class="card-title d-flex align-items-center"
              data-testid="cockpit-nachrichten-title"
            >
              <dv-shared-ui-icon-chip
                style="background-color: #e6f9fd; color: #07c6e0"
                class="me-2"
              >
                <i class="material-symbols-rounded fs-5">mail</i>
              </dv-shared-ui-icon-chip>
              <span>Nachrichten</span>
            </h3>
          </div>
        </div>

        <!-- INFOS -->
        <div class="card mb-5 shadow-lg">
          <div class="card-body">
            <h3 class="card-title mb-4">Allgemeine Informationen</h3>
            <p class="card-text">
              Die Informationsbroschüre Stipendien und Darlehen gibt eine kurze
              Übersicht, auf welcher Basis Ausbildungsbeiträge ausgerichtet
              werden. Ausserdem werden Sie darüber informiert, wie bei der
              Gesuchseinreichung vorzugehen ist, welche Voraussetzungen für ein
              Stipendium oder Darlehen zu erfüllen sind und weitere nützliche
              Grundlagen.
            </p>
            <a class="btn btn-outline-primary mt-3 w-100">
              Stipendien und Darlehen
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MOBILE NAV -->
  <div class="mobile-nav-header">
    <dv-shared-ui-language-selector
      [language]="languageSig()"
      (languageChange)="handleLanguageChangeHeader($event)"
    />
  </div>
  <div class="mobile-nav-content">
    <div class="d-flex flex-column align-items-start">
      <ul class="nav flex-column w-100">
        <li class="nav-item">
          <span class="nav-link mb-4">Armin Student</span>
        </li>

        <li class="nav-item">
          <a class="nav-link">Profil</a>
        </li>
        <li class="nav-item">
          <a class="nav-link">Logout</a>
        </li>
      </ul>
    </div>
  </div>

  <!-- DESKTOP HEADER (LEFT) -->
  <div class="header-desktop-left d-flex flex-grow-1 ms-3">
    <div class="d-flex gap-3 align-items-center">
      <a
        routerLink="/"
        class="btn btn-warning fw-normal px-2 d-flex align-items-center shadow-none"
        data-testid="cockpit-nav-dashboard"
      >
        <i class="material-symbols-rounded text-white me-2">dashboard</i>
        <span>Dashboard</span>
      </a>
    </div>
  </div>

  <!-- DESKTOP HEADER (RIGHT) -->
  <div class="header-desktop-right d-flex gap-4 align-items-center">
    <dv-shared-ui-language-selector
      class="p-3"
      [language]="languageSig()"
      (languageChange)="handleLanguageChangeHeader($event)"
    />

    <div ngbDropdown>
      <button
        type="button"
        class="btn btn-light btn-nav shadow-none d-flex align-items-center pe-1"
        id="userMenu"
        ngbDropdownToggle
      >
        <span>Armin Student</span>
        <i class="material-symbols-rounded ms-2">expand_more</i>
      </button>

      <div ngbDropdownMenu aria-labelledby="userMenu">
        <button type="button" ngbDropdownItem>Profil</button>
        <button type="button" ngbDropdownItem>Logout</button>
      </div>
    </div>
  </div>
</dv-gesuch-app-pattern-main-layout>
