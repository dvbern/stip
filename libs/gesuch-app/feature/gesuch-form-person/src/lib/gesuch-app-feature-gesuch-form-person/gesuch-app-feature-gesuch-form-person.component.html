<dv-gesuch-app-pattern-gesuch-step-layout [step]="GesuchFormSteps.PERSON">
  <div>
    <!-- loading -->
    <div
      data-testid="form-person-loading"
      *ngIf="view().loading"
      class="my-2 p-2 py-4 d-flex rounded shadow-sm border"
    >
      <div class="dv-progress-bar-indeterminate">
        <div></div>
      </div>
    </div>

    <form
      [formGroup]="form"
      novalidate
      class="mt-4"
      *ngIf="!view().loading"
      (ngSubmit)="handleSave()"
    >
      <!-- AHV -->
      <div class="row g-4">
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.shared.social-insurance-number.label' | translate
          }}</dv-shared-ui-form-label>
          <input
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="sozialversicherungsnummer"
            placeholder="756.xxxx.xxxx.xx"
            [maskito]="MASK_SOZIALVERSICHERUNGSNUMMER"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageInfo>
            {{
              'gesuch-app.form.shared.social-insurance-number.info' | translate
            }}
          </dv-shared-ui-form-message>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'ahv'">
            {{ 'shared.form.error.ahv' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>

      <h3 class="pt-5">
        {{ 'gesuch-app.form.shared.section.personal-details' | translate }}
      </h3>

      <div class="row g-4">
        <!-- Anrede -->
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.salutation.label' | translate
          }}</dv-shared-ui-form-label>
          <select
            class="form-select"
            dvSharedUiFormLabelTarget
            formControlName="anrede"
          >
            <option [ngValue]="null" disabled selected>
              {{ 'shared.form.select.empty' | translate }}
            </option>
            <option
              [ngValue]="a"
              *ngFor="let a of anredeValues; trackBy: trackByIndex"
            >
              {{
                'shared.form.select.salutation.' + (a | lowercase) | translate
              }}
            </option>
          </select>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <!-- Name -->
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.shared.lastname.label' | translate
          }}</dv-shared-ui-form-label>
          <input
            data-testid="form-person-name"
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="nachname"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>
      <div class="row g-4 mt-1">
        <!-- Vorname -->
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.shared.firstname.label' | translate
          }}</dv-shared-ui-form-label>
          <input
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="vorname"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>

      <!-- Adresse -->
      <div class="row g-4 mt-1">
        <dv-shared-ui-form-address
          class="col-12 col-xl-8"
          [group]="form.controls.adresse"
          [laender]="laenderSig()"
          [language]="languageSig()"
        />
      </div>

      <div class="row g-4 mt-1">
        <!-- Wohnsitz -->
        <dv-shared-ui-form-field
          class="col-12 col-md-6 col-xl-4"
          [isCheckbox]="true"
        >
          <dv-shared-ui-form-label
            >{{
              'gesuch-app.form.shared.identical-civil-residence.label'
                | translate
            }}
          </dv-shared-ui-form-label>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              dvSharedUiFormLabelTarget
              formControlName="identischerZivilrechtlicherWohnsitz"
            />
          </div>
        </dv-shared-ui-form-field>
      </div>
      <!-- alternative civil residence -->
      <div
        class="row g-4 mt-1"
        *ngIf="!form.value.identischerZivilrechtlicherWohnsitz"
      >
        <div class="col-12 col-xl-8">
          <label class="mb-2">{{
            'gesuch-app.form.shared.alternative-civil-residence.title'
              | translate
          }}</label>
          <div class="row g-4">
            <!-- PLZ -->
            <dv-shared-ui-form-field class="col-5 col-md-4 col-xl-3">
              <dv-shared-ui-form-label
                >{{
                  'gesuch-app.form.shared.address.zipcode.label' | translate
                }}
              </dv-shared-ui-form-label>
              <input
                class="form-control"
                type="text"
                dvSharedUiFormLabelTarget
                formControlName="identischerZivilrechtlicherWohnsitzPLZ"
              />
              <dv-shared-ui-form-message
                *dvSharedUiFormMessageError="'required'"
              >
                {{ 'shared.form.error.required' | translate }}
              </dv-shared-ui-form-message>
            </dv-shared-ui-form-field>

            <!-- Ort -->
            <dv-shared-ui-form-field class="col-7 col-md-8 col-xl-9">
              <dv-shared-ui-form-label
                >{{ 'gesuch-app.form.shared.address.city.label' | translate }}
              </dv-shared-ui-form-label>
              <input
                class="form-control"
                type="text"
                dvSharedUiFormLabelTarget
                formControlName="identischerZivilrechtlicherWohnsitzOrt"
              />
              <dv-shared-ui-form-message
                *dvSharedUiFormMessageError="'required'"
              >
                {{ 'shared.form.error.required' | translate }}
              </dv-shared-ui-form-message>
            </dv-shared-ui-form-field>
          </div>
        </div>
      </div>

      <!-- Weitere Angaben -->
      <h3 class="pt-5">
        {{
          'gesuch-app.form.person.section.additional-information' | translate
        }}
      </h3>

      <div class="row g-4">
        <!-- E-MAIL -->
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.email.label' | translate
          }}</dv-shared-ui-form-label>
          <input
            class="form-control"
            type="email"
            dvSharedUiFormLabelTarget
            formControlName="email"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'pattern'">
            {{ 'shared.form.error.email' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <!-- TEL -->
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.shared.phone.label' | translate
          }}</dv-shared-ui-form-label>
          <input
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="telefonnummer"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
          <dv-shared-ui-form-message
            *dvSharedUiFormMessageError="'telefonnummer'"
          >
            {{ 'shared.form.error.telefonnummer' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>

      <div class="row g-4 mt-1">
        <!-- GEBURTSDATUM -->
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.shared.birthday.label' | translate
          }}</dv-shared-ui-form-label>

          <input
            class="form-control"
            placeholder="dd.mm.yyyy"
            dvSharedUiFormLabelTarget
            formControlName="geburtsdatum"
            (blur)="onGeburtsdatumBlur()"
          />

          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'dateFormat'">
            {{ 'shared.form.error.dateFormat' | translate }}
          </dv-shared-ui-form-message>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'minDate'">
            {{ 'shared.form.error.minDatePast' | translate }}
          </dv-shared-ui-form-message>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'maxDate'">
            {{ 'shared.form.error.maxDatePast' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <!-- NATIONALITAET -->
        <dv-shared-ui-form-country
          class="col-12 col-md-6 col-xl-4"
          formControlName="nationalitaet"
          [labelText]="'gesuch-app.form.person.nationality.label' | translate"
          [laender]="laenderSig()"
        ></dv-shared-ui-form-country>

        <!-- Auslaenderausweis -->
        <div
          class="col-12 col-md-6 col-xl-4"
          *ngIf="form.controls.nationalitaet.value !== nationalitaetCH"
        >
          <div class="rounded-3 bg-white shadow p-4">
            <h4>
              {{ 'gesuch-app.form.person.auslaenderausweis' | translate }}
            </h4>
            <dv-shared-pattern-document-upload
              *ngIf="view().gesuch"
              [options]="auslaenderausweisDocumentOptions()"
            />
          </div>
        </div>
      </div>

      <div class="row g-4 mt-1">
        <!-- NIEDERLASSUNGSSTATUS ODER HEIMATORT -->
        <div *ngIf="form.controls.niederlassungsstatus.enabled">
          <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
            <dv-shared-ui-form-label>{{
              'gesuch-app.form.person.niederlassungsstatus.label' | translate
            }}</dv-shared-ui-form-label>

            <select
              class="form-select"
              dvSharedUiFormLabelTarget
              formControlName="niederlassungsstatus"
            >
              <option [ngValue]="null" disabled selected>
                {{ 'shared.form.select.empty' | translate }}
              </option>
              <option
                [ngValue]="n"
                *ngFor="
                  let n of niederlassungsStatusValues;
                  trackBy: trackByIndex
                "
              >
                {{
                  'gesuch-app.form.person.niederlassungsstatus.' + n | translate
                }}
              </option>
            </select>

            <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | translate }}
            </dv-shared-ui-form-message>
          </dv-shared-ui-form-field>
        </div>
        <div *ngIf="form.controls.heimatort.enabled">
          <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
            <dv-shared-ui-form-label>{{
              'gesuch-app.form.person.origin.label' | translate
            }}</dv-shared-ui-form-label>
            <input
              class="form-control"
              type="text"
              dvSharedUiFormLabelTarget
              formControlName="heimatort"
            />
            <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | translate }}
            </dv-shared-ui-form-message>
          </dv-shared-ui-form-field>
        </div>
        <!-- VORMUNDSCHAFT -->
        <dv-shared-ui-form-field
          class="col-12 col-md-6 col-xl-4"
          [isCheckbox]="true"
          *ngIf="form.controls.nationalitaet.value === nationalitaetCH"
        >
          <dv-shared-ui-form-label
            >{{ 'gesuch-app.form.person.guardianship.label' | translate }}
          </dv-shared-ui-form-label>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              dvSharedUiFormLabelTarget
              formControlName="vormundschaft"
            />
          </div>
        </dv-shared-ui-form-field>
      </div>
      <div class="row g-4 mt-1">
        <!-- ZIVILSTAND -->
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.marital-status.label' | translate
          }}</dv-shared-ui-form-label>
          <select
            class="form-select"
            dvSharedUiFormLabelTarget
            formControlName="zivilstand"
          >
            <option [ngValue]="null" disabled selected>
              {{ 'shared.form.select.empty' | translate }}
            </option>
            <option
              [ngValue]="z"
              *ngFor="let z of zivilstandValues; trackBy: trackByIndex"
            >
              {{ 'gesuch-app.form.person.zivilstand.' + z | translate }}
            </option>
          </select>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <!-- Wohnsitz -->
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.shared.wohnsitz.label' | translate
          }}</dv-shared-ui-form-label>
          <select
            class="form-select"
            dvSharedUiFormLabelTarget
            formControlName="wohnsitz"
          >
            <option [ngValue]="null" disabled selected>
              {{ 'shared.form.select.empty' | translate }}
            </option>
            <option
              [ngValue]="z"
              *ngFor="let z of wohnsitzValues; trackBy: trackByIndex"
            >
              {{ 'gesuch-app.form.shared.wohnsitz.' + z | translate }}
            </option>
          </select>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <!-- Info Konkubinat -->
        <div class="col-12 col-md-6 col-xl-4">
          <ngb-alert
            type="info"
            [dismissible]="false"
            *ngIf="form.get('zivilstand')?.value === Zivilstand.LEDIG"
          >
            <div class="d-flex gap-3">
              <span class="material-symbols-rounded text-info"> info </span>
              <span>{{
                'gesuch-app.form.person.marital-status.ledig.info' | translate
              }}</span>
            </div>
          </ngb-alert>
        </div>
      </div>

      <!-- WOHNSITZ AUFTEILUNG -->
      <div class="row g-4 my-2" *ngIf="showWohnsitzSplitterSig()">
        <div class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-wohnsitz-splitter
            [controls]="form.controls"
          ></dv-shared-ui-wohnsitz-splitter>
        </div>
      </div>

      <div class="row g-4 mt-1">
        <!-- Quellenbesteuerung -->
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.tax-at-source.label' | translate
          }}</dv-shared-ui-form-label>
          <div class="form-check">
            <input
              formControlName="quellenbesteuert"
              [value]="true"
              class="form-check-input"
              type="radio"
              name="quellenbesteuert"
              id="quellenbesteuertJa"
            />
            <label class="form-check-label" for="quellenbesteuertJa">
              {{ 'shared.form.radio.yes' | translate }}
            </label>
          </div>
          <div class="form-check">
            <input
              formControlName="quellenbesteuert"
              [value]="false"
              class="form-check-input"
              type="radio"
              name="quellenbesteuert"
              id="quellenbesteuertNein"
            />
            <label class="form-check-label" for="quellenbesteuerungNein">
              {{ 'shared.form.radio.no' | translate }}
            </label>
          </div>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <!-- Sozialhilfebeitraege -->
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.social-security.label' | translate
          }}</dv-shared-ui-form-label>
          <div class="form-check">
            <input
              formControlName="sozialhilfebeitraege"
              [value]="true"
              class="form-check-input"
              type="radio"
              name="sozialhilfebeitraege"
              id="sozialhilfebeitraegeJa"
            />
            <label class="form-check-label" for="sozialhilfebeitraegeJa">
              {{ 'shared.form.radio.yes' | translate }}
            </label>
          </div>
          <div class="form-check">
            <input
              formControlName="sozialhilfebeitraege"
              [value]="false"
              class="form-check-input"
              type="radio"
              name="sozialhilfebeitraege"
              id="sozialhilfebeitraegeNein"
            />
            <label class="form-check-label" for="sozialhilfebeitraegeNein">
              {{ 'shared.form.radio.no' | translate }}
            </label>
          </div>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>
      <div class="row g-4 mt-1">
        <!-- KorrespondenzSprache -->
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.korrespondenzSprache.label' | translate
          }}</dv-shared-ui-form-label>
          <div
            class="form-check"
            *ngFor="let s of spracheValues; trackBy: trackByIndex"
          >
            <input
              formControlName="korrespondenzSprache"
              [value]="s"
              class="form-check-input"
              type="radio"
              name="korrespondenzSprache"
              [id]="'korrespondenzSprache' + s"
            />
            <label class="form-check-label" [for]="'korrespondenzSprache' + s">
              {{
                'gesuch-app.form.person.korrespondenzSprache.' + s | translate
              }}
            </label>
          </div>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>

      <div class="row g-4 mt-1">
        <!-- digitale Kommunikation -->
        <dv-shared-ui-form-field
          class="col-12 col-md-6 col-xl-4"
          [isCheckbox]="true"
        >
          <dv-shared-ui-form-label
            >{{
              'gesuch-app.form.person.digital-communication.label' | translate
            }}
          </dv-shared-ui-form-label>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              dvSharedUiFormLabelTarget
              formControlName="digitaleKommunikation"
            />
          </div>
        </dv-shared-ui-form-field>
      </div>

      <!-- Buttons -->
      <dv-gesuch-app-ui-step-form-buttons>
        <button type="submit" class="btn btn-primary">
          {{ 'gesuch-app.form.save-and-continue' | translate }}
        </button>
      </dv-gesuch-app-ui-step-form-buttons>
    </form>
  </div>
</dv-gesuch-app-pattern-gesuch-step-layout>
