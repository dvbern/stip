<div class="container mt-5 mb-5">
  <div
    class="d-flex align-items-center justify-content-between border-bottom border-3 mb-4"
  >
    <dv-gesuch-app-pattern-gesuch-form-steps />
    <div class="text-end">
      <h2>{{ 'gesuch-app.form.person.title' | translate }}</h2>
      <p class="fs-5 fst-italic">
        {{ 'gesuch-app.form.next' | translate }}:
        {{ 'gesuch-app.form.education.title' | translate }}
      </p>
    </div>
  </div>

  <div>
    <div
      data-test-id="form-person-loading"
      *ngIf="view().loading"
      class="my-2 p-2 py-4 d-flex rounded shadow-sm border"
    >
      <div class="dv-progress-bar-indeterminate">
        <div></div>
      </div>
    </div>

    <form
      [formGroup]="form"
      novalidate
      class="mt-4"
      *ngIf="!view().loading"
      (ngSubmit)="handleSaveAndContinue()"
    >
      <div class="row g-4">
        <dv-shared-ui-form-field class="col-12">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.social-insurance-number.label' | translate
          }}</dv-shared-ui-form-label>
          <input
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="sozialversicherungsnummer"
            placeholder="756.xxxx.xxxx.xx"
            [maskito]="MASK_SOZIALVERSICHERUNGSNUMMER"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageInfo>
            {{
              'gesuch-app.form.person.social-insurance-number.info' | translate
            }}
          </dv-shared-ui-form-message>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'ahv'">
            {{ 'shared.form.error.ahv' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>

      <h3 class="py-4">
        {{ 'gesuch-app.form.person.section.personal-details' | translate }}
      </h3>

      <div class="row g-4">
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.salutation.label' | translate
          }}</dv-shared-ui-form-label>
          <select
            class="form-select"
            dvSharedUiFormLabelTarget
            formControlName="anrede"
          >
            <option [value]="null" disabled selected>
              {{ 'shared.form.select.empty' | translate }}
            </option>
            <option
              [value]="a.value"
              *ngFor="let a of Anrede | keyvalue; trackBy: trackByIndex"
            >
              {{
                'shared.form.select.salutation.' + (a.value | lowercase)
                  | translate
              }}
            </option>
          </select>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.lastname.label' | translate
          }}</dv-shared-ui-form-label>
          <input
            data-test-id="form-person-name"
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="name"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.firstname.label' | translate
          }}</dv-shared-ui-form-label>
          <input
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="vorname"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>

      <div class="row g-4 mt-3" formGroupName="addresse">
        <dv-shared-ui-form-field class="col-12">
          <dv-shared-ui-form-label
            >{{ 'gesuch-app.form.person.address.co.label' | translate }} ({{
              'shared.form.optional.label' | translate
            }})
          </dv-shared-ui-form-label>
          <input
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="coAdresse"
          />
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field class="col-9 col-xl-4">
          <dv-shared-ui-form-label
            >{{ 'gesuch-app.form.person.address.street.label' | translate }}
          </dv-shared-ui-form-label>
          <input
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="strasse"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field class="col-3 col-xl-2">
          <dv-shared-ui-form-label
            >{{ 'gesuch-app.form.person.address.number.label' | translate }}
          </dv-shared-ui-form-label>
          <input
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="nummer"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field class="col-3 col-xl-2">
          <dv-shared-ui-form-label
            >{{ 'gesuch-app.form.person.address.zipcode.label' | translate }}
          </dv-shared-ui-form-label>
          <input
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="plz"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field class="col-9 col-xl-4">
          <dv-shared-ui-form-label
            >{{ 'gesuch-app.form.person.address.city.label' | translate }}
          </dv-shared-ui-form-label>
          <input
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="ort"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field class="col-12 col-xl-6">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.address.country.label' | translate
          }}</dv-shared-ui-form-label>
          <select
            class="form-select"
            dvSharedUiFormLabelTarget
            formControlName="land"
          >
            <option [value]="null" disabled selected>
              {{ 'shared.form.select.empty' | translate }}
            </option>
            <option
              [value]="l.value"
              *ngFor="let l of Land | keyvalue; trackBy: trackByIndex"
            >
              {{ l.value }}
            </option>
          </select>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>
      </div>

      <div class="row g-4">
        <dv-shared-ui-form-field class="col-12" [isCheckbox]="true">
          <dv-shared-ui-form-label
            >{{
              'gesuch-app.form.person.identical-civil-residence.label'
                | translate
            }}
          </dv-shared-ui-form-label>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              dvSharedUiFormLabelTarget
              formControlName="identischerZivilrechtlicherWohnsitz"
            />
          </div>
        </dv-shared-ui-form-field>
      </div>

      <h3 class="py-4">
        {{
          'gesuch-app.form.person.section.additional-information' | translate
        }}
      </h3>

      <div class="row g-4">
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.email.label' | translate
          }}</dv-shared-ui-form-label>
          <input
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="email"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.phone.label' | translate
          }}</dv-shared-ui-form-label>
          <input
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="telefonnummer"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.birthday.label' | translate
          }}</dv-shared-ui-form-label>

          <div class="input-group">
            <input
              class="form-control"
              placeholder="dd.mm.yyyy"
              dvSharedUiFormLabelTarget
              formControlName="geburtsdatum"
              ngbDatepicker
              [minDate]="geburtsdatumMinDate"
              [maxDate]="geburtsdatumMaxDate"
              #geburtsdatum="ngbDatepicker"
            />
            <button
              (click)="geburtsdatum.toggle()"
              class="btn btn-outline-secondary position-relative"
              type="button"
            >
              <span
                class="material-symbols-rounded position-absolute translate-middle"
              >
                calendar_month
              </span>
            </button>
          </div>

          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.nationality.label' | translate
          }}</dv-shared-ui-form-label>
          <select
            class="form-select"
            dvSharedUiFormLabelTarget
            formControlName="nationalitaet"
          >
            <option [value]="null" disabled selected>
              {{ 'shared.form.select.empty' | translate }}
            </option>
            <option
              [value]="l.value"
              *ngFor="let l of Land | keyvalue; trackBy: trackByIndex"
            >
              {{ l.value }}
            </option>
          </select>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.origin.label' | translate
          }}</dv-shared-ui-form-label>
          <input
            class="form-control"
            type="text"
            dvSharedUiFormLabelTarget
            formControlName="heimatort"
          />
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field
          class="col-12 col-md-6 col-xl-4"
          [isCheckbox]="true"
        >
          <dv-shared-ui-form-label
            >{{ 'gesuch-app.form.person.guardianship.label' | translate }}
          </dv-shared-ui-form-label>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              dvSharedUiFormLabelTarget
              formControlName="vormundschaft"
            />
          </div>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.marital-status.label' | translate
          }}</dv-shared-ui-form-label>
          <select
            class="form-select"
            dvSharedUiFormLabelTarget
            formControlName="zivilstand"
          >
            <option [value]="null" disabled selected>
              {{ 'shared.form.select.empty' | translate }}
            </option>
            <option
              [value]="z.value"
              *ngFor="let z of Zivilstand | keyvalue; trackBy: trackByIndex"
            >
              {{ z.value }}
            </option>
          </select>
          <dv-shared-ui-form-message *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </dv-shared-ui-form-message>
          <ngb-alert
            dvSharedUiFormFieldExtraContent
            type="info"
            class="mt-2"
            [dismissible]="false"
            *ngIf="form.get('zivilstand')?.value === Zivilstand.LEDIG"
          >
            <div class="d-flex gap-3">
              <span class="material-symbols-rounded text-info"> info </span>
              <span>{{
                'gesuch-app.form.person.marital-status.ledig.info' | translate
              }}</span>
            </div>
          </ngb-alert>
        </dv-shared-ui-form-field>
      </div>

      <div class="row g-4 mt-3">
        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.children.label' | translate
          }}</dv-shared-ui-form-label>
          <div class="form-check">
            <input
              formControlName="kinder"
              [value]="true"
              class="form-check-input"
              type="radio"
              name="kinder"
              id="kinderJa"
            />
            <label class="form-check-label" for="kinderJa">
              {{ 'shared.form.radio.yes' | translate }}
            </label>
          </div>
          <div class="form-check">
            <input
              formControlName="kinder"
              [value]="false"
              class="form-check-input"
              type="radio"
              name="kinder"
              id="kinderNein"
            />
            <label class="form-check-label" for="kinderNein">
              {{ 'shared.form.radio.no' | translate }}
            </label>
          </div>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.social-security.label' | translate
          }}</dv-shared-ui-form-label>
          <div class="form-check">
            <input
              formControlName="sozialhilfebeitraege"
              [value]="true"
              class="form-check-input"
              type="radio"
              name="sozialhilfebeitraege"
              id="sozialhilfebeitraegeJa"
            />
            <label class="form-check-label" for="sozialhilfebeitraegeJa">
              {{ 'shared.form.radio.yes' | translate }}
            </label>
          </div>
          <div class="form-check">
            <input
              formControlName="sozialhilfebeitraege"
              [value]="false"
              class="form-check-input"
              type="radio"
              name="sozialhilfebeitraege"
              id="sozialhilfebeitraegeNein"
            />
            <label class="form-check-label" for="sozialhilfebeitraegeNein">
              {{ 'shared.form.radio.no' | translate }}
            </label>
          </div>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field class="col-12 col-md-6 col-xl-4">
          <dv-shared-ui-form-label>{{
            'gesuch-app.form.person.tax-at-source.label' | translate
          }}</dv-shared-ui-form-label>
          <div class="form-check">
            <input
              formControlName="quellenbesteuerung"
              [value]="true"
              class="form-check-input"
              type="radio"
              name="quellenbesteuerung"
              id="quellenbesteuerungJa"
            />
            <label class="form-check-label" for="quellenbesteuerungJa">
              {{ 'shared.form.radio.yes' | translate }}
            </label>
          </div>
          <div class="form-check">
            <input
              formControlName="quellenbesteuerung"
              [value]="false"
              class="form-check-input"
              type="radio"
              name="quellenbesteuerung"
              id="quellenbesteuerungNein"
            />
            <label class="form-check-label" for="quellenbesteuerungNein">
              {{ 'shared.form.radio.no' | translate }}
            </label>
          </div>
        </dv-shared-ui-form-field>

        <dv-shared-ui-form-field
          class="col-12 col-md-6 col-xl-4"
          [isCheckbox]="true"
        >
          <dv-shared-ui-form-label
            >{{
              'gesuch-app.form.person.digital-communication.label' | translate
            }}
          </dv-shared-ui-form-label>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              dvSharedUiFormLabelTarget
              formControlName="digitaleKommunikation"
            />
          </div>
          <ngb-alert
            dvSharedUiFormFieldExtraContent
            type="info"
            class="mt-2"
            [dismissible]="false"
            *ngIf="form.get('digitaleKommunikation')?.value === false"
          >
            <div class="d-flex gap-3">
              <span class="material-symbols-rounded text-info"> info </span>
              <span>{{
                'gesuch-app.form.person.marital-status.ledig.info' | translate
              }}</span>
            </div>
          </ngb-alert>
        </dv-shared-ui-form-field>
      </div>

      <div
        class="mt-5 d-flex flex-column gap-3 flex-md-row justify-content-end"
      >
        <button type="submit" class="btn btn-primary">
          {{ 'gesuch-app.form.save-and-continue' | translate }}
        </button>
        <button
          type="button"
          class="btn btn-link"
          data-test-id="form-person-action-back"
          (click)="handleSaveAndBack()"
        >
          {{ 'gesuch-app.form.save-and-back' | translate }}
        </button>
      </div>
    </form>
  </div>
</div>
