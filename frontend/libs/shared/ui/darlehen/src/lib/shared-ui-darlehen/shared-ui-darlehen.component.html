<!-- loading -->
@if (false) {
  <dv-shared-ui-loading data-testid="form-darlehen-loading"></dv-shared-ui-loading>
} @else {
  <form [formGroup]="form" novalidate data-testid="form-darlehen-form">
    <!-- sachbearbeiter fields -->
    <div class="tw:dv-form-half" *dvIfSachbearbeiter>
      <!-- darlehenGewaehren mat-radio-group -->
      <!-- todo: change to [formcontrol] -->
      <mat-radio-group
        class="tw:w-full"
        formControlName="darlehenGewaehren"
        data-testid="form-darlehen-darlehenGewaehren"
        dvSharedUiFormField
      >
        <div class="tw:flex tw:w-full">
          <mat-label>{{ 'shared.form.darlehen.darlehenGewaehren.label' | transloco }}</mat-label>
        </div>
        <div class="tw:flex tw:justify-between tw:flex-col tw:w-full tw:gap-2">
          @for (value of [true, false]; track $index) {
            <mat-radio-button [value]="value">{{
              'shared.form.darlehen.darlehenGewaehren.' + value | transloco
            }}</mat-radio-button>
          }
        </div>
        <div class="group-errors">
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | transloco }}
          </mat-error>
        </div>
      </mat-radio-group>

      <!-- darlehensBetrag  -->
      <mat-form-field dvSharedUiFormField class="tw:w-full">
        <mat-label>{{ 'shared.form.darlehen.betragDarlehen.label' | transloco }}</mat-label>
        <input
          formControlName="betragDarlehen"
          data-testid="form-darlehen-betragDarlehen"
          matInput
          type="text"
          [maskito]="maskitoNumber"
        />

        <mat-error *dvSharedUiFormMessageError="'required'">
          {{ 'shared.form.error.required' | transloco }}
        </mat-error>
      </mat-form-field>

      <!-- kommentar  -->
      <mat-form-field dvSharedUiFormField class="tw:w-full">
        <mat-label>{{ 'shared.form.darlehen.kommentar.label' | transloco }}</mat-label>
        <textarea formControlName="kommentar" data-testid="form-darlehen-kommentar" matInput rows="4"></textarea>

        <mat-error *dvSharedUiFormMessageError="'maxlength'">
          {{ 'shared.form.error.maxlength' | transloco: { max: 500 } }}
        </mat-error>
      </mat-form-field>
      <hr class="tw:my-6 tw:border-t tw:border-gray-400" />
    </div>

    <div class="tw:mt-10 tw:dv-form-half">
      <!-- Darlehensbetrag -->
      <mat-form-field dvSharedUiFormField class="tw:w-full">
        <mat-label>{{ 'shared.form.darlehen.betragDarlehenGewuenscht.label' | transloco }}</mat-label>
        <input
          formControlName="betragDarlehenGewuenscht"
          data-testid="form-darlehen-betragDarlehenGewuenscht"
          matInput
          type="text"
          [maskito]="maskitoNumber"
        />

        <mat-error *dvSharedUiFormMessageError="'required'">
          {{ 'shared.form.error.required' | transloco }}
        </mat-error>
      </mat-form-field>

      <!-- betragBezogenKanton -->
      <mat-form-field dvSharedUiFormField class="tw:w-full">
        <mat-label>{{ 'shared.form.darlehen.betragBezogenKanton.label' | transloco }}</mat-label>
        <input
          formControlName="betragBezogenKanton"
          data-testid="form-darlehen-betragBezogenKanton"
          matInput
          type="text"
          [maskito]="maskitoNumber"
        />

        <mat-error *dvSharedUiFormMessageError="'required'">
          {{ 'shared.form.error.required' | transloco }}
        </mat-error>
      </mat-form-field>

      <!-- schulden -->
      <mat-form-field dvSharedUiFormField class="tw:w-full">
        <mat-label>{{ 'shared.form.darlehen.schulden.label' | transloco }}</mat-label>
        <input
          formControlName="schulden"
          data-testid="form-darlehen-schulden"
          matInput
          type="text"
          [maskito]="maskitoNumber"
        />

        <mat-error *dvSharedUiFormMessageError="'required'">
          {{ 'shared.form.error.required' | transloco }}
        </mat-error>
      </mat-form-field>

      <!-- anzahlBetreibungen mit upload-->
      <div class="tw:flex tw:w-full tw:gap-2">
        <mat-form-field dvSharedUiFormField class="tw:w-full">
          <mat-label>{{ 'shared.form.darlehen.anzahlBetreibungen.label' | transloco }}</mat-label>
          <input
            formControlName="anzahlBetreibungen"
            data-testid="form-darlehen-anzahlBetreibungen"
            matInput
            type="number"
            min="0"
          />

          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | transloco }}
          </mat-error>
        </mat-form-field>
        @if (anzahlBetreibungenDocSig(); as options) {
          <dv-shared-pattern-document-upload
            class="flex-shrink-1"
            [optionsSig]="options"
          ></dv-shared-pattern-document-upload>
        }
      </div>

      <fieldset
        class="tw:col-span-2 tw:grid tw:grid-cols-[1fr_56px] tw:gap-x-6 tw:gap-y-4 tw:rounded-sm"
        formGroupName="gruende"
      >
        <legend class="tw:col-span-2">
          <h3 class="tw:!mb-0">
            {{ 'shared.form.darlehen.gruende.label' | transloco }}
          </h3>
        </legend>
        <!-- grundNichtBerechtigt -->
        <div class="tw:col-span-1 tw:col-start-1 tw:min-h-14">
          <mat-checkbox
            class="tw:w-full"
            formControlName="grundNichtBerechtigt"
            data-testid="form-darlehen-grundNichtBerechtigt"
          >
            {{ 'shared.form.darlehen.grundNichtBerechtigt.label' | transloco }}
          </mat-checkbox>
        </div>
        @if (grundNichtBerechtigtDocSig(); as options) {
          <dv-shared-pattern-document-upload
            class="flex-shrink-1"
            [optionsSig]="options"
          ></dv-shared-pattern-document-upload>
        }

        <!-- grundAusbildungZwoelfJahre -->
        <div class="tw:col-span-1 tw:col-start-1 tw:min-h-14">
          <mat-checkbox
            class="tw:w-full"
            formControlName="grundAusbildungZwoelfJahre"
            data-testid="form-darlehen-grundAusbildungZwoelfJahre"
          >
            {{ 'shared.form.darlehen.grundAusbildungZwoelfJahre.label' | transloco }}
          </mat-checkbox>
        </div>

        <!-- grundHoheGebuehren -->
        <div class="tw:col-span-1 tw:col-start-1 tw:min-h-14">
          <mat-checkbox
            class="tw:w-full"
            formControlName="grundHoheGebuehren"
            data-testid="form-darlehen-grundHoheGebuehren"
          >
            {{ 'shared.form.darlehen.grundHoheGebuehren.label' | transloco }}
          </mat-checkbox>
        </div>
        @if (grundHoheGebuehrenDocSig(); as options) {
          <dv-shared-pattern-document-upload
            class="flex-shrink-1"
            [optionsSig]="options"
          ></dv-shared-pattern-document-upload>
        }

        <!-- grundAnschaffungenFuerAusbildung -->
        <div class="tw:col-span-1 tw:col-start-1 tw:min-h-14">
          <mat-checkbox
            class="tw:w-full"
            formControlName="grundAnschaffungenFuerAusbildung"
            data-testid="form-darlehen-grundAnschaffungenFuerAusbildung"
          >
            {{ 'shared.form.darlehen.grundAnschaffungenFuerAusbildung.label' | transloco }}
          </mat-checkbox>
        </div>
        @if (grundAnschaffungenFuerAusbildungDocSig(); as options) {
          <dv-shared-pattern-document-upload
            class="flex-shrink-1"
            [optionsSig]="options"
          ></dv-shared-pattern-document-upload>
        }

        <!-- grundZweitausbildung -->
        <div class="tw:col-span-1 tw:col-start-1 tw:min-h-14">
          <mat-checkbox
            class="tw:w-full"
            formControlName="grundZweitausbildung"
            data-testid="form-darlehen-grundZweitausbildung"
          >
            {{ 'shared.form.darlehen.grundZweitausbildung.label' | transloco }}
          </mat-checkbox>
        </div>
      </fieldset>
    </div>

    <!-- Buttons -->
    <dv-shared-ui-step-form-buttons class="tw:col-span-2">
      <button type="button" data-testid="darlehen-cancel" (click)="onCancel()" class="btn btn-secondary">
        {{ 'shared.cancel' | transloco }}
      </button>
      <button type="submit" (click)="darlehenCreate()" class="btn btn-primary" data-testid="button-create-darlehen">
        {{ 'shared.form.darlehen.create' | transloco }}
      </button>
      <!-- sachbearbeiter -->
      <button
        type="button"
        data-testid="button-darlehen-freigeben"
        (click)="darlehenFreigeben()"
        class="btn btn-primary"
      >
        {{ 'shared.form.darlehen.freigeben' | transloco }}
      </button>
      <!-- button akzeptieren (Freigabestelle ) was wenn sb auch freigabestelle hat? -->
      <button
        type="button"
        data-testid="button-darlehen-akzeptieren"
        (click)="darlehenAkzeptieren()"
        class="btn btn-primary"
      >
        {{ 'shared.form.darlehen.akzeptieren' | transloco }}
      </button>
    </dv-shared-ui-step-form-buttons>
  </form>
}
