<div>
  @if (view().loading) {
    <div data-testid="form-auszahlung-loading" class="my-2 p-2 py-4 d-flex rounded shadow-sm border">
      <div class="dv-progress-bar-indeterminate">
        <div></div>
      </div>
    </div>
  }

  <!-- missing info -->
  @if (!view().loading && !view().hasNecessaryPreSteps) {
    <div class="row">
      <div class="col-12 col-xl-8 my-3">
        <ngb-alert type="info" [dismissible]="false">{{
          'shared.form.auszahlung.top.missing-eltern' | translate
        }}</ngb-alert>
      </div>
    </div>
  }
  @if (!view().loading && view().hasNecessaryPreSteps) {
    <form [formGroup]="form" data-testid="form-auszahlung-form" novalidate class="mt-4" (ngSubmit)="handleSave()">
      <div class="row g-4 my-2">
        <!-- kontoinhaber -->
        <mat-form-field dvSharedUiFormField class="col-12 col-md-6 col-xl-4">
          <mat-label>{{ 'shared.form.auszahlung.kontoinhaber' | translate }}</mat-label>
          <mat-select
            [formControlName]="'kontoinhaber'"
            data-testid="form-auszahlung-kontoinhaber"
            (change)="handleKontoinhaberinChangedByUser()"
          >
            <mat-option [value]="null" disabled selected>
              {{ 'shared.form.select.empty' | translate }}
            </mat-option>
            @for (each of view().kontoinhaberValues; track trackByIndex($index)) {
              <mat-option [value]="each">
                {{ 'shared.form.auszahlung.kontoinhaber.' + each | translate }}
              </mat-option>
            }
          </mat-select>
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="row g-4 my-2">
        <!-- Nachname -->
        <mat-form-field dvSharedUiFormField class="col-12 col-md-6 col-xl-4">
          <mat-label>{{ 'shared.form.shared.lastname.label' | translate }}</mat-label>
          <input matInput type="text" [formControlName]="'nachname'" data-testid="form-auszahlung-nachname" />
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </mat-error>
        </mat-form-field>

        <!-- Vorname -->
        <mat-form-field dvSharedUiFormField class="col-12 col-md-6 col-xl-4">
          <mat-label>{{ 'shared.form.shared.firstname.label' | translate }}</mat-label>
          <input matInput type="text" [formControlName]="'vorname'" data-testid="form-auszahlung-vorname" />
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- ADRESSE -->

      <div class="row g-4 my-2">
        <div class="col-12 col-xl-8">
          <dv-shared-ui-form-address [group]="form.controls.adresse" [laender]="laenderSig()" [language]="language" />
        </div>
      </div>

      <div class="row g-4 my-2">
        <!-- IBAN -->
        <mat-form-field dvSharedUiFormField class="col-12 col-md-6 col-xl-4">
          <mat-label>{{ 'shared.form.auszahlung.iban.label' | translate }}</mat-label>
          <span matTextPrefix>CH</span>
          <input
            data-testid="form-auszahlung-iban"
            matInput
            type="text"
            [formControlName]="'iban'"
            [maskito]="MASK_IBAN"
          />
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </mat-error>
          <mat-error *dvSharedUiFormMessageError="'invalidIBAN'">
            {{ 'shared.form.error.invalidIBAN' | translate }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Buttons -->
      <dv-shared-ui-step-form-buttons>
        @if (!view().readonly) {
          <button type="submit" class="btn btn-primary" data-testid="button-save-continue">
            {{ 'shared.form.save-and-continue' | translate }}
          </button>
        } @else {
          <button type="button" class="btn btn-primary" (click)="handleContinue()" data-testid="button-next">
            {{ 'shared.form.gonext' | translate }}
          </button>
        }
      </dv-shared-ui-step-form-buttons>
    </form>
  }
</div>
