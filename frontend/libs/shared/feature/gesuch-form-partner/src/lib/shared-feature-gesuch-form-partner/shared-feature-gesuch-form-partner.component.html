<div>
  @let view = viewSig();
  <!-- loading -->
  @if (view.loading) {
    <dv-shared-ui-loading data-testid="form-partner-loading"></dv-shared-ui-loading>
  } @else {
    <form
      [formGroup]="form"
      [dvSharedUiFormReadonly]="view.readonly"
      (gotReenabledSig)="gotReenabled$.next({})"
      novalidate
      class="mt-4"
      data-testid="form-partner-form"
      (ngSubmit)="handleSaveAndContinue()"
    >
      <h3 class="pt-5">
        {{ 'shared.form.shared.section.personal-details' | transloco }}
      </h3>
      <!-- AHV -->
      <div class="row g-4 my-2">
        <div class="d-flex align-content-center col-12 col-md-6 col-xl-4">
          <mat-form-field dvSharedUiFormField class="flex-grow-1">
            <mat-label>{{ 'shared.form.shared.sozialversicherungsnummer.label' | transloco }}</mat-label>
            <input
              matInput
              type="text"
              formControlName="sozialversicherungsnummer"
              data-testid="form-partner-sozialversicherungsnummer"
              placeholder="756.xxxx.xxxx.xx"
              [maskito]="MASK_SOZIALVERSICHERUNGSNUMMER"
            />
            <mat-hint *dvZuvorHint="view.formChanges?.sozialversicherungsnummer"></mat-hint>
            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | transloco }}
            </mat-error>
            <mat-error *dvSharedUiFormMessageError="'ahv'">
              {{ 'shared.form.error.ahv' | transloco }}
            </mat-error>
            <mat-error *dvSharedUiFormMessageError="'notUniqueAhv'">
              {{ 'shared.form.error.notUniqueAhv' | transloco }}
            </mat-error>
          </mat-form-field>
          <button
            type="button"
            (click)="ahvPartnerInfoDialog.toggle()"
            class="dv-icon-button dv-icon-button-md text-info mt-2"
            [attr.aria-label]="'shared.form-field.toggle-info-messages' | transloco"
          >
            <span class="material-symbols-rounded"> info </span>
          </button>
        </div>
        <div class="d-none d-xl-block col-xl-4"></div>
        <div
          dvSharedUiInfoDialog
          [dialogTitleKey]="'shared.form.partner.sozialversicherungsnummer.infoTitle'"
          [dialogMessageKey]="'shared.form.partner.sozialversicherungsnummer.info'"
          #ahvPartnerInfoDialog="dvSharedUiInfoDialog"
          class="d-none d-xl-block col-xl-4"
        ></div>
      </div>
      <div class="row g-4 my-2">
        <mat-form-field dvSharedUiFormField class="col-12 col-md-6 col-xl-4">
          <mat-label>{{ 'shared.form.shared.lastname.label' | transloco }}</mat-label>
          <input formControlName="nachname" data-testid="form-partner-nachname" matInput dvMaxLength type="text" />
          <mat-hint *dvZuvorHint="view.formChanges?.nachname"></mat-hint>
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | transloco }}
          </mat-error>
        </mat-form-field>
        <mat-form-field dvSharedUiFormField class="col-12 col-md-6 col-xl-4">
          <mat-label>{{ 'shared.form.shared.firstname.label' | transloco }}</mat-label>
          <input formControlName="vorname" data-testid="form-partner-vorname" matInput dvMaxLength type="text" />
          <mat-hint *dvZuvorHint="view.formChanges?.vorname"></mat-hint>
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | transloco }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Adresse -->
      <div class="row g-4 mt-1">
        <dv-shared-ui-form-address
          class="col-12 col-xl-8"
          [group]="form.controls.adresse"
          [changes]="view.formChanges?.adresse"
          [languageSig]="languageSig()"
        />
      </div>

      <div class="row g-4 my-2">
        <!-- GEBURTSDATUM -->
        <mat-form-field dvSharedUiFormField class="col-12 col-xl-4">
          <mat-label>{{ 'shared.form.shared.birthday.label' | transloco }}</mat-label>

          <input
            matInput
            [dvMaxLength]="'small'"
            placeholder="dd.mm.yyyy"
            formControlName="geburtsdatum"
            data-testid="form-partner-geburtsdatum"
            (blur)="onGeburtsdatumBlur()"
          />
          <mat-hint *dvZuvorHint="view.formChanges?.geburtsdatum | date: 'dd.MM.yyyy'"></mat-hint>

          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | transloco }}
          </mat-error>
          <mat-error *dvSharedUiFormMessageError="'dateFormat'">
            {{ 'shared.form.error.dateFormat' | transloco }}
          </mat-error>
          <mat-error *dvSharedUiFormMessageError="'minDate'">
            {{ 'shared.form.error.minDatePast' | transloco }}
          </mat-error>
          <mat-error *dvSharedUiFormMessageError="'maxDate'">
            {{ 'shared.form.error.maxDatePast' | transloco }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="row g-4 my-2">
        <!-- AUSBILDUNG MIT EINKOMMEN ODER ERWERBSTÃ„TIG -->
        <div class="col-12 col-xl-4 col-md-6 d-flex align-items-center flex-grow-1 gap-2">
          <mat-checkbox type="checkbox" formControlName="inAusbildung" data-testid="form-partner-inAusbildung">{{
            'shared.form.partner.inAusbildung.label' | transloco
          }}</mat-checkbox>
          <dv-shared-ui-form-zuvor-hint
            [changes]="view.formChanges?.inAusbildung | dvTranslateChange: 'shared.form.zuvor.checkbox.$VALUE' | async"
          ></dv-shared-ui-form-zuvor-hint>
        </div>
      </div>

      <div class="row g-4 my-2">
        <!-- PENSUM -->
        @if (showAusbildungspensumSig()) {
          <mat-form-field dvSharedUiFormField class="col-12 col-xl-4">
            <mat-label>
              {{ 'shared.form.ausbildung.pensum.label' | transloco }}
            </mat-label>

            <mat-select
              formControlName="ausbildungspensum"
              data-testid="form-partner-pensum"
              [placeholder]="'shared.form.select.empty' | transloco"
            >
              @for (l of ausbildungspensumValues; track $index) {
                <mat-option [value]="l" [attr.data-testid]="l">
                  {{ 'shared.form.ausbildung.pensum.' + l | transloco }}
                </mat-option>
              }
            </mat-select>

            <mat-hint
              *dvZuvorHint="
                view.formChanges?.ausbildungspensum | dvTranslateChange: 'shared.form.ausbildung.pensum.$VALUE' | async
              "
            ></mat-hint>

            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | transloco }}
            </mat-error>
          </mat-form-field>
        }
      </div>

      <!-- Buttons -->
      <dv-shared-ui-step-form-buttons>
        @if (!view.readonly) {
          <button type="submit" class="btn btn-primary" data-testid="button-save-continue">
            {{ 'shared.form.save-and-continue' | transloco }}
          </button>
        } @else {
          <button type="button" class="btn btn-primary" (click)="handleContinue()" data-testid="button-next">
            {{ 'shared.form.gonext' | transloco }}
          </button>
        }
      </dv-shared-ui-step-form-buttons>
    </form>
  }
</div>
