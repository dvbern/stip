<div>
  @let view = viewSig();
  @if (view.loading) {
    <dv-shared-ui-loading data-testid="form-person-loading"></dv-shared-ui-loading>
  } @else {
    <form
      [formGroup]="form"
      [dvSharedUiFormReadonly]="view.readonly"
      (gotReenabledSig)="gotReenabled$.next({})"
      data-testid="form-person-form"
      novalidate
      class="mt-4"
      (ngSubmit)="handleSave()"
    >
      <!-- AHV Sozialversicherungsnummer -->
      <div class="row g-4">
        <div class="d-flex col-md-6 col-xl-4 col-12">
          <mat-form-field dvSharedUiFormField class="flex-grow-1">
            <mat-label>{{ 'shared.form.shared.sozialversicherungsnummer.label' | transloco }}</mat-label>
            <input
              type="text"
              matInput
              [formControl]="form.controls.sozialversicherungsnummer"
              data-testid="form-person-sozialversicherungsnummer"
              placeholder="756.xxxx.xxxx.xx"
              [maskito]="MASK_SOZIALVERSICHERUNGSNUMMER"
            />
            <mat-hint *dvZuvorHint="view.formChanges.sozialversicherungsnummer"></mat-hint>
            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | transloco }}
            </mat-error>
            <mat-error *dvSharedUiFormMessageError="'ahv'">
              {{ 'shared.form.error.ahv' | transloco }}
            </mat-error>
            <mat-error *dvSharedUiFormMessageError="'notUniqueAhv'">
              {{ 'shared.form.error.notUniqueAhv' | transloco }}
            </mat-error>
            <mat-error *dvSharedUiFormMessageError="'alreadyUsedAhv'">
              {{ 'shared.form.error.alreadyUsedAhv' | transloco }}
            </mat-error>
          </mat-form-field>
          <button
            type="button"
            (click)="ahvInfoDialog.toggle()"
            class="dv-icon-button dv-icon-button-md text-info mt-2"
            [attr.aria-label]="'shared.form-field.toggle-info-messages' | transloco"
          >
            <span class="material-symbols-rounded"> info </span>
          </button>
        </div>
        <div class="d-none d-xl-block col-xl-4"></div>
        <div
          dvSharedUiInfoDialog
          [dialogTitleKey]="'shared.form.person.sozialversicherungsnummer.infoTitle'"
          [dialogMessageKey]="'shared.form.person.sozialversicherungsnummer.info'"
          #ahvInfoDialog="dvSharedUiInfoDialog"
          class="d-none d-xl-block col-xl-4"
        ></div>
      </div>
      <h3 class="mb-4 pt-5">
        {{ 'shared.form.shared.section.personal-details' | transloco }}
      </h3>

      <div class="row g-4">
        <!-- Anrede -->
        <mat-form-field dvSharedUiFormField class="col-md-6 col-xl-4 col-12">
          <mat-label>{{ 'shared.form.person.salutation.label' | transloco }}</mat-label>
          <mat-select
            [formControl]="form.controls.anrede"
            data-testid="form-person-anrede"
            [placeholder]="'shared.form.select.empty' | transloco"
          >
            @for (anrede of anredeValues; track $index) {
              <mat-option [attr.data-testid]="anrede" [value]="anrede">
                {{ 'shared.form.select.salutation.' + anrede | transloco }}
              </mat-option>
            }
          </mat-select>
          <mat-hint
            *dvZuvorHint="view.formChanges.anrede | dvTranslateChange: 'shared.form.select.salutation.$VALUE' | async"
          ></mat-hint>
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | transloco }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="row g-4 mt-1">
        <!-- Name -->
        <mat-form-field dvSharedUiFormField class="col-md-6 col-xl-4 col-12">
          <mat-label>{{ 'shared.form.shared.lastname.label' | transloco }}</mat-label>
          <input
            type="text"
            matInput
            dvMaxLength
            [formControl]="form.controls.nachname"
            data-testid="form-person-nachname"
          />
          <mat-hint *dvZuvorHint="view.formChanges.nachname; testId: 'form-person-nachname-zuvor-hint'"></mat-hint>
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | transloco }}
          </mat-error>
        </mat-form-field>
        <!-- Vorname -->
        <mat-form-field dvSharedUiFormField class="col-md-6 col-xl-4 col-12">
          <mat-label>{{ 'shared.form.shared.firstname.label' | transloco }}</mat-label>
          <input
            type="text"
            matInput
            dvMaxLength
            [formControl]="form.controls.vorname"
            data-testid="form-person-vorname"
          />
          <mat-hint *dvZuvorHint="view.formChanges.vorname"></mat-hint>
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | transloco }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Adresse -->
      <div class="row g-4 mt-1">
        <dv-shared-ui-form-address
          class="col-xl-8 col-12"
          [group]="form.controls.adresse"
          [changes]="view.formChanges.adresse"
          [languageSig]="languageSig()"
        />
      </div>

      <div class="row g-4 mt-1">
        <!-- Wohnsitz -->
        <div class="col-md-6 col-xl-4 d-flex align-items-center col-12 flex-grow-1 gap-1">
          <div>
            <mat-checkbox
              [formControl]="form.controls.identischerZivilrechtlicherWohnsitz"
              data-testid="form-person-identischerZivilrechtlicherWohnsitz"
              >{{ 'shared.form.shared.identical-civil-residence.label' | transloco }}</mat-checkbox
            >
            <dv-shared-ui-form-zuvor-hint
              [changes]="
                view.formChanges.identischerZivilrechtlicherWohnsitz
                  | dvTranslateChange: 'shared.form.zuvor.checkbox.$VALUE'
                  | async
              "
            ></dv-shared-ui-form-zuvor-hint>
          </div>
          <button
            type="button"
            (click)="identischerWohnsitzDialog.toggle()"
            class="dv-icon-button dv-icon-button-md text-info"
            [attr.aria-label]="'shared.form-field.toggle-info-messages' | transloco"
          >
            <span class="material-symbols-rounded"> info </span>
          </button>
        </div>
        <div class="d-none d-xl-block col-xl-4"></div>
        <div
          dvSharedUiInfoDialog
          [dialogTitleKey]="'shared.form.person.identischerWohnsitz.label'"
          [dialogMessageKey]="'shared.form.person.identischerWohnsitz.info'"
          #identischerWohnsitzDialog="dvSharedUiInfoDialog"
          class="d-none d-xl-block col-xl-4"
        ></div>
      </div>
      <!-- alternative civil residence -->
      @if (!form.value.identischerZivilrechtlicherWohnsitz) {
        <div class="row g-4 mt-1">
          <div class="col-xl-8 col-12">
            <mat-label class="mb-2">{{ 'shared.form.shared.alternative-civil-residence.title' | transloco }}</mat-label>
            @let identischerZivilrechtlicherWohnsitzPlzOrt = form.controls.identischerZivilrechtlicherWohnsitzPlzOrt;
            <div
              class="row g-4 mt-1"
              dvPlzOrtAutocomplete
              [autocompleteSig]="plzAutocomplete"
              [plzFormSig]="identischerZivilrechtlicherWohnsitzPlzOrt"
              (plzLookupValuesSig)="plzValues = $event"
            >
              <!-- PLZ -->
              <mat-form-field dvSharedUiFormField class="col-md-4 col-xl-3 col-5 mt-3">
                <mat-label>{{ 'shared.form.shared.address.zipcode.label' | transloco }}</mat-label>
                <input
                  type="text"
                  matInput
                  [dvMaxLength]="'small'"
                  [formControl]="identischerZivilrechtlicherWohnsitzPlzOrt.controls.plz"
                  [matAutocomplete]="plzAutocomplete"
                  data-testid="form-person-identischer-zivilrechlicher-wohnsitz-plz"
                />
                <mat-hint *dvZuvorHint="view.formChanges.identischerZivilrechtlicherWohnsitzPLZ"></mat-hint>
                <mat-error *dvSharedUiFormMessageError="'required'">
                  {{ 'shared.form.error.required' | transloco }}
                </mat-error>
                <mat-autocomplete #plzAutocomplete="matAutocomplete" [panelWidth]="'320px'">
                  @for (lookup of plzValues; track $index) {
                    <mat-option [value]="lookup" [attr.data-testid]="'plz-' + lookup.plz">
                      {{ lookup.plz }} {{ lookup.ort }}
                    </mat-option>
                  }
                </mat-autocomplete>
              </mat-form-field>

              <!-- Ort -->
              <mat-form-field dvSharedUiFormField class="col-md-8 col-xl-9 col-7 mt-3">
                <mat-label>{{ 'shared.form.shared.address.city.label' | transloco }}</mat-label>
                <input
                  type="text"
                  matInput
                  dvMaxLength
                  [formControl]="identischerZivilrechtlicherWohnsitzPlzOrt.controls.ort"
                  data-testid="form-person-identischer-zivilrechlicher-wohnsitz-ort"
                />
                <mat-hint *dvZuvorHint="view.formChanges.identischerZivilrechtlicherWohnsitzOrt"></mat-hint>
                <mat-error *dvSharedUiFormMessageError="'required'">
                  {{ 'shared.form.error.required' | transloco }}
                </mat-error>
              </mat-form-field>
            </div>
          </div>
        </div>
      }
      <!-- Weitere Angaben -->
      <h3 class="mb-4 pt-5">
        {{ 'shared.form.person.section.additional-information' | transloco }}
      </h3>

      <div class="row g-4 mt-1">
        <!-- E-MAIL -->
        <div class="d-flex align-content-center col-md-6 col-xl-4 col-12">
          <mat-form-field dvSharedUiFormField class="flex-grow-1">
            <mat-label>{{ 'shared.form.person.email.label' | transloco }}</mat-label>
            <input
              matInput
              dvMaxLength
              type="email"
              [formControl]="form.controls.email"
              data-testid="form-person-email"
            />
            <mat-hint *dvZuvorHint="view.formChanges.email"></mat-hint>
            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | transloco }}
            </mat-error>
            <mat-error *dvSharedUiFormMessageError="'pattern'">
              {{ 'shared.form.error.email' | transloco }}
            </mat-error>
          </mat-form-field>
          <button
            type="button"
            (click)="emailDialog.toggle()"
            class="dv-icon-button dv-icon-button-md text-info mt-2"
            [attr.aria-label]="'shared.form-field.toggle-info-messages' | transloco"
          >
            <span class="material-symbols-rounded"> info </span>
          </button>
        </div>

        <!-- TEL -->
        <div class="d-flex align-content-center col-md-6 col-xl-4 col-12">
          <mat-form-field dvSharedUiFormField class="w-100">
            <mat-label>{{ 'shared.form.shared.phone.label' | transloco }}</mat-label>
            <input
              type="text"
              matInput
              dvMaxLength
              [formControl]="form.controls.telefonnummer"
              data-testid="form-person-telefonnummer"
            />
            <mat-hint *dvZuvorHint="view.formChanges.telefonnummer"></mat-hint>
            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | transloco }}
            </mat-error>
            <mat-error *dvSharedUiFormMessageError="'telefonnummer'">
              {{ 'shared.form.error.telefonnummer' | transloco }}
            </mat-error>
          </mat-form-field>
        </div>
        <div
          dvSharedUiInfoDialog
          [dialogTitleKey]="'shared.form.person.email.label'"
          [dialogMessageKey]="'shared.form.person.email.info'"
          #emailDialog="dvSharedUiInfoDialog"
          class="d-none d-xl-block col-xl-4"
        ></div>
      </div>

      <div class="row g-4 mt-1">
        <!-- GEBURTSDATUM -->
        <div class="d-flex align-content-center col-md-6 col-xl-4 col-12 gap-2">
          <mat-form-field dvSharedUiFormField class="flex-grow-1">
            <mat-label>{{ 'shared.form.shared.birthday.label' | transloco }}</mat-label>

            <input
              matInput
              [dvMaxLength]="'small'"
              placeholder="dd.mm.yyyy"
              [formControl]="form.controls.geburtsdatum"
              data-testid="form-person-geburtsdatum"
              (blur)="onGeburtsdatumBlur()"
            />
            <mat-hint *dvZuvorHint="view.formChanges.geburtsdatum | dvAppDate: 'dd.MM.yyyy'"></mat-hint>

            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | transloco }}
            </mat-error>
            <mat-error *dvSharedUiFormMessageError="'dateFormat'">
              {{ 'shared.form.error.dateFormat' | transloco }}
            </mat-error>
            <mat-error *dvSharedUiFormMessageError="'minDate'">
              {{ 'shared.form.error.minDatePast' | transloco }}
            </mat-error>
            <mat-error *dvSharedUiFormMessageError="'maxDate'">
              {{ 'shared.form.error.maxDatePast' | transloco }}
            </mat-error>
          </mat-form-field>
          @if (geburtstagDocumentOptionsSig(); as options) {
            <dv-shared-pattern-document-upload [optionsSig]="options"></dv-shared-pattern-document-upload>
          }
        </div>

        <!-- ZIVILSTAND -->
        <div class="d-flex align-content-center col-md-6 col-xl-4 col-12 gap-2">
          <mat-form-field dvSharedUiFormField class="flex-grow-1">
            <mat-label>{{ 'shared.form.person.zivilstand.label' | transloco }}</mat-label>
            <mat-select
              [formControl]="form.controls.zivilstand"
              data-testid="form-person-zivilstand"
              [placeholder]="'shared.form.select.empty' | transloco"
            >
              @for (z of zivilstandValues; track $index) {
                <mat-option [value]="z" [attr.data-testid]="z">
                  {{ 'shared.form.person.zivilstand.' + z | transloco }}
                </mat-option>
              }
            </mat-select>
            <mat-hint
              *dvZuvorHint="
                view.formChanges.zivilstand | dvTranslateChange: 'shared.form.person.zivilstand.$VALUE' | async
              "
            ></mat-hint>
            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | transloco }}
            </mat-error>
          </mat-form-field>

          @if (zivilstandDocumentOptionsSig(); as options) {
            <dv-shared-pattern-document-upload [optionsSig]="options"></dv-shared-pattern-document-upload>
          }
        </div>

        <!-- Info Konkubinat -->
        @if (form.get('zivilstand')?.value === Zivilstand.LEDIG) {
          <div class="col-md-12 col-xl-4 col-12">
            <dv-shared-ui-info-container>
              <div class="d-flex gap-3">
                <span class="material-symbols-rounded text-info"> info </span>
                <span>{{ 'shared.form.person.zivilstand.ledig.info' | transloco }}</span>
              </div>
            </dv-shared-ui-info-container>
          </div>
        } @else if (form.get('zivilstand')?.value === Zivilstand.KONKUBINAT) {
          <div class="col-md-12 col-xl-4 col-12">
            <dv-shared-ui-info-container>
              <div class="d-flex align-content-center gap-3">
                <span class="material-symbols-rounded text-info">info</span>
                <span>{{ 'shared.form.person.zivilstand.konkubinat.info' | transloco }}</span>
              </div>
            </dv-shared-ui-info-container>
          </div>
        }
      </div>

      <div class="row g-4 mt-1">
        <!-- NATIONALITAET -->
        <div class="col-md-6 col-xl-4 d-flex col-12 gap-2">
          <dv-shared-ui-select-search
            [formControl]="form.controls.nationalitaetId"
            [testIdSig]="'form-person-nationalitaet'"
            [labelKeySig]="'shared.form.person.nationality.label'"
            [valuesSig]="laenderSig()"
            [languageSig]="languageSig()"
            [panelWidthSig]="'auto'"
            [invalidValueLabelKeySig]="'shared.form.error.land.invalidLand'"
            [zuvorValueSig]="view.formChanges.nationalitaetId"
          ></dv-shared-ui-select-search>
        </div>

        <!-- NIEDERLASSUNGSSTATUS ODER HEIMATORT -->
        @if (!hiddenFieldsSetSig().has(form.controls.niederlassungsstatus)) {
          <div class="d-flex col-md-6 col-xl-4 col-12">
            <mat-form-field dvSharedUiFormField class="flex-grow-1">
              <mat-label>{{ 'shared.form.person.niederlassungsstatus.label' | transloco }}</mat-label>

              <mat-select
                [formControl]="form.controls.niederlassungsstatus"
                data-testid="form-person-niederlassungsstatus"
                [panelWidth]="null"
                [placeholder]="'shared.form.select.empty' | transloco"
              >
                @for (n of niederlassungsStatusValues; track $index) {
                  <mat-option [value]="n" [attr.data-testid]="n">
                    {{ 'shared.form.person.niederlassungsstatus.' + n | transloco }}
                  </mat-option>
                }
              </mat-select>
              <mat-hint
                *dvZuvorHint="
                  niederlassungstatusChangesSig()?.niederlassungsstatus
                    | dvTranslateChange: 'shared.form.person.niederlassungsstatus.$VALUE'
                    | async
                "
              ></mat-hint>

              <mat-error *dvSharedUiFormMessageError="'required'">
                {{ 'shared.form.error.required' | transloco }}
              </mat-error>
            </mat-form-field>

            <button
              type="button"
              class="dv-icon-button dv-icon-button-md text-info mt-2"
              (click)="niederLassungInfoDialog.toggle()"
              [attr.aria-label]="'shared.form-field.toggle-info-messages' | transloco"
            >
              <span class="material-symbols-rounded"> info </span>
            </button>

            <!-- Auslaenderausweis -->
            @if (auslaenderausweisDocumentOptionsSig(); as options) {
              <dv-shared-pattern-document-upload [optionsSig]="options"></dv-shared-pattern-document-upload>
            }
          </div>
          <div class="col-md-12 col-xl-4 col-12">
            <div
              dvSharedUiInfoDialog
              [dialogTitleKey]="'shared.form.person.niederlassungsstatus.infoTitle'"
              [dialogMessageKey]="'shared.form.person.niederlassungsstatus.info'"
              #niederLassungInfoDialog="dvSharedUiInfoDialog"
            ></div>

            @if (showNiederlassungsstatusNichtBerechtigtWarningSig()) {
              <dv-shared-ui-info-container [type]="'warning'">
                <div class="d-flex gap-3">
                  <span class="material-symbols-rounded text-warning">warning</span>
                  <span>{{ 'shared.form.person.niederlassungstatus.info' | transloco }}</span>
                </div>
              </dv-shared-ui-info-container>
            }
          </div>
        }

        @if (!hiddenFieldsSetSig().has(form.controls.heimatortPlzOrt)) {
          <div
            class="col-md-6 col-xl-4 d-flex align-content-center col-12 gap-2"
            dvPlzOrtAutocomplete
            [autocompleteSig]="plzAutocomplete"
            [plzFormSig]="form.controls.heimatortPlzOrt"
            (plzLookupValuesSig)="plzValues = $event"
          >
            <!-- PLZ -->
            <mat-form-field dvSharedUiFormField class="tw:basis-auto">
              <mat-label>{{ 'shared.form.shared.address.zipcode.label' | transloco }}</mat-label>
              <input
                type="text"
                matInput
                [dvMaxLength]="'small'"
                [formControl]="form.controls.heimatortPlzOrt.controls.plz"
                [matAutocomplete]="plzAutocomplete"
                data-testid="form-person-heimatortPLZ"
              />
              <mat-hint *dvZuvorHint="view.formChanges.heimatortPLZ"></mat-hint>
              <mat-error *dvSharedUiFormMessageError="'required'">
                {{ 'shared.form.error.requiredShort' | transloco }}
              </mat-error>
              <mat-autocomplete #plzAutocomplete="matAutocomplete" [panelWidth]="'320px'">
                @for (lookup of plzValues; track $index) {
                  <mat-option [value]="lookup" [attr.data-testid]="'plz-' + lookup.plz">
                    {{ lookup.plz }} {{ lookup.ort }}
                  </mat-option>
                }
              </mat-autocomplete>
            </mat-form-field>

            <!-- Ort -->
            <mat-form-field dvSharedUiFormField class="tw:basis-11/12">
              <mat-label>{{ 'shared.form.person.origin.label' | transloco }}</mat-label>
              <input
                type="text"
                matInput
                dvMaxLength
                [formControl]="form.controls.heimatortPlzOrt.controls.ort"
                data-testid="form-person-heimatort"
              />
              <mat-hint *dvZuvorHint="view.formChanges.heimatort"></mat-hint>
              <mat-error *dvSharedUiFormMessageError="'required'">
                {{ 'shared.form.error.required' | transloco }}
              </mat-error>
            </mat-form-field>

            @if (heimatortDocumentOptionsSig(); as options) {
              <dv-shared-pattern-document-upload [optionsSig]="options"></dv-shared-pattern-document-upload>
            }
            <button
              type="button"
              (click)="heimatortDialog.toggle()"
              class="dv-icon-button dv-icon-button-md text-info mt-2"
              [attr.aria-label]="'shared.form-field.toggle-info-messages' | transloco"
            >
              <span class="material-symbols-rounded"> info </span>
            </button>
          </div>
          <div
            dvSharedUiInfoDialog
            [dialogTitleKey]="'shared.form.person.heimatort.infoTitle'"
            [dialogMessageKey]="'shared.form.person.heimatort.info'"
            #heimatortDialog="dvSharedUiInfoDialog"
            class="d-none d-xl-block col-xl-4"
          ></div>
        }
      </div>

      <!-- FLUECHTLINGSSTATUS -->
      @if (!hiddenFieldsSetSig().has(form.controls.fluechtlingsstatus)) {
        <div class="row g-4 mt-1">
          <div class="d-none-lg col-md-6 col-xl-4"></div>
          <div class="col-md-6 col-xl-4 tw:flex-col tw:gap-2 col-12">
            <mat-radio-group
              class="col-md-6 col-xl-4 tw:w-full col-12"
              [formControl]="form.controls.fluechtlingsstatus"
              data-testid="form-person-fluechtlingsstatus"
              dvSharedUiFormField
            >
              <div class="d-flex col-12">
                <mat-label>{{ 'shared.form.person.fluechtlingsstatus.label' | transloco }}</mat-label>
              </div>
              <div class="d-flex justify-content-between flex-column col-12 gap-2">
                @for (value of [true, false]; track $index) {
                  <mat-radio-button [value]="value">{{
                    'shared.form.person.fluechtlingsstatus.' + value | transloco
                  }}</mat-radio-button>
                }
              </div>
              <mat-hint
                *dvZuvorHint="
                  niederlassungstatusChangesSig()?.fluechtlingsstatus
                    | dvTranslateChange: 'shared.form.person.fluechtlingsstatus.$VALUE'
                    | async
                "
              ></mat-hint>

              <div class="group-errors">
                <mat-error *dvSharedUiFormMessageError="'required'">
                  {{ 'shared.form.error.required' | transloco }}
                </mat-error>
              </div>
            </mat-radio-group>
          </div>
        </div>
      }

      <!-- ZUSTAENDIGER_KANTON -->
      @if (!hiddenFieldsSetSig().has(form.controls.zustaendigerKanton)) {
        <div class="row g-4 mt-1">
          <div class="d-none-lg col-md-6 col-xl-4"></div>
          <mat-form-field dvSharedUiFormField class="col-md-6 col-xl-4 tw:flex tw:flex-col tw:gap-2 col-12">
            <mat-label>{{ 'shared.form.person.zustaendigerKanton.label' | transloco }}</mat-label>
            <mat-select
              [formControl]="form.controls.zustaendigerKanton"
              data-testid="form-person-zustaendigerKanton"
              [placeholder]="'shared.form.select.empty' | transloco"
            >
              @for (kanton of zustaendigerKantonValues; track $index) {
                <mat-option [value]="kanton" [attr.data-testid]="kanton">
                  {{ 'shared.form.person.zustaendigerKanton.' + kanton | transloco }}
                </mat-option>
              }
            </mat-select>
            <mat-hint
              *dvZuvorHint="
                niederlassungstatusChangesSig()?.zustaendigerKanton
                  | dvTranslateChange: 'shared.form.person.zustaendigerKanton.$VALUE'
                  | async
              "
            ></mat-hint>

            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | transloco }}
            </mat-error>
          </mat-form-field>
        </div>
      }

      <!-- EINREISEDATUM -->
      @if (!hiddenFieldsSetSig().has(form.controls.einreisedatum)) {
        <div class="row g-4 mt-1">
          <div class="d-none-lg col-md-6 col-xl-4"></div>
          <mat-form-field dvSharedUiFormField class="col-md-6 col-xl-4 col-12">
            <mat-label>{{ 'shared.form.person.einreisedatum.label' | transloco }}</mat-label>
            <input
              type="text"
              matInput
              [dvMaxLength]="'small'"
              placeholder="dd.mm.yyyy"
              [formControl]="form.controls.einreisedatum"
              data-testid="form-person-einreisedatum"
              (blur)="onEinreisedatumBlur()"
            />
            <mat-hint *dvZuvorHint="view.formChanges.einreisedatum | dvAppDate: 'dd.MM.yyyy'"></mat-hint>
            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | transloco }}
            </mat-error>
          </mat-form-field>

          @if (showEinreiseDatumWarningSig()) {
            <div class="col-md-12 col-xl-4 col-12">
              <dv-shared-ui-info-container [type]="'warning'">
                <div class="d-flex gap-3">
                  <span class="material-symbols-rounded text-warning">warning</span>
                  <span>{{ 'shared.form.person.einreisedatum.info' | transloco }}</span>
                </div>
              </dv-shared-ui-info-container>
            </div>
          }
        </div>
      }

      <div class="row g-4 mt-1">
        <!-- Wohnsitz -->
        <div class="col-md-6 col-xl-4 d-flex col-12 gap-2">
          <mat-form-field dvSharedUiFormField class="flex-grow-1">
            <mat-label>{{ 'shared.form.shared.wohnsitz.label' | transloco }}</mat-label>
            <mat-select
              [formControl]="form.controls.wohnsitz"
              data-testid="form-person-wohnsitz"
              [placeholder]="'shared.form.select.empty' | transloco"
            >
              @for (z of wohnsitzHelper.wohnsitzValuesSig(); track $index) {
                <mat-option [value]="z" [attr.data-testid]="z">
                  {{ 'shared.form.shared.wohnsitz.' + z | transloco }}
                </mat-option>
              }
            </mat-select>
            <mat-hint
              *dvZuvorHint="view.formChanges.wohnsitz | dvTranslateChange: 'shared.form.shared.wohnsitz.$VALUE' | async"
            ></mat-hint>
            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | transloco }}
            </mat-error>
          </mat-form-field>
          @if (wohnsitzBeiDocumentOptionsSig(); as options) {
            <dv-shared-pattern-document-upload [optionsSig]="options"></dv-shared-pattern-document-upload>
          }
        </div>

        <!-- VORMUNDSCHAFT -->

        @if (nationalitaetBfsCodeSig() === bfsCodeSchweiz) {
          <div class="col-md-6 col-xl-4 d-flex col-12 gap-2">
            <div>
              <mat-checkbox [formControl]="form.controls.vormundschaft" data-testid="form-person-vormundschaft">{{
                'shared.form.person.guardianship.label' | transloco
              }}</mat-checkbox>
              @if (vormundschaftDocumentOptionsSig(); as options) {
                <dv-shared-pattern-document-upload [optionsSig]="options"></dv-shared-pattern-document-upload>
              }
              <dv-shared-ui-form-zuvor-hint
                [changes]="
                  view.formChanges.vormundschaft | dvTranslateChange: 'shared.form.zuvor.checkbox.$VALUE' | async
                "
              ></dv-shared-ui-form-zuvor-hint>
            </div>
            <button
              type="button"
              (click)="vormundSchaftInfoDialog.toggle()"
              class="dv-icon-button dv-icon-button-md text-info mt-2"
              [attr.aria-label]="'shared.form-field.toggle-info-messages' | transloco"
            >
              <span class="material-symbols-rounded"> info </span>
            </button>
          </div>
          <div
            dvSharedUiInfoDialog
            [dialogTitleKey]="'shared.form.person.guardianship.label'"
            [dialogMessageKey]="'shared.form.person.guardianship.info'"
            #vormundSchaftInfoDialog="dvSharedUiInfoDialog"
            class="d-none d-xl-block col-xl-4"
          ></div>
        }
      </div>

      <!-- ZUSTAENDIGE KESB -->
      @if (!hiddenFieldsSetSig().has(form.controls.zustaendigeKESB)) {
        <div class="row g-4 mt-1">
          <div class="d-none-lg col-md-6 col-xl-4"></div>
          <div class="col-md-6 col-xl-4 d-flex col-12 gap-2">
            <mat-form-field dvSharedUiFormField class="flex-grow-1">
              <mat-label>{{ 'shared.form.person.zustaendigeKESB.label' | transloco }}</mat-label>
              <mat-select
                [formControl]="form.controls.zustaendigeKESB"
                data-testid="form-person-zustaendigeKESB"
                [placeholder]="'shared.form.select.empty' | transloco"
              >
                @for (kesb of zustaendigeKESBValues; track $index) {
                  <mat-option [value]="kesb" [attr.data-testid]="kesb">
                    {{ 'shared.form.person.zustaendigeKESB.' + kesb | transloco }}
                  </mat-option>
                }
              </mat-select>
              <mat-hint
                *dvZuvorHint="
                  view.formChanges.zustaendigeKESB
                    | dvTranslateChange: 'shared.form.person.zustaendigeKESB.$VALUE'
                    | async
                "
              ></mat-hint>
              <mat-error *dvSharedUiFormMessageError="'required'">
                {{ 'shared.form.error.required' | transloco }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>
      }

      <!-- WOHNSITZ AUFTEILUNG -->
      @if (wohnsitzHelper.showWohnsitzSplitterSig()) {
        <div class="row g-4 my-2">
          <div class="col-md-6 col-xl-4 col-12">
            <dv-shared-ui-wohnsitz-splitter
              [updateValidity]="updateValidity$ | async"
              [controls]="form.controls"
              [changes]="{
                wohnsitzAnteilVater: view.formChanges.wohnsitzAnteilVater,
                wohnsitzAnteilMutter: view.formChanges.wohnsitzAnteilMutter,
              }"
            ></dv-shared-ui-wohnsitz-splitter>
          </div>
        </div>
      }

      <div class="row g-4 mt-1">
        <!-- Sozialhilfebeitraege -->

        <mat-radio-group
          class="col-md-6 col-xl-4 col-12"
          [formControl]="form.controls.sozialhilfebeitraege"
          data-testid="form-person-sozialhilfeBeitraege"
          dvSharedUiFormField
        >
          <div class="d-flex align-items-center col-12 gap-2">
            <label>{{ 'shared.form.person.sozialhilfebeitraege.label' | transloco }}</label>
            <button
              type="button"
              (click)="sozialhilfebeitraegeDialog.toggle()"
              class="dv-icon-button dv-icon-button-md text-info"
              [attr.aria-label]="'shared.form-field.toggle-info-messages' | transloco"
            >
              <span class="material-symbols-rounded"> info </span>
            </button>
          </div>
          <div class="d-flex justify-content-between col-12 gap-2">
            <div class="d-flex flex-column">
              <mat-radio-button data-testid="yes" [value]="true">{{
                'shared.form.radio.yes' | transloco
              }}</mat-radio-button>
              <mat-radio-button data-testid="no" [value]="false">{{
                'shared.form.radio.no' | transloco
              }}</mat-radio-button>
              <dv-shared-ui-form-zuvor-hint
                [changes]="
                  view.formChanges.sozialhilfebeitraege | dvTranslateChange: 'shared.form.zuvor.radio.$VALUE' | async
                "
              ></dv-shared-ui-form-zuvor-hint>
            </div>

            @if (sozialhilfebeitraegeDocumentOptionsSig(); as options) {
              <dv-shared-pattern-document-upload
                class="align-self-center ms-auto flex-shrink-1"
                [optionsSig]="options"
              ></dv-shared-pattern-document-upload>
            }
          </div>
          <div class="group-errors">
            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | transloco }}
            </mat-error>
          </div>
        </mat-radio-group>
        <div class="d-none d-xl-block col-xl-4"></div>
        <div
          dvSharedUiInfoDialog
          [dialogTitleKey]="'shared.form.person.sozialhilfebeitraege.infoTitle'"
          [dialogMessageKey]="'shared.form.person.sozialhilfebeitraege.info'"
          #sozialhilfebeitraegeDialog="dvSharedUiInfoDialog"
          class="d-none d-xl-block col-xl-4"
        ></div>
      </div>

      <div class="row g-4 mt-1">
        <div class="col-md-6 col-xl-4 col-12">
          <!-- KorrespondenzSprache -->
          <mat-radio-group
            class="d-flex flex-column"
            [formControl]="form.controls.korrespondenzSprache"
            data-testid="form-person-korrespondenzSprache"
            dvSharedUiFormField
          >
            <label>{{ 'shared.form.person.korrespondenzSprache.label' | transloco }}</label>
            @for (s of spracheValues; track $index) {
              <mat-radio-button [attr.data-testid]="s" [value]="s">{{
                'shared.form.person.korrespondenzSprache.' + s | transloco
              }}</mat-radio-button>
            }
            <div class="group-errors">
              <mat-error *dvSharedUiFormMessageError="'required'">
                {{ 'shared.form.error.required' | transloco }}
              </mat-error>
            </div>
          </mat-radio-group>
          <dv-shared-ui-form-zuvor-hint
            [changes]="
              view.formChanges.korrespondenzSprache
                | dvTranslateChange: 'shared.form.person.korrespondenzSprache.$VALUE'
                | async
            "
          ></dv-shared-ui-form-zuvor-hint>
        </div>
      </div>

      @if (appSettings.hasFormFeature('digitaleKommunikation')) {
        <div class="row g-4 mt-1">
          <!-- digitale Kommunikation -->
          <mat-checkbox
            disabled="true"
            [checked]="view.benutzerEinstellungen.digitaleKommunikation"
            data-testid="form-person-digitaleKommunikation"
            >{{ 'shared.form.person.digital-communication.label' | transloco }}</mat-checkbox
          >
        </div>
      }

      <!-- Buttons -->
      <dv-shared-ui-step-form-buttons>
        @if (!view.readonly) {
          <button type="submit" class="btn btn-primary" data-testid="button-save-continue">
            {{ 'shared.form.save-and-continue' | transloco }}
          </button>
        } @else {
          <button type="button" class="btn btn-primary" (click)="handleContinue()" data-testid="button-next">
            {{ 'shared.form.gonext' | transloco }}
          </button>
        }
      </dv-shared-ui-step-form-buttons>
    </form>
  }
</div>
