@let tranche = viewSig().gesuchstranche;

<ng-template dvHeaderSuffix>
  <h2 class="fw-bold">
    @if (tranche) {
      {{ 'shared.form.title.suffix.' + tranche.typ | translate: { position: currentTrancheIndexSig() + 1 } }}
      {{ tranche.gueltigAb | date: 'MM.yyyy' }} -
      {{ tranche.gueltigBis | date: 'MM.yyyy' }}
    }
  </h2>
</ng-template>

<form [formGroup]="form">
  <div class="row g-4 mt-4">
    <!-- Von -->
    <mat-form-field dvSharedUiFormField class="col-12 col-md-6 col-xl-4">
      <mat-label>{{ 'shared.form.tranche.von.label' | translate }} </mat-label>

      <input readonly type="text" matInput formControlName="von" data-testid="form-tranche-von" />
    </mat-form-field>

    <!-- Bis -->
    <mat-form-field dvSharedUiFormField class="col-12 col-md-6 col-xl-4">
      <mat-label>{{ 'shared.form.tranche.bis.label' | translate }} </mat-label>

      <input
        readonly
        type="text"
        matInput
        formControlName="bis"
        placeholder="dd.mm.yyyy"
        data-testid="form-tranche-bis"
      />
    </mat-form-field>
  </div>

  <div class="row g-4 mt-0">
    <!-- Bemerkung -->
    <mat-form-field dvSharedUiFormField class="col-12 col-md-12 col-xl-8">
      <mat-label>{{ 'shared.form.tranche.bemerkung.label' | translate }} </mat-label>
      <textarea
        readonly
        rows="3"
        type="text"
        matInput
        formControlName="bemerkung"
        data-testid="form-tranche-bemerkung"
      ></textarea>
    </mat-form-field>
  </div>
</form>

<ng-container *dvIfSachbearbeiter>
  @let gesuchId = viewSig().gesuchId;
  @if (gesuchId && tranche && tranche.typ === 'AENDERUNG' && tranche.status === 'UEBERPRUEFEN') {
    <div class="row mt-5">
      <div class="col-12 col-md-12 col-xl-8 d-flex gap-5">
        <button
          class="btn btn-outline-primary flex-grow-1"
          data-testid="aenderung-reject"
          type="button"
          (click)="changeAenderungState(tranche.id, 'ABGELEHNT', gesuchId)"
        >
          {{ 'shared.form.aenderung.action.reject' | translate }}
        </button>
        <button
          class="btn btn-primary flex-grow-1"
          data-testid="aenderung-accept"
          type="button"
          (click)="changeAenderungState(tranche.id, 'AKZEPTIERT', gesuchId)"
        >
          {{ 'shared.form.aenderung.action.accept' | translate }}
        </button>
        <button
          class="btn btn-link"
          data-testid="aenderung-manually-change"
          type="button"
          (click)="changeAenderungState(tranche.id, 'MANUELLE_AENDERUNG', gesuchId)"
        >
          {{ 'shared.form.aenderung.action.manuallyChange' | translate }}
        </button>
      </div>
    </div>
  }
</ng-container>
