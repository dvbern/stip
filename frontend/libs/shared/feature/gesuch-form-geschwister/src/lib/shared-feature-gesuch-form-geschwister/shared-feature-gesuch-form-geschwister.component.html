<!-- loading -->
@if (viewSig().loading) {
  <div data-testid="form-geschwister-loading" class="my-2 p-2 py-4 d-flex rounded shadow-sm border">
    <div class="dv-progress-bar-indeterminate">
      <div></div>
    </div>
  </div>
}

<!-- geschwister editor -->
@if (editedGeschwister) {
  <dv-shared-feature-gesuch-form-geschwister-editor
    [geschwister]="editedGeschwister"
    (saveTriggered)="handleEditorSave($event)"
    (closeTriggered)="handleEditorClose()"
  />
} @else {
  <!-- Infobx -->
  <div class="row">
    <div class="col-12 col-xl-8 my-3">
      <ngb-alert type="info" [dismissible]="false">
        <div class="d-flex gap-3">
          <span class="material-symbols-rounded text-info"> info </span>
          <span>{{ 'shared.form.geschwister.top.info' | translate }}</span>
        </div>
      </ngb-alert>
    </div>
  </div>

  <div class="row">
    <!-- Table -->
    @if (sortedGeschwistersSig(); as geschwisters) {
      <div class="col-12 col-xl-8">
        @if (geschwisters.length) {
          <table class="table" aria-describedby="List von Geschwister">
            <thead>
              <tr>
                <th scope="col"></th>
                <th scope="col">
                  {{ 'shared.form.geschwister.name' | translate }}
                </th>
                <th scope="col">
                  {{ 'shared.form.geschwister.geburtsdatum.label' | translate }}
                </th>
                <th scope="col"></th>
                <th scope="col"></th>
              </tr>
            </thead>
            <tbody>
              @for (geschwisterRaw of geschwisters; track trackByIndex($index)) {
                <tr>
                  @if (asGeschwister(geschwisterRaw); as geschwister) {
                    <th scope="row">
                      <i class="material-symbols-rounded">done</i>
                    </th>
                    <td>{{ geschwister.vorname }} {{ geschwister.nachname }}</td>
                    <td>
                      {{ parseBackendLocalDateAndPrint(geschwister.geburtsdatum, languageSig()) }}
                    </td>
                    <td>
                      @if (!viewSig().readonly) {
                        <button
                          type="button"
                          class="btn btn-link p-0 lh-1"
                          (click)="handleSelectGeschwister(geschwister)"
                          [title]="'shared.form.geschwister.edit' | translate"
                        >
                          <i class="material-symbols-rounded">edit</i>
                        </button>
                      }
                    </td>
                    <td>
                      @if (!viewSig().readonly) {
                        <button
                          type="button"
                          class="btn btn-link p-0 lh-1"
                          (click)="handleDeleteGeschwister(geschwister)"
                          [title]="'shared.form.geschwister.delete' | translate"
                        >
                          <i class="material-symbols-rounded">delete</i>
                        </button>
                      } @else {
                        <button
                          type="button"
                          class="btn btn-link p-0 lh-1"
                          (click)="handleSelectGeschwister(geschwister)"
                          [title]="'shared.form.geschwister.view' | translate"
                        >
                          <i class="material-symbols-rounded">visibility</i>
                        </button>
                      }
                    </td>
                  }
                </tr>
              }
            </tbody>
          </table>
        }
      </div>
    }
  </div>

  <!-- ADD -->
  <div class="d-flex flex-column flex-md-row">
    @if (!viewSig().readonly) {
      <button type="button" class="btn btn-outline-primary" (click)="handleAddGeschwister()">
        {{ 'shared.form.geschwister.add' | translate }}
      </button>
    }
  </div>

  <!-- Buttons -->
  <dv-shared-ui-step-form-buttons>
    <button type="button" class="btn btn-primary" (click)="handleContinue()">
      {{ 'shared.form.gonext' | translate }}
    </button>
  </dv-shared-ui-step-form-buttons>
}
