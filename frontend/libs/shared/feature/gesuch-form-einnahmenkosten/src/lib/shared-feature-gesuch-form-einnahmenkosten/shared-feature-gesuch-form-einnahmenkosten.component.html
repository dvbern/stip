<!-- loading -->
@if (viewSig().loading) {
  <dv-shared-ui-loading data-testid="form-einnahmen-kosten-loading"></dv-shared-ui-loading>
} @else {
  <!-- form -->
  @if (formStateSig().hasData) {
    <form [formGroup]="form" data-testid="form-einnahmen-kosten-form" novalidate class="mt-4" (ngSubmit)="handleSave()">
      <h3 class="pt-5 mb-4">
        {{ 'shared.form.einnahmenkosten.einnahmen.title' | translate }}
      </h3>

      <div class="row g-4">
        <!-- NETTOERWERBSEINKOMMEN -->
        <mat-form-field dvSharedUiFormField class="col-12 col-md-9 col-xl-6">
          <mat-label>{{ 'shared.form.einnahmenkosten.nettoerwerbseinkommen.label' | translate }}</mat-label>
          <input
            formControlName="nettoerwerbseinkommen"
            data-testid="form-einnahmen-kosten-nettoerwerbseinkommen"
            matInput
            type="text"
            [maskito]="maskitoNumber"
          />
          <mat-hint translate>shared.form.einnahmenkosten.nettoerwerbseinkommen.info</mat-hint>
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </mat-error>
        </mat-form-field>
      </div>
      <div class="row g-4 mt-1">
        <!-- ALIMENTE -->
        @if (!hiddenFieldsSetSig().has(form.controls.alimente)) {
          <mat-form-field dvSharedUiFormField class="col-12 col-md-9 col-xl-6">
            <mat-label>{{ 'shared.form.einnahmenkosten.alimente.label' | translate }}</mat-label>
            <input
              formControlName="alimente"
              data-testid="form-einnahmen-kosten-alimente"
              matInput
              type="text"
              [maskito]="maskitoNumber"
            />
            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | translate }}
            </mat-error>
          </mat-form-field>
        }
      </div>
      <div class="row g-4 mt-1">
        <!-- ZULAGEN -->
        <mat-form-field dvSharedUiFormField class="col-12 col-md-9 col-xl-6">
          <mat-label>
            {{ 'shared.form.einnahmenkosten.zulagen.label' | translate }}
            @if (!formStateSig().hatKinder) {
              {{ 'shared.form.einnahmenkosten.optional.label' | translate }}
            }
          </mat-label>
          <input
            data-testid="form-einnahmen-kosten-zulagen"
            formControlName="zulagen"
            matInput
            type="text"
            [maskito]="maskitoNumber"
          />
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </mat-error>
        </mat-form-field>
      </div>
      <div class="row g-4 mt-1">
        <!-- RENTEN -->
        @if (!hiddenFieldsSetSig().has(form.controls.renten)) {
          <mat-form-field dvSharedUiFormField class="col-12 col-md-9 col-xl-6">
            <mat-label>{{ 'shared.form.einnahmenkosten.renten.label' | translate }}</mat-label>
            <input
              formControlName="renten"
              data-testid="form-einnahmen-kosten-renten"
              matInput
              type="text"
              [maskito]="maskitoNumber"
            />
            <mat-hint translate>shared.form.einnahmenkosten.renten.info</mat-hint>
            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | translate }}
            </mat-error>
          </mat-form-field>
        }
      </div>
      <div class="row g-4 mt-1">
        <!-- EO_LEISTUNGEN -->
        <mat-form-field dvSharedUiFormField class="col-12 col-md-9 col-xl-6">
          <mat-label>{{ 'shared.form.einnahmenkosten.eoLeistungen.label' | translate }}</mat-label>
          <input
            formControlName="eoLeistungen"
            data-testid="form-einnahmen-kosten-eoLeistungen"
            matInput
            type="text"
            [maskito]="maskitoNumber"
          />
          <mat-hint translate>shared.form.einnahmenkosten.eoLeistungen.info</mat-hint>
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </mat-error>
        </mat-form-field>
      </div>
      <div class="row g-4 mt-1">
        <!-- ERGAENZUNGSLEISTUNGEN -->
        <mat-form-field dvSharedUiFormField class="col-12 col-md-9 col-xl-6">
          <mat-label>{{ 'shared.form.einnahmenkosten.ergaenzungsleistungen.label' | translate }}</mat-label>
          <input
            formControlName="ergaenzungsleistungen"
            data-testid="form-einnahmen-kosten-ergaenzungsleistungen"
            matInput
            type="text"
            [maskito]="maskitoNumber"
          />
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="row g-4 mt-1">
        <!-- BEITRAEGE -->
        <mat-form-field dvSharedUiFormField class="col-12 col-md-9 col-xl-6">
          <mat-label>{{ 'shared.form.einnahmenkosten.beitraege.label' | translate }}</mat-label>
          <input
            formControlName="beitraege"
            data-testid="form-einnahmen-kosten-beitraege"
            matInput
            type="text"
            [maskito]="maskitoNumber"
          />
          <mat-hint translate>shared.form.einnahmenkosten.beitraege.info</mat-hint>
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </mat-error>
        </mat-form-field>
      </div>
      <!-- KOSTEN -->
      <h3 class="pt-5 mb-4">
        {{ 'shared.form.einnahmenkosten.kosten.title' | translate }}
      </h3>
      @if (
        !hiddenFieldsSetSig().has(form.controls.ausbildungskostenSekundarstufeZwei) ||
        !hiddenFieldsSetSig().has(form.controls.ausbildungskostenTertiaerstufe)
      ) {
        <div class="row g-4">
          <!-- AUSBILDUNGSKOSTEN_SEKUNDARSTUFE_ZWEI -->
          @if (!form.controls.ausbildungskostenSekundarstufeZwei.disabled) {
            <mat-form-field dvSharedUiFormField class="col-12 col-md-9 col-xl-6">
              <mat-label>{{
                'shared.form.einnahmenkosten.ausbildungskostenSekundarstufeZwei.label' | translate
              }}</mat-label>
              <input
                formControlName="ausbildungskostenSekundarstufeZwei"
                data-testid="form-einnahmen-kosten-ausbildungskostenSekundarstufeZwei"
                matInput
                type="text"
                [maskito]="maskitoNumber"
              />
              <mat-hint translate>shared.form.einnahmenkosten.ausbildungskostenSekundarstufeZwei.info</mat-hint>
              <mat-error *dvSharedUiFormMessageError="'required'">
                {{ 'shared.form.error.required' | translate }}
              </mat-error>
            </mat-form-field>
          }
        </div>
      }
      <div class="row g-4 mt-1">
        <!-- AUSBILDUNGSKOSTEN_TERTIARY -->
        @if (!hiddenFieldsSetSig().has(form.controls.ausbildungskostenTertiaerstufe)) {
          <mat-form-field dvSharedUiFormField class="col-12 col-md-9 col-xl-6">
            <mat-label>{{ 'shared.form.einnahmenkosten.ausbildungskostenTertiaerstufe.label' | translate }}</mat-label>
            <input
              formControlName="ausbildungskostenTertiaerstufe"
              data-testid="form-einnahmen-kosten-ausbildungskostenTertiaerstufe"
              matInput
              type="text"
              [maskito]="maskitoNumber"
            />
            <mat-hint translate>shared.form.einnahmenkosten.ausbildungskostenTertiaerstufe.info</mat-hint>
            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | translate }}
            </mat-error>
          </mat-form-field>
        }
      </div>

      <div class="row g-4 mt-1">
        <!-- FAHRKOSTEN -->
        <mat-form-field dvSharedUiFormField class="col-12 col-md-9 col-xl-6">
          <mat-label>{{ 'shared.form.einnahmenkosten.fahrkosten.label' | translate }}</mat-label>
          <input
            formControlName="fahrkosten"
            data-testid="form-einnahmen-kosten-fahrkosten"
            matInput
            type="text"
            [maskito]="maskitoNumber"
          />
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </mat-error>
        </mat-form-field>
      </div>

      @if (!hiddenFieldsSetSig().has(form.controls.wohnkosten)) {
        <div class="row g-4 mt-1">
          <!-- WOHNKOSTEN -->
          <mat-form-field dvSharedUiFormField class="col-12 col-md-9 col-xl-6">
            <mat-label>{{ 'shared.form.einnahmenkosten.wohnkosten.label' | translate }}</mat-label>
            <input
              formControlName="wohnkosten"
              data-testid="form-einnahmen-kosten-wohnkosten"
              matInput
              type="text"
              [maskito]="maskitoNumber"
            />
            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | translate }}
            </mat-error>
          </mat-form-field>
        </div>
      }
      @if (!hiddenFieldsSetSig().has(form.controls.auswaertigeMittagessenProWoche)) {
        <div class="row g-4 mt-1">
          <!-- ANZAHL AUSWÃ„RTIGER MITTAGESSEN PRO WOCHE -->
          <mat-form-field dvSharedUiFormField class="col-12 col-md-9 col-xl-6">
            <mat-label>{{ 'shared.form.einnahmenkosten.auswaertigeMittagessenProWoche.label' | translate }}</mat-label>
            <input
              formControlName="auswaertigeMittagessenProWoche"
              data-testid="form-einnahmen-kosten-auswaertigeMittagessenProWoche"
              matInput
              type="number"
              min="0"
              max="5"
            />
            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | translate }}
            </mat-error>
            <mat-error *dvSharedUiFormMessageError="'range'">
              {{ 'shared.form.error.range' | translate: { min: 0, max: 5 } }}
            </mat-error>
          </mat-form-field>
        </div>
      }
      @if (!hiddenFieldsSetSig().has(form.controls.wgWohnend)) {
        <div class="row g-4 mt-1">
          <!-- WG WOHNEND -->
          <mat-radio-group
            class="d-flex flex-column"
            formControlName="wgWohnend"
            data-testid="form-einnahmen-kosten-wgWohnend"
            dvSharedUiFormField
          >
            <mat-label>{{ 'shared.form.einnahmenkosten.wgWohnend.label' | translate }}</mat-label>
            <mat-radio-button data-testid="yes" [value]="true">
              {{ 'shared.form.radio.yes' | translate }}</mat-radio-button
            >
            <mat-radio-button data-testid="no" [value]="false">{{
              'shared.form.radio.no' | translate
            }}</mat-radio-button>
            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | translate }}
            </mat-error>
          </mat-radio-group>
        </div>
      }

      <h3 class="pt-5 mb-4">
        {{ 'shared.form.einnahmenkosten.general.title' | translate }}
      </h3>
      <div class="row g-4">
        <!-- VERDIENST_REALISIERT -->
        @if (!hiddenFieldsSetSig().has(form.controls.verdienstRealisiert)) {
          <div class="col-12 col-md-9 col-xl-6">
            <mat-radio-group
              class="d-flex flex-column"
              formControlName="verdienstRealisiert"
              data-testid="form-einnahmen-kosten-verdienstRealisiert"
              dvSharedUiFormField
            >
              <mat-label>{{ 'shared.form.einnahmenkosten.verdienstRealisiert.label' | translate }}</mat-label>
              <mat-radio-button data-testid="yes" [value]="true">
                {{ 'shared.form.radio.yes' | translate }}</mat-radio-button
              >
              <mat-radio-button data-testid="no" [value]="false">{{
                'shared.form.radio.no' | translate
              }}</mat-radio-button>
              <mat-error *dvSharedUiFormMessageError="'required'">
                {{ 'shared.form.error.required' | translate }}
              </mat-error>
            </mat-radio-group>
          </div>
        }
      </div>
      <div class="row g-4 mt-1">
        <!-- WILL_DARLEHEN -->
        @if (!hiddenFieldsSetSig().has(form.controls.willDarlehen)) {
          <div class="col-12 col-md-9 col-xl-6">
            <mat-radio-group
              class="d-flex flex-column"
              formControlName="willDarlehen"
              data-testid="form-einnahmen-kosten-willDarlehen"
              dvSharedUiFormField
            >
              <mat-label>{{ 'shared.form.einnahmenkosten.willDarlehen.label' | translate }}</mat-label>
              <mat-radio-button data-testid="yes" [value]="true">
                {{ 'shared.form.radio.yes' | translate }}</mat-radio-button
              >
              <mat-radio-button data-testid="no" [value]="false">{{
                'shared.form.radio.no' | translate
              }}</mat-radio-button>

              <mat-error *dvSharedUiFormMessageError="'required'">
                {{ 'shared.form.error.required' | translate }}
              </mat-error>
            </mat-radio-group>
          </div>
        }
      </div>

      <!-- Buttons -->
      <dv-shared-ui-step-form-buttons>
        @if (!viewSig().readonly) {
          <button type="submit" class="btn btn-primary" data-testid="button-save-continue">
            {{ 'shared.form.save-and-continue' | translate }}
          </button>
        } @else {
          <button type="button" data-testid="button-next" class="btn btn-primary" (click)="handleContinue()">
            {{ 'shared.form.gonext' | translate }}
          </button>
        }
      </dv-shared-ui-step-form-buttons>
    </form>
  } @else {
    <div class="row">
      <div class="col-12 col-xl-8 my-3">
        <ngb-alert type="info" [dismissible]="false" data-testid="gesuch-form-einnahmenkosten-data-incomplete-warning"
          >{{ 'shared.form.einnahmenkosten.top.incomplete' | translate }}
          @for (schritt of formStateSig().schritte; track trackByIndex($index); let last = $last; let first = $first) {
            <span>{{ (last && !first ? ' und ' : !first ? ', ' : '') + '"' + (schritt | translate) }}"</span>
          }
        </ngb-alert>
      </div>
    </div>
  }
}
