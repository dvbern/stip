<h1 class="h4 mb-4">
  @if (dialogData.notiz?.id) {
    @if (isJurNotiz && (!permissionStore.userIsJuristSig() || dialogData.notiz?.antwort)) {
      {{ 'sachbearbeitung-app.infos.juristischeNotiz.anzeigen' | translate }}
    } @else {
      {{ 'sachbearbeitung-app.infos.juristischeNotiz.bearbeiten' | translate }}
    }
  } @else {
    @if (isJurNotiz) {
      {{ 'sachbearbeitung-app.infos.juristischeNotiz.erstellen' | translate }}
    } @else {
      {{ 'sachbearbeitung-app.infos.notiz.erstellen' | translate }}
    }
  }
</h1>

@if (dialogData.notizTyp === 'GESUCH_NOTIZ') {
  @if (dialogData.notiz?.id) {
    <!-- datumErstellt -->
    <div class="row g-4 mb-1">
      <div class="col-12">
        <div class="d-flex gap-2">
          <span>{{ 'shared.form.notizen.datumErstellt.label' | translate }}:</span>
          <span class="fw-bold">{{ dialogData.notiz?.timestampErstellt | date: 'dd.MM.yyyy' }}</span>
        </div>
      </div>
    </div>
    <!-- userErstellt -->
    <div class="row g-4 mb-4">
      <div class="col-12">
        <div class="d-flex gap-2">
          <span>{{ 'shared.form.notizen.userErstellt.label' | translate }}:</span>
          <span class="fw-bold">{{ dialogData.notiz?.userErstellt }}</span>
        </div>
      </div>
    </div>
  }

  <form [formGroup]="form" (ngSubmit)="handleSave()" data-testid="form-notiz-form" class="w-100 mt-4">
    <div class="row g-4 mb-4">
      <!-- Betreff -->
      <mat-form-field dvSharedUiFormField class="col-12">
        <mat-label>{{ 'shared.form.notizen.betreff.label' | translate }}</mat-label>
        <input formControlName="betreff" data-testid="form-notiz-betreff" matInput type="text" />
        <mat-error *dvSharedUiFormMessageError="'required'">
          {{ 'shared.form.error.required' | translate }}
        </mat-error>
      </mat-form-field>
    </div>
    <div class="row g-4 mb-4">
      <!-- Text -->
      <mat-form-field dvSharedUiFormField class="col-12">
        <mat-label>{{ 'shared.form.notizen.text.label' | translate }}</mat-label>
        <textarea formControlName="text" data-testid="form-notiz-text" matInput type="text" rows="3"></textarea>
        <mat-error *dvSharedUiFormMessageError="'required'">
          {{ 'shared.form.error.required' | translate }}
        </mat-error>
      </mat-form-field>
    </div>

    <div class="d-flex mt-4 justify-content-end">
      <button type="button" class="btn btn-secondary" (click)="cancel()" data-testid="dialog-cancel">
        {{ 'shared.cancel' | translate }}
      </button>
      <button
        type="button"
        class="btn btn-primary ms-3"
        (click)="handleSave()"
        data-testid="dialog-confirm"
        [disabled]="form.invalid"
      >
        {{ 'shared.form.save' | translate }}
      </button>
    </div>
  </form>
}

@if (isJurNotiz) {
  <form [formGroup]="form" (ngSubmit)="handleSave()" data-testid="form-notiz-form">
    @if (dialogData.notiz?.id) {
      <!-- betreff -->
      <div class="row g-4 mb-1">
        <div class="col-12">
          <div class="d-flex gap-2">
            <span>{{ 'shared.form.notizen.betreff.label' | translate }}:</span>
            <span class="fw-bold">{{ dialogData.notiz?.betreff }}</span>
          </div>
        </div>
      </div>

      <!-- horizontal line -->
      <hr class="my-4" />

      <!-- datumErstellt -->
      <div class="row g-4 mb-1">
        <div class="col-12">
          <div class="d-flex gap-2">
            <span>{{ 'shared.form.notizen.datumErstellt.label' | translate }}:</span>
            <span class="fw-bold">{{ dialogData.notiz?.timestampErstellt | date: 'dd.MM.yyyy' }}</span>
          </div>
        </div>
      </div>
      <!-- userErstellt -->
      <div class="row g-4 mb-4">
        <div class="col-12">
          <div class="d-flex gap-2">
            <span>{{ 'shared.form.notizen.userErstellt.label' | translate }}:</span>
            <span class="fw-bold">{{ dialogData.notiz?.userErstellt }}</span>
          </div>
        </div>
      </div>

      <!-- text -->
      <div class="row g-4 mb-4">
        <div class="col-12">
          <div class="d-flex gap-2">
            <span>{{ 'shared.form.notizen.text.label' | translate }}:</span>
            <span class="fw-bold">{{ dialogData.notiz?.text }}</span>
          </div>
        </div>
      </div>

      <!-- horizontal line -->
      <hr class="my-4" />

      @if (dialogData.notiz?.antwort) {
        <!-- datumMutiert -->
        <div class="row g-4 mb-1">
          <div class="col-12">
            <div class="d-flex gap-2">
              <span>{{ 'shared.form.notizen.datumMutiert.label' | translate }}:</span>
              <span class="fw-bold">{{ dialogData.notiz?.timestampMutiert | date: 'dd.MM.yyyy' }}</span>
            </div>
          </div>
        </div>
        <!-- userMutiert -->
        <div class="row g-4 mb-4">
          <div class="col-12">
            <div class="d-flex gap-2">
              <span>{{ 'shared.form.notizen.userMutiert.label' | translate }}:</span>
              <span class="fw-bold">{{ dialogData.notiz?.userMutiert }}</span>
            </div>
          </div>
        </div>

        <!-- antwort text-->
        <div class="row g-4 mb-4">
          <div class="col-12">
            <div class="d-flex gap-2">
              <span>{{ 'shared.form.notizen.antwort.label' | translate }}:</span>
              <span class="fw-bold">{{ dialogData.notiz?.antwort }}</span>
            </div>
          </div>
        </div>
      } @else if (permissionStore.userIsJuristSig()) {
        <div class="row g-4 mb-4">
          <mat-form-field dvSharedUiFormField class="col-12">
            <mat-label>{{ 'shared.form.notizen.antwort.label' | translate }}</mat-label>
            <textarea
              formControlName="antwort"
              data-testid="form-notiz-antwort"
              matInput
              type="text"
              rows="3"
            ></textarea>
            <mat-error *dvSharedUiFormMessageError="'required'">
              {{ 'shared.form.error.required' | translate }}
            </mat-error>
          </mat-form-field>
        </div>
      } @else {
        <div class="row g-4 mb-4">
          <div class="col-12">
            <div class="d-flex gap-2">
              <span>noch keine antwort erhalten</span>
            </div>
          </div>
        </div>
      }
    } @else {
      <div class="row g-4 mb-4">
        <!-- Betreff -->
        <mat-form-field dvSharedUiFormField class="col-12">
          <mat-label>{{ 'shared.form.notizen.betreff.label' | translate }}</mat-label>
          <input formControlName="betreff" data-testid="form-notiz-betreff" matInput type="text" />
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </mat-error>
        </mat-form-field>
      </div>
      <div class="row g-4 mb-4">
        <!-- Text -->
        <mat-form-field dvSharedUiFormField class="col-12">
          <mat-label>{{ 'shared.form.notizen.text.label' | translate }}</mat-label>
          <textarea formControlName="text" data-testid="form-notiz-text" matInput type="text" rows="3"></textarea>
          <mat-error *dvSharedUiFormMessageError="'required'">
            {{ 'shared.form.error.required' | translate }}
          </mat-error>
        </mat-form-field>
      </div>
    }

    <div class="d-flex mt-4 justify-content-end">
      <button type="button" class="btn btn-secondary" (click)="cancel()" data-testid="dialog-cancel">
        {{ 'shared.cancel' | translate }}
      </button>
      <button
        type="button"
        class="btn btn-primary ms-3"
        (click)="handleSave()"
        data-testid="dialog-confirm"
        [disabled]="
          form.invalid || (dialogData.notiz?.id && !permissionStore.userIsJuristSig()) || dialogData.notiz?.antwort
        "
      >
        {{ 'shared.form.save' | translate }}
      </button>
    </div>
  </form>
}
