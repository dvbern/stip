@if (berechnungSig(); as berechnung) {
  <mat-card class="rounded-4" *transloco="let t; prefix: 'sachbearbeitung-app.verfuegung.berechnung'">
    <mat-card-header>
      <mat-card-title>
        <h1 class="tw:text-lg! tw:mb-1">
          {{ t('' + berechnung.typ + '.title') }}
        </h1>
        <div class="tw:text-lg tw:flex tw:flex-col tw:pb-3">
          @switch (berechnung.typ) {
            @case ('persoenlich') {
              <span>{{ berechnung.name }}</span>
              <span class="tw:flex tw:md:min-w-2xl tw:md:justify-between tw:md:pl-0 tw:pl-4">
                <span>
                  {{ t('persoenlich.sv-nummer') }}
                  {{ berechnung.sozialversicherungsnummer }},
                  {{ berechnung.geburtsdatum }}
                </span>

                <span>
                  {{ t('from') }}:
                  {{ berechnung.gueltigAb | date: 'MM.yyyy' }}

                  {{ t('to') }}:
                  {{ berechnung.gueltigBis | date: 'MM.yyyy' }}

                  {{ t('months') }}: {{ berechnung.anzahlMonate }}
                </span>
              </span>
              <span> {{ t('ausbildungsjahr') }} {{ berechnung.yearRange }} </span>
            }
            @case ('familien') {
              <span>{{ berechnung.name }}</span>
              <span class="tw:flex tw:md:min-w-2xl tw:md:justify-between tw:md:pl-0 tw:pl-4">
                <span>
                  {{ t('persoenlich.sv-nummer') }}
                  {{ berechnung.sozialversicherungsnummer }},
                  {{ berechnung.geburtsdatum }}
                </span>

                <span>
                  {{ t('from') }}:
                  {{ berechnung.gueltigAb | date: 'MM.yyyy' }}

                  {{ t('to') }}:
                  {{ berechnung.gueltigBis | date: 'MM.yyyy' }}

                  {{ t('months') }}: {{ berechnung.anzahlMonate }}
                </span>
              </span>
              <span> {{ t('steuerjahr') }} {{ berechnung.steuerjahr }} </span>
              <span>
                {{ t('veranlagungscode') }}
                {{ berechnung.veranlagungscode }}
              </span>
            }
          }
        </div>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-accordion class="full-width large" multi>
        <dv-berechnungs-expansion-panel [berechnungSig]="berechnung" [variantSig]="'einnahmen'">
          <ng-content select="dv-persoenliche-einnahmen,dv-familien-einnahmen"></ng-content>
        </dv-berechnungs-expansion-panel>
        <dv-berechnungs-expansion-panel [berechnungSig]="berechnung" [variantSig]="'kosten'">
          <ng-content select="dv-persoenliche-kosten,dv-familien-kosten"></ng-content>
        </dv-berechnungs-expansion-panel>
      </mat-accordion>
    </mat-card-content>

    <mat-card-footer class="px-3 py-4">
      @switch (berechnung.typ) {
        @case ('persoenlich') {
          <div class="tw:mt-3">
            <!-- fehlbetrag -->
            <dv-position
              [titleSig]="t('persoenlich.fehlbetrag')"
              [infoSig]="t('persoenlich.fehlbetrag.info')"
              [amountSig]="berechnung.fehlbetrag | formatChf"
            ></dv-position>

            <!-- proKopfTeilung -->
            <dv-position
              [titleSig]="t('persoenlich.proKopfTeilung')"
              [amountSig]="berechnung.proKopfTeilung | formatChf"
            ></dv-position>

            <!-- todo: check amount, Budget anzahlMonate -->
            <dv-position
              [titleSig]="t('persoenlich.budgetAnzahlMonate', { anzahlMonate: berechnung.anzahlMonate })"
              [amountSig]="berechnung.total | formatChf"
            ></dv-position>

            <!-- information studierende -->
            <dv-position [titleSig]="t('persoenlich.informationStudierende')"></dv-position>

            <!-- stipendium -->
            <dv-position [titleSig]="t('persoenlich.hinweis.zweiDrittel')"></dv-position>

            <!-- darlehen gesetzlich -->
            <dv-position [titleSig]="t('persoenlich.hinweis.einDrittel')"></dv-position>

            <!-- Hinweis 1. schwarzarbeitBGSA -->
            <div>
              {{ t('hinweis.schwarzarbeitBGSA') }}
            </div>

            <!-- Hinweis 2. hoechstwerte -->
            <div>
              {{ t('hinweis.hoechstwerte') }}
            </div>

            <!-- Hinweis 3. Eigenverdienst -->
            <div>
              {{
                t('hinweis.eigenverdienst', {
                  einkommensfreibetrag: stammdatenSig().einkommensfreibetrag | formatChf,
                })
              }}
            </div>
          </div>
        }
        @case ('familien') {
          <div class="tw:mt-3">
            <!-- todo: which amount - Einnahmeüberschuss -->
            <dv-position
              [titleSig]="t('familien.einnahmeueberschuss')"
              [infoSig]="t('familien.einnahmeueberschuss.info')"
              [amountSig]="berechnung.total | formatChf"
            ></dv-position>

            <!-- todo: which amount - Geteilt durch die anzahl Kinder -->
            <dv-position [titleSig]="t('familien.anzahlKinderInAusbildung')" [amountSig]=""></dv-position>

            <!-- todo: which amount - Anrechenbare, elterliche Leistung -->
            <dv-position
              [titleSig]="t('familien.elterlicheLeistung')"
              [infoSig]="t('familien.elterlicheLeistung.info')"
              [amountSig]=""
            ></dv-position>

            <!-- todo: which amount - 50% Reduktion gemäss Art. 15  Abs. 2 ABG -->
            <dv-position
              [titleSig]="t('familien.reduktionArt15Abs2ABG')"
              [infoSig]="t('familien.reduktionArt15Abs2ABG.info')"
              [amountSig]=""
            ></dv-position>

            <!-- todo: which amount - Fehlbetrag -->
            <dv-position
              [titleSig]="t('familien.fehlbetrag')"
              [infoSig]="t('familien.fehlbetrag.info')"
              [amountSig]="berechnung.fehlbetrag | formatChf"
            ></dv-position>

            <!-- Geteilt durch die Anzahl Personen im Haushalt (proKopfTeilung) -->
            <dv-position
              [titleSig]="t('familien.proKopfTeilung')"
              [amountSig]="berechnung.proKopfTeilung | formatChf"
            ></dv-position>

            <!-- Ungedeckter Anteil Lebenshaltungskosten -->
            <dv-position
              [titleSig]="t('familien.ungedeckterAnteilLebenshaltungskosten')"
              [infoSig]="t('familien.ungedeckterAnteilLebenshaltungskosten.info')"
              [amountSig]="berechnung.total | formatChf"
            ></dv-position>

            <!-- Hinweis 1. schwarzarbeit BGSA -->
            <div>
              {{ t('hinweis.schwarzarbeitBGSA') }}
            </div>
            <!-- Hinweis 2. -->
            <div>
              {{ t('hinweis.hoechstwerte') }}
            </div>
          </div>
        }
      }
    </mat-card-footer>
  </mat-card>
}
