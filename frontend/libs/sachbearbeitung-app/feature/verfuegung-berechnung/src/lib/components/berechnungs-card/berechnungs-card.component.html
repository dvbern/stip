@if (berechnungSig(); as berechnung) {
  <mat-card class="rounded-4" *transloco="let t; prefix: 'sachbearbeitung-app.verfuegung.berechnung'">
    <mat-card-header>
      <mat-card-title>
        <h1 class="tw:text-lg! tw:mb-1">
          {{ t(titleKeySig()) }}
        </h1>
        <div class="tw:text-lg tw:flex tw:flex-col tw:pb-3">
          <span>{{ berechnung.name }}</span>
          <span class="tw:flex tw:md:min-w-2xl tw:md:justify-between tw:md:pl-0 tw:pl-4 tw:text-sm tw:text-gray-500">
            <span>
              {{ t('persoenlich.sv-nummer') }}
              {{ berechnung.sozialversicherungsnummer }},
              {{ berechnung.geburtsdatum | date: 'dd.MM.yyyy' }}
            </span>

            <span>
              {{ t('from') }}: {{ berechnung.gueltigAb | date: 'MM.yyyy' }},

              {{ t('to') }}: {{ berechnung.gueltigBis | date: 'MM.yyyy' }},

              {{ t('months') }}: {{ berechnung.anzahlMonate }}
            </span>
          </span>

          @switch (berechnung.typ) {
            @case ('persoenlich') {
              <span class="tw:text-gray-500 tw:text-sm"> {{ t('ausbildungsjahr') }} {{ berechnung.yearRange }} </span>
            }
            @case ('familien') {
              <span
                class="tw:flex tw:md:min-w-2xl tw:md:justify-between tw:md:pl-0 tw:pl-4 tw:text-sm tw:text-gray-500"
              >
                <span class="tw:text-gray-500 tw:text-sm"> {{ t('steuerjahr') }}: {{ berechnung.steuerjahr }} </span>
                <span class="tw:text-gray-500 tw:text-sm">
                  {{ t('veranlagungscode') }}:
                  {{ berechnung.veranlagungscode }}
                </span>
              </span>
            }
          }
        </div>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-accordion class="full-width large" multi>
        <dv-berechnungs-expansion-panel [berechnungSig]="berechnung" [variantSig]="'einnahmen'">
          <ng-content select="dv-persoenliche-einnahmen,dv-familien-einnahmen"></ng-content>
        </dv-berechnungs-expansion-panel>
        <dv-berechnungs-expansion-panel [berechnungSig]="berechnung" [variantSig]="'kosten'">
          <ng-content select="dv-persoenliche-kosten,dv-familien-kosten"></ng-content>
        </dv-berechnungs-expansion-panel>
      </mat-accordion>
    </mat-card-content>

    <mat-card-footer class="px-3 py-4">
      @switch (berechnung.typ) {
        @case ('persoenlich') {
          <div class="tw:mt-3">
            <!-- fehlbetrag -->
            <dv-position
              type="title"
              [titleSig]="t('persoenlich.fehlbetrag')"
              [infoSig]="t('persoenlich.fehlbetrag.info')"
              [amountSig]="berechnung.fehlbetrag | formatChf"
            ></dv-position>

            <!-- proKopfTeilung -->
            <dv-position
              class="tw:mt-2"
              [titleSig]="t('persoenlich.proKopfTeilung')"
              [amountSig]="berechnung.proKopfTeilung | formatChf"
            ></dv-position>

            <!-- budgetTranche -->
            <dv-position
              type="title"
              class="tw:mt-2"
              [titleSig]="t('persoenlich.budgetAnzahlMonate', { anzahlMonate: berechnung.anzahlMonate })"
              [amountSig]="berechnung.budgetTranche | formatChf"
            ></dv-position>

            <!-- information studierende -->
            <div class="tw:mt-6 tw:font-semibold tw:text-lg">
              {{ t('persoenlich.informationStudierende') }}
              <span class="tw:text-xs tw:align-text-top">3)</span>
            </div>

            <!-- stipendium -->
            <dv-position
              [titleSig]="t('persoenlich.hinweis.zweiDrittel')"
              [amountSig]="berechnung.gesetzlichesDarlehenStipendium"
            ></dv-position>

            <!-- darlehen gesetzlich -->
            <dv-position
              [titleSig]="t('persoenlich.hinweis.einDrittel')"
              [amountSig]="berechnung.gesetzlichesDarlehen"
            ></dv-position>

            <!-- Hinweis 1. schwarzarbeitBGSA -->
            <div class="tw:mt-6 tw:text-gray-500 tw:text-sm">
              {{ t('hinweis.schwarzarbeitBGSA') }}
            </div>

            <!-- Hinweis 2. hoechstwerte -->
            <div class="tw:text-gray-500 tw:text-sm">
              {{ t('hinweis.hoechstwerte') }}
            </div>

            <!-- Hinweis 3. Eigenverdienst -->
            <div class="tw:text-gray-500 tw:text-sm">
              {{
                t('hinweis.eigenverdienst', {
                  einkommensfreibetrag: stammdatenSig().einkommensfreibetrag | formatChf,
                })
              }}
            </div>
          </div>
        }
        @case ('familien') {
          <div class="tw:mt-3">
            <!--  einnahmeUeberschuss -->
            <dv-position
              type="title"
              [titleSig]="t('familien.einnahmeueberschuss')"
              [infoSig]="t('familien.einnahmeueberschuss.info')"
              [amountSig]="berechnung.einnahmeUeberschuss | formatChf"
            ></dv-position>

            <!-- proKopfTeilungKinderInAusbildung -->
            <dv-position
              class="tw:mt-2"
              [titleSig]="t('familien.anzahlKinderInAusbildung')"
              [amountSig]="berechnung.proKopfTeilungKinderInAusbildung"
            ></dv-position>

            <!-- anrechenbareElterlicheLeistung -->
            <dv-position
              class="tw:mt-2"
              [titleSig]="t('familien.elterlicheLeistung')"
              [infoSig]="t('familien.elterlicheLeistung.info')"
              [amountSig]="berechnung.anrechenbareElterlicheLeistung | formatChf"
            ></dv-position>

            <!-- halbierungsReduktion -->
            <dv-position
              class="tw:mt-2"
              [titleSig]="t('familien.reduktionArt15Abs2ABG')"
              [infoSig]="t('familien.reduktionArt15Abs2ABG.info')"
              [amountSig]="berechnung.halbierungsReduktion | formatChf"
            ></dv-position>

            <!-- Fehlbetrag -->
            <dv-position
              type="title"
              class="tw:mt-10"
              [titleSig]="t('familien.fehlbetrag')"
              [infoSig]="t('familien.fehlbetrag.info')"
              [amountSig]="berechnung.fehlbetrag | formatChf"
            ></dv-position>

            <!-- Geteilt durch die Anzahl Personen im Haushalt (proKopfTeilung) -->
            <dv-position
              class="tw:mt-2"
              [titleSig]="t('familien.proKopfTeilung')"
              [amountSig]="berechnung.proKopfTeilung | formatChf"
            ></dv-position>

            <!-- Ungedeckter Anteil Lebenshaltungskosten -->
            <dv-position
              class="tw:mt-2"
              [titleSig]="t('familien.ungedeckterAnteilLebenshaltungskosten')"
              [infoSig]="t('familien.ungedeckterAnteilLebenshaltungskosten.info')"
              [amountSig]="berechnung.ungedeckterAnteilLebenshaltungskosten | formatChf"
            ></dv-position>

            <!-- Hinweis 1. schwarzarbeit BGSA -->
            <div class="tw:mt-10 tw:text-gray-500 tw:text-sm">
              {{ t('hinweis.schwarzarbeitBGSA') }}
            </div>
            <!-- Hinweis 2. -->
            <div class="tw:text-gray-500 tw:text-sm">
              {{ t('hinweis.hoechstwerte') }}
            </div>
          </div>
        }
      }
    </mat-card-footer>
  </mat-card>
}
