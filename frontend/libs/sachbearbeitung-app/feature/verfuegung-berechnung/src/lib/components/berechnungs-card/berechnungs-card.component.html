@if (berechnungSig(); as berechnung) {
  <mat-card class="rounded-4" *transloco="let t">
    <mat-card-header>
      <mat-card-title>
        <h1 class="tw:text-lg! tw:mb-1">
          {{ t('sachbearbeitung-app.verfuegung.berechnung.' + berechnung.typ + '.title') }}
        </h1>
        <div class="tw:text-lg tw:flex tw:flex-col tw:pb-3">
          @switch (berechnung.typ) {
            @case ('persoenlich') {
              <span>{{ berechnung.name }}</span>
              <span class="tw:flex tw:md:min-w-2xl tw:md:justify-between tw:md:pl-0 tw:pl-4">
                <span>
                  {{ t('sachbearbeitung-app.verfuegung.berechnung.persoenlich.sv-nummer') }}
                  {{ berechnung.sozialversicherungsnummer }},
                  {{ berechnung.geburtsdatum }}
                </span>

                <span>
                  {{ t('sachbearbeitung-app.verfuegung.berechnung.from') }}:
                  {{ berechnung.gueltigAb | date: 'MM.yyyy' }}

                  {{ t('sachbearbeitung-app.verfuegung.berechnung.to') }}:
                  {{ berechnung.gueltigBis | date: 'MM.yyyy' }}

                  {{ t('sachbearbeitung-app.verfuegung.berechnung.months') }}: {{ berechnung.monate }}
                </span>
              </span>
              <span>
                {{ t('sachbearbeitung-app.verfuegung.berechnung.ausbildungsjahr') }} {{ berechnung.yearRange }}
              </span>
            }
            @case ('familien') {
              {{ t(berechnung.nameKey, berechnung) }}
            }
          }
        </div>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-accordion class="full-width large" multi>
        <dv-berechnungs-expansion-panel [berechnungSig]="berechnung" [variantSig]="'einnahmen'">
          <ng-content select="dv-persoenliche-einnahmen,dv-familien-einnahmen"></ng-content>
        </dv-berechnungs-expansion-panel>
        <dv-berechnungs-expansion-panel [berechnungSig]="berechnung" [variantSig]="'kosten'">
          <ng-content select="dv-persoenliche-kosten,dv-familien-kosten"></ng-content>
        </dv-berechnungs-expansion-panel>
      </mat-accordion>
    </mat-card-content>
    <mat-card-footer class="px-3 py-4">
      <!-- wenn verheiratet, geteilt durch anzahl personen im haushalt -->
      @if (berechnung.typ === 'persoenlich' && berechnung.totalVorTeilung) {
        <div class="d-flex justify-content-between fs-5 h4">
          <div>
            {{ t('sachbearbeitung-app.verfuegung.berechnung.' + berechnung.typ + '.total') }}
          </div>
          <div>
            {{ berechnung.totalVorTeilung | formatChfNegative }}
          </div>
        </div>
        <div class="d-flex text-muted justify-content-between fs-5 tw:mb-2">
          <div>
            {{ t('sachbearbeitung-app.verfuegung.berechnung.' + berechnung.typ + '.anzahlPersonen') }}
          </div>
          <div>
            {{ berechnung.einnahmen.anzahlPersonenImHaushalt }}
          </div>
        </div>
        <div class="d-flex justify-content-between fs-4 h4">
          <div>
            {{ t('sachbearbeitung-app.verfuegung.berechnung.' + berechnung.typ + '.totalVorTeilung') }}
          </div>
          <div>{{ berechnung.total | formatChf }}</div>
        </div>

        @if (Math.sign(berechnung.total) === 1) {
          <!-- nicht angerechnet  -->
          <div class="d-flex text-muted justify-content-between fs-5 tw:mb-2">
            <div>{{ t('sachbearbeitung-app.verfuegung.berechnung.hinweis.positiverBetrag') }}</div>
            <div>
              {{ berechnung.total | formatChfNegative: true }}
            </div>
          </div>
        }

        <!-- Stipendienanspruch -->
        <div class="d-flex justify-content-between fs-3 h4 mt-3">
          <div>
            <div>{{ t('sachbearbeitung-app.verfuegung.berechnung.persoenlich.stipendienanspruch') }}</div>
            @if (berechnung.monate !== 12) {
              <div class="text-muted mt-1 fw-normal fs-6">
                {{
                  t('sachbearbeitung-app.verfuegung.berechnung.persoenlich.stipendienanspruch.monate', {
                    monate: berechnung.monate,
                  })
                }}
              </div>
            }
          </div>
          <div>{{ berechnung.berechnung | formatChf }}</div>
        </div>
      } @else if (berechnung.typ === 'persoenlich') {
        <div class="d-flex justify-content-between fs-4 h4">
          {{ t('sachbearbeitung-app.verfuegung.berechnung.' + berechnung.typ + '.total') }}
          <span class="text-nowrap" [attr.data-testid]="'berechnung-' + berechnung.typ + '-total'">{{
            berechnung.total | formatChfNegative
          }}</span>
        </div>

        @if (Math.sign(berechnung.total) === 1) {
          <!-- nicht angerechnet  -->
          <div class="d-flex text-muted justify-content-between fs-5 tw:mb-2">
            <div>{{ t('sachbearbeitung-app.verfuegung.berechnung.hinweis.positiverBetrag') }}</div>
            <div>
              {{ berechnung.total | formatChfNegative: true }}
            </div>
          </div>
        }

        <!-- Stipendienanspruch -->
        <div class="d-flex justify-content-between fs-3 h4 mt-3">
          <div>
            <div>{{ t('sachbearbeitung-app.verfuegung.berechnung.persoenlich.stipendienanspruch') }}</div>
            @if (berechnung.monate !== 12) {
              <div class="text-muted mt-1 fw-normal fs-6">
                {{
                  t('sachbearbeitung-app.verfuegung.berechnung.persoenlich.stipendienanspruch.monate', {
                    monate: berechnung.monate,
                  })
                }}
              </div>
            }
          </div>
          <div>{{ berechnung.berechnung | formatChf }}</div>
        </div>
      } @else {
        <div class="d-flex justify-content-between fs-4 h4">
          {{ t('sachbearbeitung-app.verfuegung.berechnung.' + berechnung.typ + '.total') }}
          <span class="text-nowrap" [attr.data-testid]="'berechnung-' + berechnung.typ + '-total'">{{
            berechnung.total | formatChfNegative
          }}</span>
        </div>
      }
      @if (berechnung.typ === 'persoenlich' && berechnung.geteilteBerechnung) {
        <div class="mat-expansion-panel-header-title text-muted justify-content-between fs-4 me-0 mb-0 grid w-100">
          {{
            t(
              'sachbearbeitung-app.verfuegung.berechnung.' + berechnung.typ + '.geteilteBerechnung',
              berechnung.geteilteBerechnung
            )
          }}
          <span class="text-nowrap" [attr.data-testid]="'berechnung-' + berechnung.typ + '-geteilteBerechnung'">{{
            berechnung.geteilteBerechnung.anteil | formatChfNegative
          }}</span>
        </div>
      }
    </mat-card-footer>
  </mat-card>
}
