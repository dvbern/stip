@if (store.loading()) {
  <dv-shared-ui-loading data-testid="loading"></dv-shared-ui-loading>
} @else {
  <div class="col-12">
    <div class="container card pb-4 pt-5 mt-5 shadow">
      <div class="row overflow-auto">
        <table class="ausbiltunsstaette-table" mat-table [dataSource]="store.tableData()" multiTemplateDataRows>
          <caption class="cdk-visually-hidden">
            {{
              'sachbearbeitung-app.admin.ausbildungsstaette.description' | translate
            }}
          </caption>

          <!-- nameDe -->
          <ng-container matColumnDef="nameDe">
            <th mat-header-cell *matHeaderCellDef>
              {{ 'sachbearbeitung-app.admin.ausbildungsstaette.nameDe' | translate }}
            </th>
            <td mat-cell *matCellDef="let staette">
              {{ staette.nameDe }}
            </td>
          </ng-container>

          <!-- nameFr -->
          <ng-container matColumnDef="nameFr">
            <th mat-header-cell *matHeaderCellDef>
              {{ 'sachbearbeitung-app.admin.ausbildungsstaette.nameFr' | translate }}
            </th>
            <td mat-cell *matCellDef="let staette">
              {{ staette.nameFr }}
            </td>
          </ng-container>

          <!-- ort -->
          <ng-container matColumnDef="ort">
            <th mat-header-cell *matHeaderCellDef>
              {{ 'sachbearbeitung-app.admin.ausbildungsstaette.ort' | translate }}
            </th>
            <td mat-cell *matCellDef="let staette">Bern</td>
          </ng-container>

          <!-- ausbildungsgaengeCount -->
          <ng-container matColumnDef="ausbildungsgaengeCount">
            <th mat-header-cell *matHeaderCellDef>
              {{ 'sachbearbeitung-app.admin.ausbildungsstaette.ausbildungsgaengeCount' | translate }}
            </th>
            <td mat-cell *matCellDef="let staette">
              {{ staette.ausbildungsgaengeCount }}
            </td>
          </ng-container>

          <!-- actions -->
          <ng-container matColumnDef="actions">
            <th class="action-cell" mat-header-cell *matHeaderCellDef>&nbsp;</th>
            <td class="action-cell" mat-cell *matCellDef="let staette">
              <div class="action-cell-content">
                <button
                  [title]="'sachbearbeitung-app.ausbildungsstaette.admin.edit' | translate"
                  type="button"
                  class="btn btn-link btn-sm"
                >
                  <i class="material-symbols-rounded fs-4">edit</i>
                </button>
                <button
                  [title]="'sachbearbeitung-app.ausbildungsstaette.admin.delete' | translate"
                  type="button"
                  class="btn btn-link btn-sm"
                >
                  <i class="material-symbols-rounded fs-4">delete</i>
                </button>
                <button class="btn btn-link btn-sm" type="button">
                  @if (expandedRow === staette) {
                    <i class="material-symbols-rounded fs-4">expand_less</i>
                  } @else {
                    <i class="material-symbols-rounded fs-4">expand_more</i>
                  }
                </button>
              </div>
            </td>
          </ng-container>

          <!-- expandedDetail -->
          <ng-container matColumnDef="expandedDetail">
            <td mat-cell *matCellDef="let staette" [attr.colspan]="displayedColumns.length">
              <div class="detail-cell" [@detailExpand]="staette === expandedRow ? 'expanded' : 'collapsed'">
                @if (staette === expandedRow) {
                  <table mat-table [dataSource]="staette.ausbildungsgaenge ?? []">
                    <caption class="cdk-visually-hidden">
                      {{
                        'sachbearbeitung-app.admin.ausbildungsgaenge.description' | translate
                      }}
                    </caption>

                    <!-- bezeichnungDe -->
                    <ng-container matColumnDef="bezeichnungDe">
                      <th mat-header-cell *matHeaderCellDef>
                        {{ 'sachbearbeitung-app.admin.ausbildungsgaenge.bezeichnungDe' | translate }}
                      </th>
                      <td mat-cell *matCellDef="let ausbildungsgang">
                        {{ ausbildungsgang.bezeichnungDe }}
                      </td>
                    </ng-container>

                    <!-- bezeichnungFr -->
                    <ng-container matColumnDef="bezeichnungFr">
                      <th mat-header-cell *matHeaderCellDef>
                        {{ 'sachbearbeitung-app.admin.ausbildungsgaenge.bezeichnungFr' | translate }}
                      </th>
                      <td mat-cell *matCellDef="let ausbildungsgang">
                        {{ ausbildungsgang.bezeichnungFr }}
                      </td>
                    </ng-container>

                    <!-- ausbildungsrichtung -->
                    <ng-container matColumnDef="ausbildungsrichtung">
                      <th mat-header-cell *matHeaderCellDef>
                        {{ 'sachbearbeitung-app.admin.ausbildungsgaenge.ausbildungsrichtung' | translate }}
                      </th>
                      <td mat-cell *matCellDef="let ausbildungsgang">
                        {{ ausbildungsgang.ausbildungsrichtung }}
                      </td>
                    </ng-container>

                    <!-- ausbildungsort -->
                    <ng-container matColumnDef="ausbildungsort">
                      <th mat-header-cell *matHeaderCellDef>
                        {{ 'sachbearbeitung-app.admin.ausbildungsgaenge.ausbildungsort' | translate }}
                      </th>
                      <td mat-cell *matCellDef="let ausbildungsgang">
                        {{ ausbildungsgang.ausbildungsort }}
                      </td>
                    </ng-container>

                    <!-- actions -->
                    <ng-container matColumnDef="actions">
                      <th class="action-cell" mat-header-cell *matHeaderCellDef>&nbsp;</th>
                      <td class="action-cell" mat-cell *matCellDef="let ausbildungsgang">
                        <div class="action-cell-content">
                          <button
                            [title]="'sachbearbeitung-app.admin.ausbildungsgaenge.edit' | translate"
                            type="button"
                            class="btn btn-link btn-sm"
                          >
                            <i class="material-symbols-rounded fs-4">edit</i>
                          </button>
                          <button
                            [title]="'sachbearbeitung-app.admin.ausbildungsgaenge.delete' | translate"
                            type="button"
                            class="btn btn-link btn-sm"
                          >
                            <i class="material-symbols-rounded fs-4">delete</i>
                          </button>
                        </div>
                      </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedChildColumns"></tr>

                    <tr mat-row *matRowDef="let ausbildungsgang; columns: displayedChildColumns"></tr>
                  </table>
                }
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

          <tr
            mat-row
            *matRowDef="let staette; columns: displayedColumns"
            (click)="expandedRow = expandedRow === staette ? null : staette"
          ></tr>

          <tr mat-row class="detail-row" *matRowDef="let staette; columns: ['expandedDetail']"></tr>
        </table>
      </div>
    </div>
  </div>
}
