<div class="tw:dv-table tw:my-3">
  <form class="tw:relative tw:overflow-auto" [formGroup]="filterForm">
    @if (viewSig().loading) {
      <dv-shared-ui-loading [overlay]="true"></dv-shared-ui-loading>
    }
    <table
      [dataSource]="abschluesseDataSourceSig()"
      (matSortChange)="sortList($event)"
      data-testid="cockpit-table"
      mat-table
      matSort
      class="tw:w-full tw:!table-fixed"
    >
      <caption class="cdk-visually-hidden">
        {{
          'sachbearbeitung-app.feature.administration.ausbildungsstaette.abschluss.table.description' | transloco
        }}
      </caption>

      <ng-container matColumnDef="ABSCHLUSS">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="filtered tw:w-52 tw:whitespace-nowrap">
          <label class="pe-none" for="abschluss">{{
            'sachbearbeitung-app.feature.administration.ausbildungsstaette.abschluss.table.abschluss' | transloco
          }}</label>
          <div class="tw:relative tw:flex">
            <mat-form-field>
              <input
                matInput
                id="abschluss"
                class="tw:w-full"
                [formControl]="filterForm.controls.abschluss"
                data-testid="cockpit-filter-fall"
                (click)="$event.stopPropagation()"
                (keydown)="$event.stopPropagation()"
              />
            </mat-form-field>
            <dv-shared-ui-clear-button
              class="tw:absolute tw:right-[-26px] tw:flex tw:items-center"
              (clear)="filterForm.controls.abschluss.reset()"
              [valueSig]="filterForm.controls.abschluss.value"
            ></dv-shared-ui-clear-button>
          </div>
        </th>
        <td
          mat-cell
          *dvMatCellDef="let abschluss; dataSource: abschluesseDataSourceSig()"
          class="tw:w-32 tw:whitespace-nowrap"
        >
          {{ abschluss | translatedProp: 'bezeichnung' : translate.getActiveLang() }}
        </td>
      </ng-container>

      <ng-container matColumnDef="AUSBILDUNGSKATEGORIE">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="filtered tw:w-52 tw:whitespace-nowrap">
          <label class="pe-none" for="ausbildungskategorie">{{
            'sachbearbeitung-app.feature.administration.ausbildungsstaette.abschluss.table.ausbildungskategorie'
              | transloco
          }}</label>
          <mat-form-field class="tw:w-full">
            <mat-select
              [aria-label]="
                'sachbearbeitung-app.feature.administration.ausbildungsstaette.abschluss.table.ausbildungskategorie'
                  | transloco
              "
              [formControl]="filterForm.controls.ausbildungskategorie"
              (click)="$event.stopPropagation()"
              class="tw:!font-normal"
              [placeholder]="
                'sachbearbeitung-app.feature.administration.ausbildungsstaette.no-filter.ausbildungskategorie'
                  | transloco
              "
              panelClass="table-select"
            >
              <mat-option [value]="undefined">
                {{
                  'sachbearbeitung-app.feature.administration.ausbildungsstaette.no-filter.ausbildungskategorie'
                    | transloco
                }}
              </mat-option>

              @for (ausbildungskategorie of ausbildungskategorieValues; track ausbildungskategorie) {
                <mat-option [value]="ausbildungskategorie">
                  {{ 'shared.ausbildungskategorie.' + ausbildungskategorie | transloco }}
                </mat-option>
              }
            </mat-select>
          </mat-form-field>
        </th>
        <td
          mat-cell
          *dvMatCellDef="let abschluss; dataSource: abschluesseDataSourceSig()"
          class="tw:w-32 tw:whitespace-nowrap"
          [dvTruncateTooltip]="'shared.ausbildungskategorie.' + abschluss.ausbildungskategorie | transloco"
        >
          {{ 'shared.ausbildungskategorie.' + abschluss.ausbildungskategorie | transloco }}
        </td>
      </ng-container>

      <ng-container matColumnDef="BILDUNGSRICHTUNG">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="filtered tw:w-52 tw:whitespace-nowrap">
          <label class="pe-none" for="bildungsrichtung">{{
            'sachbearbeitung-app.feature.administration.ausbildungsstaette.abschluss.table.bildungsrichtung' | transloco
          }}</label>
          <mat-form-field class="tw:w-full">
            <mat-select
              [aria-label]="
                'sachbearbeitung-app.feature.administration.ausbildungsstaette.abschluss.table.bildungsrichtung'
                  | transloco
              "
              [formControl]="filterForm.controls.bildungsrichtung"
              (click)="$event.stopPropagation()"
              class="tw:!font-normal"
              [placeholder]="
                'sachbearbeitung-app.feature.administration.ausbildungsstaette.no-filter.bildungsrichtung' | transloco
              "
              panelClass="table-select"
            >
              <mat-option [value]="undefined">
                {{
                  'sachbearbeitung-app.feature.administration.ausbildungsstaette.no-filter.bildungsrichtung' | transloco
                }}
              </mat-option>

              @for (bildungsrichtung of bildungsrichtungValues; track bildungsrichtung) {
                <mat-option [value]="bildungsrichtung">
                  {{ 'shared.bildungsrichtung.' + bildungsrichtung | transloco }}
                </mat-option>
              }
            </mat-select>
          </mat-form-field>
        </th>
        <td
          mat-cell
          *dvMatCellDef="let abschluss; dataSource: abschluesseDataSourceSig()"
          class="tw:w-32 tw:whitespace-nowrap"
          [dvTruncateTooltip]="'shared.bildungsrichtung.' + abschluss.bildungsrichtung | transloco"
        >
          {{ 'shared.bildungsrichtung.' + abschluss.bildungsrichtung | transloco }}
        </td>
      </ng-container>

      <ng-container matColumnDef="AKTIV">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="filtered tw:w-24 tw:whitespace-nowrap">
          {{ 'sachbearbeitung-app.feature.administration.ausbildungsstaette.abschluss.table.status' | transloco }}
          <mat-form-field class="tw:w-full">
            <mat-select
              [aria-label]="
                'sachbearbeitung-app.feature.administration.ausbildungsstaette.abschluss.table.status' | transloco
              "
              [formControl]="filterForm.controls.status"
              (click)="$event.stopPropagation()"
              class="tw:!font-normal"
              [placeholder]="
                'sachbearbeitung-app.feature.administration.ausbildungsstaette.no-filter.status' | transloco
              "
              panelClass="table-select"
            >
              <mat-option [value]="undefined">
                {{ 'sachbearbeitung-app.feature.administration.ausbildungsstaette.no-filter.status' | transloco }}
              </mat-option>

              @for (status of statusValues; track status) {
                <mat-option [value]="status">
                  {{
                    'sachbearbeitung-app.feature.administration.ausbildungsstaette.abschluss.table.status.' + status
                      | transloco
                  }}
                </mat-option>
              }
            </mat-select>
          </mat-form-field>
        </th>
        <td mat-cell *dvMatCellDef="let abschluss; dataSource: abschluesseDataSourceSig()" class="tw:whitespace-nowrap">
          @let key = abschluss.aktiv ? 'ACTIVE' : 'INACTIVE';
          {{
            'sachbearbeitung-app.feature.administration.ausbildungsstaette.abschluss.table.status.' + key | transloco
          }}
        </td>
      </ng-container>

      <!-- aktionen -->
      <ng-container matColumnDef="AKTIONEN">
        <th mat-header-cell *matHeaderCellDef class="tw:w-28 tw:whitespace-nowrap tw:!text-right">
          <button
            type="button"
            class="btn btn-outline-primary btn-sm"
            [matTooltip]="'sachbearbeitung-app.admin.gesuchsperiode.table.erstellen' | transloco"
            (click)="createAbschluss()"
          >
            <i class="material-symbols-rounded fs-4 tw:align-middle">add</i>
          </button>
        </th>
        <td mat-cell *dvMatCellDef="let abschluss; dataSource: abschluesseDataSourceSig()" class="tw:w-11">
          <div class="tw:flex tw:justify-end">
            <button
              type="button"
              class="dv-icon-button dv-icon-button-md tw:text-gray-500"
              (click)="editAbschluss(abschluss); $event.stopPropagation()"
            >
              <span class="material-symbols-rounded tw:!text-xl/none">edit</span>
            </button>
            @if (abschluss.canArchive) {
              <button
                type="button"
                class="dv-icon-button dv-icon-button-md tw:text-gray-500"
                (click)="archive(abschluss); $event.stopPropagation()"
              >
                <span class="material-symbols-rounded tw:!text-2xl/none">cancel</span>
              </button>
            }
            <button
              type="button"
              class="dv-icon-button dv-icon-button-md text-info"
              (click)="showInfo(abschluss); $event.stopPropagation()"
            >
              <span class="material-symbols-rounded tw:!text-2xl/none">info</span>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *dvMatRowDef="let abschluss; dataSource: abschluesseDataSourceSig(); columns: displayedColumns"></tr>
      <tr class="mat-mdc-row" *matNoDataRow>
        <td class="mat-mdc-cell tw:px-3" [colSpan]="displayedColumns.length">
          {{ 'shared.table.noData' | transloco }}
        </td>
      </tr>
    </table>
  </form>

  <mat-paginator
    showFirstLastButtons
    [pageSizeOptions]="pageSizes"
    [pageSize]="pageSize() ?? defaultPageSize"
    [pageIndex]="page() ?? 0"
    [length]="viewSig().totalEntries"
    (page)="paginateList($event)"
  ></mat-paginator>
</div>
