<div class="tw:dv-table tw:my-3">
  <form class="tw:relative tw:overflow-auto" [formGroup]="filterForm">
    @if (viewSig().loading) {
      <dv-shared-ui-loading [overlay]="true"></dv-shared-ui-loading>
    }
    <table
      [dataSource]="ausbildungsgaengeDataSourceSig()"
      (matSortChange)="sortList($event)"
      data-testid="cockpit-table"
      mat-table
      matSort
      class="tw:w-full tw:!table-fixed"
    >
      <caption class="cdk-visually-hidden">
        {{
          'sachbearbeitung-app.feature.administration.ausbildungsstaette.ausbildungsgang.table.description' | transloco
        }}
      </caption>

      <ng-container matColumnDef="AUSBILDUNGSSTAETTE">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="filtered tw:w-52 tw:whitespace-nowrap">
          <label class="pe-none" for="ausbildungsstaette">{{
            'sachbearbeitung-app.feature.administration.ausbildungsstaette.ausbildungsgang.table.ausbildungsstaette'
              | transloco
          }}</label>
          <div class="tw:relative tw:flex">
            <mat-form-field>
              <input
                matInput
                id="ausbildungsstaette"
                class="tw:w-full"
                [formControl]="filterForm.controls.ausbildungsstaette"
                data-testid="cockpit-filter-fall"
                (click)="$event.stopPropagation()"
                (keydown)="$event.stopPropagation()"
              />
            </mat-form-field>
            <dv-shared-ui-clear-button
              class="tw:absolute tw:right-[-26px] tw:flex tw:items-center"
              (clear)="filterForm.controls.ausbildungsstaette.reset()"
              [valueSig]="filterForm.controls.ausbildungsstaette.value"
            ></dv-shared-ui-clear-button>
          </div>
        </th>
        <td
          mat-cell
          *dvMatCellDef="let ausbildungsgang; dataSource: ausbildungsgaengeDataSourceSig()"
          [dvTruncateTooltip]="ausbildungsgang.ausbildungsstaette | translatedProp: 'name' : translate.getActiveLang()"
          class="tw:w-32 tw:whitespace-nowrap"
        >
          {{ ausbildungsgang.ausbildungsstaette | translatedProp: 'name' : translate.getActiveLang() }}
        </td>
      </ng-container>

      <ng-container matColumnDef="ABSCHLUSS_AUSBILDUNGSKATEGORIE">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="filtered tw:w-52 tw:whitespace-nowrap">
          <label class="pe-none" for="ausbildungskategorie">{{
            'sachbearbeitung-app.feature.administration.ausbildungsstaette.ausbildungsgang.table.ausbildungskategorie'
              | transloco
          }}</label>
          <mat-form-field class="tw:w-full">
            <mat-select
              [aria-label]="
                'sachbearbeitung-app.feature.administration.ausbildungsstaette.ausbildungsgang.table.ausbildungskategorie'
                  | transloco
              "
              [formControl]="filterForm.controls.ausbildungskategorie"
              (click)="$event.stopPropagation()"
              class="tw:!font-normal"
              [placeholder]="
                'sachbearbeitung-app.feature.administration.ausbildungsstaette.no-filter.ausbildungskategorie'
                  | transloco
              "
              panelClass="table-select"
            >
              <mat-option [value]="undefined">
                {{
                  'sachbearbeitung-app.feature.administration.ausbildungsstaette.no-filter.ausbildungskategorie'
                    | transloco
                }}
              </mat-option>

              @for (ausbildungskategorie of ausbildungskategorieValues; track ausbildungskategorie) {
                <mat-option [value]="ausbildungskategorie">
                  {{ 'shared.ausbildungskategorie.' + ausbildungskategorie | transloco }}
                </mat-option>
              }
            </mat-select>
          </mat-form-field>
        </th>
        <td
          mat-cell
          *dvMatCellDef="let ausbildungsgang; dataSource: ausbildungsgaengeDataSourceSig()"
          class="tw:w-32 tw:whitespace-nowrap"
          [dvTruncateTooltip]="
            ('shared.ausbildungskategorie.' + ausbildungsgang.abschluss.ausbildungskategorie | transloco) +
            ' ' +
            ('shared.bildungsrichtung.' + ausbildungsgang.abschluss.bildungsrichtung | transloco)
          "
        >
          @if (ausbildungsgang.abschluss.ausbildungskategorie) {
            <span>
              {{ 'shared.ausbildungskategorie.' + ausbildungsgang.abschluss.ausbildungskategorie | transloco }}
            </span>
          }
          @if (ausbildungsgang.abschluss.bildungsrichtung) {
            <span>
              {{ 'shared.bildungsrichtung.' + ausbildungsgang.abschluss.bildungsrichtung | transloco }}
            </span>
          }
        </td>
      </ng-container>

      <ng-container matColumnDef="ABSCHLUSS">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="filtered tw:w-52 tw:whitespace-nowrap">
          <label class="pe-none" for="abschluss">{{
            'sachbearbeitung-app.feature.administration.ausbildungsstaette.ausbildungsgang.table.abschluss' | transloco
          }}</label>
          <div class="tw:relative tw:flex">
            <mat-form-field>
              <input
                matInput
                id="abschluss"
                class="tw:w-full"
                [formControl]="filterForm.controls.abschluss"
                data-testid="cockpit-filter-fall"
                (click)="$event.stopPropagation()"
                (keydown)="$event.stopPropagation()"
              />
            </mat-form-field>
            <dv-shared-ui-clear-button
              class="tw:absolute tw:right-[-26px] tw:flex tw:items-center"
              (clear)="filterForm.controls.abschluss.reset()"
              [valueSig]="filterForm.controls.abschluss.value"
            ></dv-shared-ui-clear-button>
          </div>
        </th>
        <td
          mat-cell
          *dvMatCellDef="let ausbildungsgang; dataSource: ausbildungsgaengeDataSourceSig()"
          class="tw:w-32 tw:whitespace-nowrap"
          [dvTruncateTooltip]="ausbildungsgang.abschluss | translatedProp: 'bezeichnung' : translate.getActiveLang()"
        >
          {{ ausbildungsgang.abschluss | translatedProp: 'bezeichnung' : translate.getActiveLang() }}
        </td>
      </ng-container>

      <ng-container matColumnDef="AKTIV">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="filtered tw:w-24 tw:whitespace-nowrap">
          {{ 'sachbearbeitung-app.feature.administration.ausbildungsstaette.ausbildungsgang.table.status' | transloco }}
          <mat-form-field class="tw:w-full">
            <mat-select
              [aria-label]="
                'sachbearbeitung-app.feature.administration.ausbildungsstaette.ausbildungsgang.table.status' | transloco
              "
              [formControl]="filterForm.controls.status"
              (click)="$event.stopPropagation()"
              class="tw:!font-normal"
              [placeholder]="
                'sachbearbeitung-app.feature.administration.ausbildungsstaette.no-filter.status' | transloco
              "
              panelClass="table-select"
            >
              <mat-option [value]="undefined">
                {{ 'sachbearbeitung-app.feature.administration.ausbildungsstaette.no-filter.status' | transloco }}
              </mat-option>

              @for (status of statusValues; track status) {
                <mat-option [value]="status">
                  {{
                    'sachbearbeitung-app.feature.administration.ausbildungsstaette.ausbildungsgang.table.status.' +
                      status | transloco
                  }}
                </mat-option>
              }
            </mat-select>
          </mat-form-field>
        </th>
        <td
          mat-cell
          *dvMatCellDef="let abschluss; dataSource: ausbildungsgaengeDataSourceSig()"
          class="tw:whitespace-nowrap"
        >
          @let key = abschluss.aktiv ? 'ACTIVE' : 'INACTIVE';
          {{
            'sachbearbeitung-app.feature.administration.ausbildungsstaette.ausbildungsgang.table.status.' + key
              | transloco
          }}
        </td>
      </ng-container>

      <!-- aktionen -->
      <ng-container matColumnDef="AKTIONEN">
        <th mat-header-cell *matHeaderCellDef class="tw:w-20 tw:whitespace-nowrap tw:!text-right">
          <div class="tw:relative tw:inline-block">
            @if (addAusbildungsgangIsLoadingSig()) {
              <dv-shared-ui-loading [overlay]="true" [type]="'icon'"></dv-shared-ui-loading>
            }
            <button
              type="button"
              class="btn btn-outline-primary btn-sm"
              [matTooltip]="'sachbearbeitung-app.admin.gesuchsperiode.table.erstellen' | transloco"
              (click)="createAusbildungsgang()"
              [disabled]="addAusbildungsgangIsLoadingSig()"
            >
              <i class="material-symbols-rounded fs-4 tw:align-middle">add</i>
            </button>
          </div>
        </th>
        <td mat-cell *dvMatCellDef="let abschluss; dataSource: ausbildungsgaengeDataSourceSig()">
          <div class="tw:flex tw:justify-end">
            @if (abschluss.aktiv) {
              <button
                type="button"
                class="dv-icon-button dv-icon-button-md tw:text-gray-500"
                (click)="archive(abschluss); $event.stopPropagation()"
              >
                <span class="material-symbols-rounded tw:!text-2xl/none">cancel</span>
              </button>
            }
            <button
              type="button"
              class="dv-icon-button dv-icon-button-md text-info"
              (click)="showInfo(abschluss); $event.stopPropagation()"
            >
              <span class="material-symbols-rounded tw:!text-2xl/none"> info </span>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *dvMatRowDef="let abschluss; dataSource: ausbildungsgaengeDataSourceSig(); columns: displayedColumns"
      ></tr>
      <tr class="mat-mdc-row" *matNoDataRow>
        <td class="mat-mdc-cell tw:px-3" [colSpan]="displayedColumns.length">
          {{ 'shared.table.noData' | transloco }}
        </td>
      </tr>
    </table>
  </form>

  <mat-paginator
    showFirstLastButtons
    [pageSizeOptions]="pageSizes"
    [pageSize]="pageSize() ?? defaultPageSize"
    [pageIndex]="page() ?? 0"
    [length]="viewSig().totalEntries"
    (page)="paginateList($event)"
  ></mat-paginator>
</div>
