stages: [build, validate, test, analyze, package, deploy, mirror]

include:
  - component: 'gitlab.dvbern.ch/devops/gitlab/components/workflow@v0.0.7'

  - component: 'gitlab.dvbern.ch/devops/gitlab/components/nx@6357835c284bd240eb50ff709dd34c607356249c'
    inputs:
      app-name: '*-app'
      test-app-name: '*-app'
      context-dir: 'frontend'

  - component: 'gitlab.dvbern.ch/devops/gitlab/components/sonarqube@cf0406e37c5f431b925b1dcebde5153a3fd5e9e7'
    inputs:
      sonar-scanner: cli
      sonar-project-key: kibon_stip-frontend_AYkrwt88SZqri_oH9Xlq
      context-dir: 'frontend'
      sonar-token: "$SONAR_TOKEN_FRONTEND"

  - component: 'gitlab.dvbern.ch/devops/gitlab/components/buildah@cf0406e37c5f431b925b1dcebde5153a3fd5e9e7'
    inputs:
      name: package:sachbearbeitung-app
      context-dir: frontend
      image-name: 'stip/sachbearbeitung-app'
      version: '$VERSION'
      build-args: |
        APP=sachbearbeitung-app

  - component: 'gitlab.dvbern.ch/devops/gitlab/components/buildah@cf0406e37c5f431b925b1dcebde5153a3fd5e9e7'
    inputs:
      name: package:sachbearbeitung-app
      context-dir: frontend
      image-name: 'stip/sachbearbeitung-app'
      version: '$VERSION'
      build-args: |
        APP=gesuch-app
