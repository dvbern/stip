stages: [build, validate, test, analyze, package, e2e, deploy, mirror]

include:
  - component: 'gitlab.dvbern.ch/devops/gitlab/components/workflow@3327a9a092d74bb4745d5da7c10ff8a4e8eefe1d'
    inputs:
      mr-version: '$CI_COMMIT_SHORT_SHA'

  - component: 'gitlab.dvbern.ch/devops/gitlab/components/nx@b2bce2f00106241c91bbbfe1c77d9cd3750e227f'
    inputs:
      app-name: '*-app'
      test-app-name: '*'
      context-dir: 'frontend'
      component-test-package-version: '13.6.2'
      e2e-on: 'never'

  - component: 'gitlab.dvbern.ch/devops/gitlab/components/sonarqube@v0.1.4'
    inputs:
      sonar-scanner: cli
      context-dir: 'frontend'
      sonar-project-key: "$SONAR_PROJECT_KEY_FRONTEND"
      sonar-token: "$SONAR_TOKEN_FRONTEND"

  - component: 'gitlab.dvbern.ch/devops/gitlab/components/buildah@5ee978eeededdc1275eb9f200743ba14dfaf2c30'
    inputs:
      name: package:sachbearbeitung-app
      context-dir: frontend
      image-name: 'sachbearbeitung-app'
      version: '$VERSION'
      build-latest: 'false'
      build-args: |
        APP=sachbearbeitung-app

  - component: 'gitlab.dvbern.ch/devops/gitlab/components/buildah@5ee978eeededdc1275eb9f200743ba14dfaf2c30'
    inputs:
      name: package:gesuch-app
      context-dir: frontend
      image-name: 'gesuch-app'
      version: '$VERSION'
      build-latest: 'false'
      build-args: |
        APP=gesuch-app
